var suggestions=document.getElementById("suggestions"),search=document.getElementById("search");search!==null&&document.addEventListener("keydown",inputFocus);function inputFocus(e){e.ctrlKey&&e.key==="/"&&(e.preventDefault(),search.focus()),e.key==="Escape"&&(search.blur(),suggestions.classList.add("d-none"))}document.addEventListener("click",function(e){var t=suggestions.contains(e.target);t||suggestions.classList.add("d-none")}),document.addEventListener("keydown",suggestionFocus);function suggestionFocus(n){const s=suggestions.classList.contains("d-none");if(s)return;const e=[...suggestions.querySelectorAll("a")];if(e.length===0)return;const t=e.indexOf(document.activeElement);if(n.key==="ArrowUp"){n.preventDefault();const s=t>0?t-1:0;e[s].focus()}else if(n.key==="ArrowDown"){n.preventDefault();const s=t+1<e.length?t+1:t;e[s].focus()}}(function(){var e=new FlexSearch.Document({tokenize:"forward",cache:100,document:{id:"id",store:["href","title","description"],index:["title","description","content"]}});e.add({id:0,href:"/docs/prologue/introduction/",title:"å¤œèŽºä»‹ç»",description:"å¤œèŽºï¼ˆ Nightingale ï¼‰æ˜¯ä¸€æ¬¾å›½äº§å¼€æºã€äº‘åŽŸç”Ÿç›‘æŽ§ç³»ç»Ÿ",content:"é¡¹ç›®ä»£ç  #  åŽç«¯ï¼šðŸ’¡ https://github.com/ccfos/nightingale å‰ç«¯ï¼šðŸ’¡ https://github.com/n9e/fe-v5  å‰åŽç«¯éƒ½æ˜¯å¼€æºçš„ï¼Œå¦‚æžœè§‰å¾—ä¸é”™ï¼Œæ¬¢è¿Ž star ä¸€ä¸‹ï¼Œç»™æˆ‘ä»¬æŒç»­åšæŒçš„åŠ¨åŠ›ï¼æœ‰ä»»ä½•é—®é¢˜ï¼Œä¹Ÿæ¬¢è¿Žæäº¤ issueï¼Œå½“ç„¶ï¼Œå¦‚æžœèƒ½ç›´æŽ¥ PR å°±æ›´å¥½äº†ï¼Œå¼€æºè½¯ä»¶ï¼Œå°±æ˜¯éœ€è¦å¤§å®¶ä¸€èµ·å‚ä¸Žæ‰èƒ½æœ‰è“¬å‹ƒçš„ç”Ÿå‘½åŠ›ã€‚\näº§å“ä»‹ç» # Nightingale å¯ä»¥æŽ¥æ”¶å„ç§é‡‡é›†å™¨ä¸ŠæŠ¥çš„ç›‘æŽ§æ•°æ®ï¼Œè½¬å­˜åˆ°æ—¶åºåº“ï¼ˆå¯ä»¥æ”¯æŒPrometheusã€M3DBã€VictoriaMetricsã€Thanosç­‰ï¼‰ï¼Œå¹¶æä¾›å‘Šè­¦è§„åˆ™ã€å±è”½è§„åˆ™ã€è®¢é˜…è§„åˆ™çš„é…ç½®èƒ½åŠ›ï¼Œæä¾›ç›‘æŽ§æ•°æ®çš„æŸ¥çœ‹èƒ½åŠ›ï¼Œæä¾›å‘Šè­¦è‡ªæ„ˆæœºåˆ¶ï¼ˆå‘Šè­¦è§¦å‘ä¹‹åŽè‡ªåŠ¨å›žè°ƒæŸä¸ªwebhookåœ°å€æˆ–è€…æ‰§è¡ŒæŸä¸ªè„šæœ¬ï¼‰ï¼Œæä¾›åŽ†å²å‘Šè­¦äº‹ä»¶çš„å­˜å‚¨ç®¡ç†ã€åˆ†ç»„æŸ¥çœ‹çš„èƒ½åŠ›ã€‚\nç³»ç»Ÿæˆªå›¾ # ç³»ç»Ÿæž¶æž„ # å¤œèŽº v5 çš„è®¾è®¡éžå¸¸ç®€å•ï¼Œæ ¸å¿ƒæ˜¯ server å’Œ webapi ä¸¤ä¸ªæ¨¡å—ï¼Œwebapi æ— çŠ¶æ€ï¼Œæ”¾åˆ°ä¸­å¿ƒç«¯ï¼Œæ‰¿æŽ¥å‰ç«¯è¯·æ±‚ï¼Œå°†ç”¨æˆ·é…ç½®å†™å…¥æ•°æ®åº“ï¼›server æ˜¯å‘Šè­¦å¼•æ“Žå’Œæ•°æ®è½¬å‘æ¨¡å—ï¼Œä¸€èˆ¬éšç€æ—¶åºåº“èµ°ï¼Œä¸€ä¸ªæ—¶åºåº“å°±å¯¹åº”ä¸€å¥— serverï¼Œæ¯å¥— server å¯ä»¥åªç”¨ä¸€ä¸ªå®žä¾‹ï¼Œä¹Ÿå¯ä»¥å¤šä¸ªå®žä¾‹ç»„æˆé›†ç¾¤ï¼Œserver å¯ä»¥æŽ¥æ”¶ Categrafã€Telegrafã€Grafana-Agentã€Datadog-Agentã€Falcon-Plugins ä¸ŠæŠ¥çš„æ•°æ®ï¼Œå†™å…¥åŽç«¯æ—¶åºåº“ï¼Œå‘¨æœŸæ€§ä»Žæ•°æ®åº“åŒæ­¥å‘Šè­¦è§„åˆ™ï¼Œç„¶åŽæŸ¥è¯¢æ—¶åºåº“åšå‘Šè­¦åˆ¤æ–­ã€‚æ¯å¥— server ä¾èµ–ä¸€ä¸ª redisã€‚\näº§å“å¯¹æ¯” # Zabbix # Zabbix æ˜¯ä¸€æ¬¾è€ç‰Œçš„ç›‘æŽ§ç³»ç»Ÿï¼Œå¯¹æœºå™¨å’Œç½‘ç»œè®¾å¤‡çš„ç›‘æŽ§è¦†ç›–å¾ˆå…¨ï¼Œæ¯”å¦‚æ”¯æŒ AIX ç³»ç»Ÿï¼Œå¸¸è§çš„å¼€æºç›‘æŽ§éƒ½æ˜¯æ”¯æŒ Linuxã€Windowsï¼ŒAIX è¾ƒå°‘èƒ½å¤Ÿæ”¯æŒï¼ŒZabbix ç”¨æˆ·ç¾¤ä½“å¹¿æ³›ï¼Œå›½å†…å¾ˆå¤šå…¬å¸åŸºäºŽ Zabbix åšå•†ä¸šåŒ–æœåŠ¡ï¼Œä¸è¿‡ Zabbix ä½¿ç”¨æ•°æ®åº“åšå­˜å‚¨ï¼Œå®¹é‡æœ‰é™ï¼Œä»Šå¹´æŽ¨å‡ºçš„ TimescaleDB å¯¹å®¹é‡æœ‰è¾ƒå¤§æå‡ï¼Œå¤§å®¶å¯ä»¥å°è¯•ä¸‹ï¼›å…¶æ¬¡ Zabbix æ•´ä¸ªäº§å“è®¾è®¡æ˜¯é¢å‘é™æ€èµ„äº§çš„ï¼Œåœ¨äº‘åŽŸç”Ÿåœºæ™¯ä¸‹æ˜¾å¾—åŠ›ä¸ä»Žå¿ƒã€‚\nOpen-Falcon # å› ä¸ºå¼€å‘ Open-Falcon å’Œ Nightingale çš„æ˜¯ä¸€æ‹¨äººï¼Œæ‰€ä»¥å¾ˆå¤šç¤¾åŒºä¼™ä¼´ä¼šæ¯”è¾ƒå¥½å¥‡ï¼Œä¸ºä½•è¦æ–°åšä¸€ä¸ªç›‘æŽ§å¼€æºè½¯ä»¶ã€‚æ ¸å¿ƒç‚¹æ˜¯ Open-Falcon å’Œ Nightingale çš„å·®å¼‚ç‚¹å®žåœ¨æ˜¯å¤ªå¤§äº†ï¼ŒNightingale å¹¶éžæ˜¯ Open-Falcon è®¾è®¡é€»è¾‘çš„ä¸€ä¸ªå»¶ç»­ï¼Œå°±çœ‹åšä¸¤ä¸ªä¸åŒçš„è½¯ä»¶å°±å¥½ã€‚\nOpen-Falcon æ˜¯ 14 å¹´å¼€å‘çš„ï¼Œå½“æ—¶æ˜¯æƒ³è§£å†³ Zabbix çš„ä¸€äº›å®¹é‡é—®é¢˜ï¼Œå¯ä»¥çœ‹åšæ˜¯ç‰©ç†æœºæ—¶ä»£çš„äº§ç‰©ï¼Œæ•´ä¸ªè®¾è®¡åå‘è¿ç»´è§†è§’ï¼Œè™½ç„¶æ•°æ®ç»“æž„ä¸Šå·²ç»å¼€å§‹è®¾è®¡äº†æ ‡ç­¾ï¼Œä½†æ˜¯æŸ¥è¯¢è¯­æ³•è¿˜æ˜¯æ¯”è¾ƒç®€å•ï¼Œæ— æ³•åº”å¯¹æ¯”è¾ƒå¤æ‚çš„åœºæ™¯ã€‚\nNightingale ç›´æŽ¥æ”¯æŒ PromQLï¼Œæ”¯æŒ Prometheusã€M3DBã€VictoriaMetrics å¤šç§æ—¶åºåº“ï¼Œæ”¯æŒ Categrafã€Telegrafã€Datadog-Agentã€Grafana-Agent åšç›‘æŽ§æ•°æ®é‡‡é›†ï¼Œæ”¯æŒ Grafana çœ‹å›¾ï¼Œæ•´ä¸ªè®¾è®¡æ›´åŠ äº‘åŽŸç”Ÿã€‚\nPrometheus # Nightingale å¯ä»¥ç®€å•çœ‹åšæ˜¯ Prometheus çš„ä¸€ä¸ªä¼ä¸šçº§ç‰ˆæœ¬ï¼ŒæŠŠ Prometheus å½“åš Nightingale çš„ä¸€ä¸ªå†…éƒ¨ç»„ä»¶ï¼ˆæ—¶åºåº“ï¼‰ï¼Œå½“ç„¶ï¼Œä¹Ÿä¸æ˜¯å¿…é¡»çš„ï¼Œæ—¶åºåº“é™¤äº† Prometheusï¼Œè¿˜å¯ä»¥ä½¿ç”¨ VictoriaMetricsã€M3DB ç­‰ï¼Œå„ç§ Exporter é‡‡é›†å™¨ä¹Ÿå¯ä»¥ç»§ç»­ä½¿ç”¨ã€‚\nNightingale å¯ä»¥æŽ¥å…¥å¤šä¸ª Prometheusï¼Œå¯ä»¥å…è®¸ç”¨æˆ·åœ¨é¡µé¢ä¸Šé…ç½®å‘Šè­¦è§„åˆ™ã€å±è”½è§„åˆ™ã€è®¢é˜…è§„åˆ™ï¼Œåœ¨é¡µé¢ä¸ŠæŸ¥çœ‹å‘Šè­¦äº‹ä»¶ã€åšå‘Šè­¦äº‹ä»¶èšåˆç»Ÿè®¡ï¼Œé…ç½®å‘Šè­¦è‡ªæ„ˆæœºåˆ¶ï¼Œç®¡ç†ç›‘æŽ§å¯¹è±¡ï¼Œé…ç½®ç›‘æŽ§å¤§ç›˜ç­‰ï¼Œå°±æŠŠ Nightingale çœ‹åšæ˜¯ Prometheus çš„ä¸€ä¸ª WEBUI ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä¸è¿‡å®žé™…ä¸Šï¼Œå®ƒè¿œè¿œä¸æ­¢æ˜¯ä¸€ä¸ª WEBUIï¼Œç”¨ä¸€ä¸‹å°±ä¼šæ·±æœ‰æ„Ÿè§¦ã€‚\nåŠ å…¥ç¤¾åŒº # å…¬ä¼—å·æœ‰åŠ å…¥äº¤æµç¾¤çš„æ–¹å¼ã€ç­”ç–‘æ–¹å¼ï¼Œä¹Ÿä¼šå®šæœŸåˆ†äº«å¤œèŽºçŸ¥è¯†ã€äº‘åŽŸç”Ÿç›‘æŽ§çŸ¥è¯†ï¼Œæ¬¢è¿Žå…³æ³¨ã€‚\nå•†ä¸šæœåŠ¡ # ä¸€æ¬¾å¼€æºè½¯ä»¶è¦æƒ³é•¿æœŸå‘å±•ï¼Œéœ€è¦äº§æƒæ‰€æœ‰æ–¹ã€æ ¸å¿ƒå¼€å‘äººå‘˜ã€ç¤¾åŒºç”¨æˆ·ç­‰å¤šæ–¹å®žçŽ°å…±èµ¢ï¼Œå¦åˆ™ä¼´éšç€æ ¸å¿ƒäººå‘˜ç¦»èŒï¼Œé¡¹ç›®å¾ˆå¯èƒ½å°±ä¼šåœæ­¢æ›´æ–°ç”šè‡³å¤­æŠ˜ï¼Œå¤œèŽºçš„äº§æƒæ‰€æœ‰æ–¹æ˜¯ä¸­å›½è®¡ç®—æœºå­¦ä¼šå¼€æºå‘å±•å§”å‘˜ä¼šï¼Œæ˜¯ä¸€ä¸ªéžç›ˆåˆ©æœºæž„ï¼Œæ ¸å¿ƒå¼€å‘äººå‘˜éš¶å±žäºŽåŒ—äº¬å¿«çŒ«æ˜Ÿäº‘ç§‘æŠ€æœ‰é™å…¬å¸ï¼Œå¿«çŒ«çš„äº§å“å°±æ˜¯åŸºäºŽå¼€æºå¤œèŽºæž„å»ºçš„ï¼Œæ‰€ä»¥å½¢æˆäº†è‰¯æ€§å¾ªçŽ¯ã€‚æ¬¢è¿Žæœ‰æ”¯ä»˜èƒ½åŠ›çš„å…¬å¸èƒ½å¤Ÿæ”¯æŒä¸€ä¸‹å¿«çŒ«å›¢é˜Ÿï¼Œé‡‡è´­å•†ä¸šç‰ˆæœ¬çš„äº§å“æˆ–å¼€æºæŠ€æœ¯æ”¯æŒæœåŠ¡ï¼Œå¤šæ–¹å…±èµ¢ ðŸ¤ðŸ¤\n"}),e.add({id:1,href:"/docs/prologue/share/",title:"ç¤¾åŒºåˆ†äº«",description:"å¤œèŽºç›‘æŽ§ç¤¾åŒºåˆ†äº«",content:"æœ¬èŠ‚ç½—åˆ—ç¤¾åŒºç”¨æˆ·çš„åˆ†äº«æ–‡ç« ï¼Œæ¬¢è¿Žå¤§å®¶æŠŠè‡ªå·±çš„å¿ƒå¾—æ–‡ç« é“¾æŽ¥æ”¾åˆ°è¿™é‡Œï¼Œè®©æ•´ä¸ªç¤¾åŒºå—ç›Šï¼Œç›¸äº’äº¤æµï¼š\n Telegraf Windowsç‰ˆæœ¬çš„å®‰è£…ï¼Œä¿å§†çº§æ•™ç¨‹ - by SL Telegraf Linuxç‰ˆæœ¬çš„å®‰è£…ï¼Œä¿å§†çº§æ•™ç¨‹ - by SL å¼ƒç”¨Prometheusï¼Œæ­å»ºå•æœºç‰ˆæœ¬çš„VictoriaMetrics - by SL ä¸€é”®éƒ¨ç½²å¤œèŽºåˆ°Kubernetes - by é™¶æŸ’ ä½¿ç”¨Telegrafåšå¤œèŽº5.0çš„æ•°æ®é‡‡é›†ï¼Œæ ·ä¾‹åŒ…å«LinuxåŸºæœ¬ä¿¡æ¯é‡‡é›†ã€MySQLã€Redisçš„é‡‡é›† - by æŸ´ä»Šæ ‹@è‰¾æ´¾ telegrafå¸¸ç”¨ä¸­é—´ä»¶é‡‡é›† ä¿®æ”¹notify.pyä¸ºå¤œèŽºå¢žåŠ çŸ­ä¿¡é€šçŸ¥èƒ½åŠ› - by æŸ´ä»Šæ ‹@è‰¾æ´¾ ä½¿ç”¨notify.pyæŽ¥å…¥é˜¿é‡Œäº‘è¯­éŸ³é€šçŸ¥ - by æžœ Oracleçš„ç®€å•ç›‘æŽ§å®žçŽ° - by æŸ´ä»Šæ ‹@è‰¾æ´¾ RocketMQç®€å•ç›‘æŽ§çš„å®žçŽ° - by æŸ´ä»Šæ ‹@è‰¾æ´¾ æ‰‹æŠŠæ‰‹æ•™ä½ æŽ¥å…¥é’‰é’‰å‘Šè­¦ ä¸€æ–‡è¯´é€MySQLç›‘æŽ§ï¼Œä½¿ç”¨Prometheusç”Ÿæ€çš„Exporter Vsphere-monitoræ•°æ®ä¸ŠæŠ¥å¤œèŽºV5ç›‘æŽ§ ä½¿ç”¨pgä½œä¸ºæ•°æ®åº“æ›¿æ¢MySQL Telegraf é…ç½®æ–‡ä»¶ï¼Œå‘Šè­¦è§„åˆ™ï¼Œçœ‹å›¾å¤§ç›˜åˆ†äº« - æ˜ å®¢-éƒ‘å¯Œå¼º telegrafé‡‡é›†Nacos - éƒ­ä»€ä¹ˆç£ŠÂ°  "}),e.add({id:2,href:"/docs/install/compose/",title:"Docker Compose",description:"ä½¿ç”¨Docker composeä¸€é”®å¯åŠ¨å¤œèŽºï¼Œå¿«é€Ÿå°è¯•",content:"ä½¿ç”¨Docker Composeä¸€é”®å¯åŠ¨å¤œèŽºï¼Œå¿«é€Ÿå°è¯•ã€‚æ›´å¤šDocker Composeç›¸å…³çŸ¥è¯†è¯·å‚è€ƒDockerå®˜ç½‘\n$ git clone https://gitlink.org.cn/ccfos/nightingale.git $ cd nightingale/docker $ docker compose up -d Creating network \u0026quot;docker_nightingale\u0026quot; with driver \u0026quot;bridge\u0026quot; Creating mysql ... done Creating redis ... done Creating prometheus ... done Creating ibex ... done Creating agentd ... done Creating nwebapi ... done Creating nserver ... done Creating telegraf ... done $ docker compose ps Name Command State Ports ---------------------------------------------------------------------------------------------------------------------------- agentd /app/ibex agentd Up 10090/tcp, 20090/tcp ibex /app/ibex server Up 0.0.0.0:10090-\u0026gt;10090/tcp, 0.0.0.0:20090-\u0026gt;20090/tcp mysql docker-entrypoint.sh mysqld Up 0.0.0.0:3306-\u0026gt;3306/tcp, 33060/tcp nserver /app/n9e server Up 18000/tcp, 0.0.0.0:19000-\u0026gt;19000/tcp nwebapi /app/n9e webapi Up 0.0.0.0:18000-\u0026gt;18000/tcp, 19000/tcp prometheus /bin/prometheus --config.f ... Up 0.0.0.0:9090-\u0026gt;9090/tcp redis docker-entrypoint.sh redis ... Up 0.0.0.0:6379-\u0026gt;6379/tcp telegraf /entrypoint.sh telegraf Up 0.0.0.0:8092-\u0026gt;8092/udp, 0.0.0.0:8094-\u0026gt;8094/tcp, 0.0.0.0:8125-\u0026gt;8125/udp  ðŸ’¡  å¯åŠ¨æˆåŠŸä¹‹åŽï¼Œå»ºè®®æŠŠ initsql ç›®å½•ä¸‹çš„å†…å®¹æŒªèµ°ï¼Œè¿™æ ·ä¸‹æ¬¡é‡å¯çš„æ—¶å€™ï¼ŒDB å°±ä¸ä¼šé‡æ–°åˆå§‹åŒ–äº†ã€‚å¦åˆ™ä¸‹æ¬¡å¯åŠ¨ mysql è¿˜æ˜¯ä¼šè‡ªåŠ¨æ‰§è¡Œ initsql ä¸‹é¢çš„ sql æ–‡ä»¶å¯¼è‡´ DB é‡æ–°åˆå§‹åŒ–ï¼Œé¡µé¢ä¸Šåˆ›å»ºçš„è§„åˆ™ã€å¤§ç›˜ç­‰éƒ½ä¼šä¸¢å¤±ã€‚Docker Compose è¿™ç§éƒ¨ç½²æ–¹å¼ï¼Œåªæ˜¯ç”¨äºŽç®€å•æµ‹è¯•ï¼Œä¸æŽ¨èåœ¨ç”Ÿäº§çŽ¯å¢ƒä½¿ç”¨ï¼Œå½“ç„¶äº†ï¼Œå¦‚æžœæ‚¨æ˜¯ Docker Compose ä¸“å®¶ï¼Œå¦å½“åˆ«è®º   æœåŠ¡å¯åŠ¨ä¹‹åŽï¼Œæµè§ˆå™¨è®¿é—®nwebapiçš„ç«¯å£ï¼Œå³18000ï¼Œé»˜è®¤ç”¨æˆ·æ˜¯rootï¼Œå¯†ç æ˜¯root.2020\n"}),e.add({id:3,href:"/docs/install/helm/",title:"Helm",description:"å¤œèŽºï¼ˆNightingaleï¼‰Helm chart",content:"Helm chart ç”±å¿«çŒ«å›¢é˜Ÿç»´æŠ¤ï¼Œåœ°å€ï¼šhttps://github.com/flashcatcloud/n9e-helm å¤œèŽºç³»ç»Ÿçš„é»˜è®¤ç”¨æˆ·æ˜¯rootï¼Œå¯†ç æ˜¯root.2020\n"}),e.add({id:4,href:"/docs/install/server/",title:"æœåŠ¡ç«¯ç»„ä»¶éƒ¨ç½²",description:"å¤œèŽºï¼ˆNightingaleï¼‰æœåŠ¡ç«¯ç›¸å…³æ¨¡å—çš„å®‰è£…",content:"é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸‹é¢çš„æž¶æž„å›¾ï¼Œå¤œèŽºçš„æœåŠ¡ç«¯æœ‰ä¸¤ä¸ªæ¨¡å—ï¼šn9e-webapi å’Œ n9e-serverï¼Œn9e-webapi ç”¨äºŽæä¾› API ç»™å‰ç«¯ JavaScript ä½¿ç”¨ï¼Œn9e-server çš„èŒè´£æ˜¯å‘Šè­¦å¼•æ“Žå’Œæ•°æ®è½¬å‘å™¨ã€‚ä¾èµ–çš„ç»„ä»¶æœ‰ MySQLã€Redisã€æ—¶åºåº“ï¼Œæ—¶åºåº“æˆ‘ä»¬è¿™é‡Œä½¿ç”¨ Prometheusã€‚\nç»„ä»¶å®‰è£… # mysqlã€redisã€prometheusï¼Œè¿™ä¸‰ä¸ªç»„ä»¶éƒ½æ˜¯å¼€æºè½¯ä»¶ï¼Œè¯·å¤§å®¶è‡ªè¡Œå®‰è£…ï¼Œå…¶ä¸­ prometheus åœ¨å¯åŠ¨çš„æ—¶å€™è¦æ³¨æ„å¼€å¯ --enable-feature=remote-write-receiver ï¼Œå¦‚æžœä¹‹å‰è´µå¸å·²ç»æœ‰ Prometheus äº†ï¼Œä¹Ÿå¯ä»¥ç›´æŽ¥ä½¿ç”¨ï¼Œæ— éœ€å†æ¬¡éƒ¨ç½²ã€‚è¿™é‡Œä¹Ÿæä¾›ä¸€ä¸ªå°è„šæœ¬æ¥å®‰è£…è¿™3ä¸ªç»„ä»¶ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒï¼š\n# install prometheus mkdir -p /opt/prometheus wget https://s3-gz01.didistatic.com/n9e-pub/prome/prometheus-2.28.0.linux-amd64.tar.gz -O prometheus-2.28.0.linux-amd64.tar.gz tar xf prometheus-2.28.0.linux-amd64.tar.gz cp -far prometheus-2.28.0.linux-amd64/* /opt/prometheus/ # service cat \u0026lt;\u0026lt;EOF \u0026gt;/etc/systemd/system/prometheus.service [Unit] Description=\u0026quot;prometheus\u0026quot; Documentation=https://prometheus.io/ After=network.target [Service] Type=simple ExecStart=/opt/prometheus/prometheus --config.file=/opt/prometheus/prometheus.yml --storage.tsdb.path=/opt/prometheus/data --web.enable-lifecycle --enable-feature=remote-write-receiver --query.lookback-delta=2m Restart=on-failure SuccessExitStatus=0 LimitNOFILE=65536 StandardOutput=syslog StandardError=syslog SyslogIdentifier=prometheus [Install] WantedBy=multi-user.target EOF systemctl daemon-reload systemctl enable prometheus systemctl restart prometheus systemctl status prometheus # install mysql yum -y install mariadb* systemctl enable mariadb systemctl restart mariadb mysql -e \u0026quot;SET PASSWORD FOR 'root'@'localhost' = PASSWORD('1234');\u0026quot; # install redis yum install -y redis systemctl enable redis systemctl restart redis  ä¸Šä¾‹ä¸­mysqlçš„rootå¯†ç è®¾ç½®ä¸ºäº†1234ï¼Œå»ºè®®ç»´æŒè¿™ä¸ªä¸å˜ï¼ŒåŽç»­å°±çœåŽ»äº†ä¿®æ”¹é…ç½®æ–‡ä»¶çš„éº»çƒ¦ã€‚\nå®‰è£…å¤œèŽº # mkdir -p /opt/n9e \u0026amp;\u0026amp; cd /opt/n9e # åŽ» https://github.com/didi/nightingale/releases æ‰¾æœ€æ–°ç‰ˆæœ¬çš„åŒ…ï¼Œæ–‡æ¡£é‡Œçš„åŒ…åœ°å€å¯èƒ½å·²ç»ä¸æ˜¯æœ€æ–°çš„äº† tarball=n9e-5.8.0.tar.gz urlpath=https://github.com/didi/nightingale/releases/download/v5.8.0/${tarball} wget $urlpath || exit 1 tar zxvf ${tarball} mysql -uroot -p1234 \u0026lt; docker/initsql/a-n9e.sql nohup ./n9e server \u0026amp;\u0026gt; server.log \u0026amp; nohup ./n9e webapi \u0026amp;\u0026gt; webapi.log \u0026amp; # check logs # check port  å¦‚æžœå¯åŠ¨æˆåŠŸï¼Œserver é»˜è®¤ä¼šç›‘å¬åœ¨ 19000 ç«¯å£ï¼Œwebapi ä¼šç›‘å¬åœ¨ 18000 ç«¯å£ï¼Œä¸”æ—¥å¿—æ²¡æœ‰æŠ¥é”™ã€‚ä¸Šé¢ä½¿ç”¨ nohup ç®€å•æ¼”ç¤ºï¼Œç”Ÿäº§çŽ¯å¢ƒå»ºè®®ç”¨ systemd æ‰˜ç®¡ï¼Œç›¸å…³ service æ–‡ä»¶å¯ä»¥åœ¨ etc/service ç›®å½•ä¸‹ï¼Œä¾›å‚è€ƒï¼Œnohupå’Œsystemdçš„ä½¿ç”¨æ•™ç¨‹\né…ç½®æ–‡ä»¶etc/server.confå’Œetc/webapi.confä¸­éƒ½å«æœ‰ mysql çš„è¿žæŽ¥åœ°å€é…ç½®ï¼Œæ£€æŸ¥ä¸€ä¸‹ç”¨æˆ·åå’Œå¯†ç ï¼Œprometheus å¦‚æžœä½¿ç”¨ä¸Šé¢çš„è„šæœ¬å®‰è£…ï¼Œé»˜è®¤ä¼šç›‘å¬æœ¬æœº 9090 ç«¯å£ï¼Œserver.conf å’Œ webapi.conf ä¸­çš„ prometheus ç›¸å…³åœ°å€éƒ½ä¸ç”¨ä¿®æ”¹å°±æ˜¯å¯¹çš„ï¼Œå¦‚æžœä½¿ç”¨è´µå¸ä¹‹å‰å·²æœ‰çš„ Prometheusï¼Œå°±è¦æ£€æŸ¥è¿™ä¿©é…ç½®æ–‡ä»¶ä¸­çš„æ—¶åºåº“çš„é…ç½®äº†ï¼ŒæŠŠ 127.0.0.1:9090 æ”¹æˆä½ çš„ Prometheusã€‚\nå¥½äº†ï¼Œæµè§ˆå™¨è®¿é—® webapi çš„ç«¯å£ï¼ˆé»˜è®¤æ˜¯18000ï¼‰å°±å¯ä»¥ä½“éªŒç›¸å…³åŠŸèƒ½äº†ï¼Œé»˜è®¤ç”¨æˆ·æ˜¯rootï¼Œå¯†ç æ˜¯root.2020ã€‚å¦‚æžœå®‰è£…è¿‡ç¨‹å‡ºçŽ°é—®é¢˜ï¼Œå¯ä»¥å‚è€ƒå…¬ä¼—å·çš„è§†é¢‘æ•™ç¨‹ã€‚\nå¤œèŽºæœåŠ¡ç«¯éƒ¨ç½²å¥½äº†ï¼Œé»˜è®¤æƒ…å†µä¸‹æ—¶åºåº“ä¸­åªæœ‰å°‘é‡ Prometheus è‡ªèº«çš„æ•°æ®ï¼Œå¤§å®¶å¯ä»¥ç®€å•æµ‹è¯•ã€‚æŽ¥ä¸‹æ¥è¦è€ƒè™‘ç›‘æŽ§æ•°æ®é‡‡é›†çš„é—®é¢˜ï¼Œå¦‚æžœæ˜¯ Prometheus é‡åº¦ç”¨æˆ·ï¼Œå¯ä»¥ç»§ç»­ä½¿ç”¨å„ç±» Exporter æ¥é‡‡é›†ï¼Œåªè¦æ•°æ®è¿›äº†æ—¶åºåº“äº†ï¼Œå¤œèŽºå°±èƒ½å¤Ÿæ¶ˆè´¹ï¼ˆåˆ¤æ–­å‘Šè­¦ã€å±•ç¤ºå›¾è¡¨ç­‰ï¼‰äº†ã€‚å¦‚æžœæ˜¯æ–°ç”¨æˆ·ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨ Categraf ï¼ˆGitlink | Github ï¼‰æ¥é‡‡é›†ï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ Telegrafã€Grafana-agentã€Datadog-agentï¼Œè¿™äº›ç›‘æŽ§é‡‡é›†å™¨éƒ½å¯ä»¥å’Œå¤œèŽºæ— ç¼é›†æˆã€‚\néƒ¨ç½²é›†ç¾¤ # å¦‚æžœæ‹…å¿ƒå®¹é‡é—®é¢˜ï¼Œæˆ–é«˜å¯ç”¨é—®é¢˜ï¼Œå¯ä»¥éƒ¨ç½²å¤œèŽºé›†ç¾¤ï¼Œé™¤äº†å¤œèŽºçš„ä¸¤ä¸ªç»„ä»¶ï¼Œè¿˜æœ‰ä¾èµ–çš„ MySQLã€Redisã€æ—¶åºåº“ï¼Œéƒ½éœ€è¦éƒ¨ç½²é›†ç¾¤ç‰ˆã€‚\nMySQL # MySQL å…¨å±€å°±éƒ¨ç½²ä¸€ä¸ªä¸»ä»Žé›†ç¾¤å°±å¯ä»¥äº†ï¼Œn9e-webapiã€n9e-serveréƒ½è¦è¿žåˆ° MySQL çš„ä¸»åº“ã€‚å»ºè®®ä½¿ç”¨å…¬æœ‰äº‘æä¾›çš„ RDS æœåŠ¡ã€‚\nRedis # å¤œèŽº 5.8.0ï¼ˆå«ï¼‰ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œéƒ½åªæ”¯æŒ standalone çš„ Redisï¼Œä¸ºäº†é«˜å¯ç”¨ï¼Œå»ºè®®ä½¿ç”¨å…¬æœ‰äº‘æä¾›çš„ Redis æœåŠ¡ã€‚ä»Ž 5.9.0 å¼€å§‹ï¼Œå¤œèŽºä¾èµ–çš„ Redis æ”¯æŒ cluster ç‰ˆæœ¬å’Œ sentinel ç‰ˆæœ¬ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œå…¨å±€å°±ä½¿ç”¨ä¸€å¥— Redis å³å¯ã€‚å¦‚æžœ n9e-webapi å’Œ n9e-server æ ¹æ®åœ°åŸŸåšäº†æ‹†åˆ†ï¼Œç‰©ç†è·ç¦»è¾ƒè¿œï¼Œæ¯”å¦‚ä¸€ä¸ªåœ¨å›½å†…ï¼Œä¸€ä¸ªåœ¨ç¾Žä¸œï¼Œæ­¤æ—¶ Redis å°±å»ºè®®æ‹†å¼€ï¼Œn9e-webapi ä¾èµ–ä¸€å¥— Redisï¼Œn9e-server ä¾èµ–å¦ä¸€å¥— Redisï¼Œå¦‚æžœ n9e-server æœ‰å¤šå¥—ï¼Œä¹Ÿå¯ä»¥ä¸ºæ¯å¥— n9e-server éƒ¨ç½²å•ç‹¬çš„ Redisã€‚\næ—¶åºåº“ # æ—¶åºåº“çš„é«˜å¯ç”¨ï¼Œæœ‰ä¸åŒçš„æ–¹æ¡ˆï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨ VictoriaMetrics æˆ– Thanosï¼ŒVictoriaMetrics å¦‚ä½•éƒ¨ç½²é›†ç¾¤ç‰ˆæœ¬ï¼ŒåŽé¢çš„ç« èŠ‚ä¼šæœ‰ä»‹ç»ï¼Œå½“ç„¶å¤§å®¶ä¹Ÿå¯ä»¥æŸ¥çœ‹ VictoriaMetrics çš„å®˜æ–¹æ–‡æ¡£ï¼ŒThanos çš„è¯è¯·å¤§å®¶è‡ªè¡ŒæŸ¥çœ‹ Thanos çš„å®˜æ–¹æ–‡æ¡£ã€‚\nn9e-webapi # é«˜å¯ç”¨å°±æ˜¯éƒ¨ç½²å¤šä¸ªå®žä¾‹å³å¯ï¼Œå„ä¸ªn9e-webapiçš„å®žä¾‹çš„é…ç½®å®Œå…¨ç›¸åŒã€‚å‰é¢æž¶è®¾ nginx æˆ– lvsï¼ŒæŸä¸ª n9e-webapi æŒ‚æŽ‰äº†ï¼Œä¼šè¢« nginxã€lvs è‡ªåŠ¨æ‘˜æŽ‰ï¼Œç”¨æˆ·æ— æ„Ÿ\nn9e-server # é¦–å…ˆï¼Œn9e-server æ˜¯éšç€æ—¶åºåº“èµ°çš„ï¼Œè´µå¸æœ‰å‡ å¥—æ—¶åºåº“ï¼Œå°±è¦éƒ¨ç½²å‡ å¥— n9e-serverï¼Œæ¯å¥— n9e-server è¦å–ä¸ªåå­—ï¼Œåœ¨ server.conf ä¸­æœ‰ä¸ª ClusterName çš„é…ç½®æ¥æ ‡è¯† n9e-server é›†ç¾¤çš„åå­—ï¼Œæ¯å¥— n9e-server å¯ä»¥åªæœ‰ä¸€ä¸ªå®žä¾‹ï¼Œå¯ä»¥æœ‰å¤šä¸ªå®žä¾‹ç»„æˆé›†ç¾¤ï¼Œä¸€å¥— n9e-server é›†ç¾¤å†…çš„å¤šä¸ªå®žä¾‹ï¼Œå…¶ ClusterName è¦ä¿æŒä¸€è‡´ã€‚ä¸åŒçš„ n9e-server é›†ç¾¤ï¼ŒClusterName è¦ä¸åŒã€‚\nå¦‚æžœæœ‰å¤šå¥—æ—¶åºåº“ï¼Œå…¶è¿žæŽ¥ä¿¡æ¯éƒ½è¦é…ç½®åˆ° n9e-webapi çš„é…ç½®æ–‡ä»¶ webapi.conf ä¸­ï¼Œå³é…ç½®å¤šä¸ª [[Clusters]] ï¼Œæ¯ä¸ª Cluster æœ‰ä¸ª Name çš„é…ç½®ï¼Œè¦å’Œ server.conf ä¸­çš„ ClusterName ä¿æŒä¸€è‡´ã€‚\n"}),e.add({id:5,href:"/docs/install/victoria/",title:"VictoriaMetrics",description:"ä½¿ç”¨ VictoriaMetrics ä½œä¸ºå¤œèŽº Nightingale çš„æ—¶åºå­˜å‚¨åº“",content:"ç®€ä»‹ # VictoriaMetrics æž¶æž„ç®€å•ï¼Œå¯é æ€§é«˜ï¼Œåœ¨æ€§èƒ½ï¼Œæˆæœ¬ï¼Œå¯æ‰©å±•æ€§æ–¹é¢è¡¨çŽ°å‡ºè‰²ï¼Œç¤¾åŒºæ´»è·ƒï¼Œä¸”å’Œ Prometheus ç”Ÿæ€ç»‘å®šç´§å¯†ã€‚å¦‚æžœå•æœºç‰ˆæœ¬çš„ Prometheus æ— æ³•åœ¨å®¹é‡ä¸Šæ»¡è¶³è´µå¸çš„éœ€æ±‚ï¼Œå¯ä»¥ä½¿ç”¨ VictoriaMetrics ä½œä¸ºæ—¶åºæ•°æ®åº“ã€‚\nVictoriaMetrics æä¾›å•æœºç‰ˆå’Œé›†ç¾¤ç‰ˆã€‚å¦‚æžœæ‚¨çš„æ¯ç§’å†™å…¥æ•°æ®ç‚¹æ•°å°äºŽ100ä¸‡ï¼ˆè¿™ä¸ªæ•°é‡æ˜¯ä¸ªä»€ä¹ˆæ¦‚å¿µå‘¢ï¼Œå¦‚æžœåªæ˜¯åšæœºå™¨è®¾å¤‡çš„ç›‘æŽ§ï¼Œæ¯ä¸ªæœºå™¨å·®ä¸å¤šé‡‡é›†200ä¸ªæŒ‡æ ‡ï¼Œé‡‡é›†é¢‘çŽ‡æ˜¯10ç§’çš„è¯æ¯å°æœºå™¨æ¯ç§’é‡‡é›†20ä¸ªæŒ‡æ ‡å·¦å³ï¼Œ100ä¸‡/20=5ä¸‡å°æœºå™¨ï¼‰ï¼ŒVictoriaMetrics å®˜æ–¹é»˜è®¤æŽ¨èæ‚¨ä½¿ç”¨å•æœºç‰ˆï¼Œå•æœºç‰ˆå¯ä»¥é€šè¿‡å¢žåŠ æœåŠ¡å™¨çš„CPUæ ¸å¿ƒæ•°ï¼Œå¢žåŠ å†…å­˜ï¼Œå¢žåŠ IOPSæ¥èŽ·å¾—çº¿æ€§çš„æ€§èƒ½æå‡ã€‚ä¸”å•æœºç‰ˆæ˜“äºŽé…ç½®å’Œè¿ç»´ã€‚\né›†ç¾¤æž¶æž„ # vmstorageã€vminsertã€vmselect ä¸‰è€…ç»„åˆæž„æˆ VictoriaMetrics çš„é›†ç¾¤åŠŸèƒ½ï¼Œä¸‰è€…éƒ½å¯ä»¥é€šè¿‡å¯åŠ¨å¤šä¸ªå®žä¾‹æ¥åˆ†æ‹…æ‰¿è½½æµé‡ï¼Œé€šè¿‡è¦åœ¨ vminsert å’Œ vmselect å‰é¢æž¶è®¾è´Ÿè½½å‡è¡¡ã€‚\nvmstorage æ˜¯æ•°æ®å­˜å‚¨æ¨¡å—\n å…¶æ•°æ®ä¿å­˜åœ¨-storageDataPathæŒ‡å®šçš„ç›®å½•ä¸­ï¼Œé»˜è®¤ä¸º./vmstorage-data/ï¼Œvmstorage æ˜¯æœ‰çŠ¶æ€æ¨¡å—ï¼Œåˆ é™¤ storage node ä¼šä¸¢å¤±çº¦ 1/Nçš„åŽ†å²æ•°æ®ï¼ˆN ä¸ºé›†ç¾¤ä¸­ vmstorage node çš„èŠ‚ç‚¹æ•°é‡ï¼‰ã€‚å¢žåŠ  storage nodeï¼Œåˆ™éœ€è¦åŒæ­¥ä¿®æ”¹ vminsert å’Œ vmselect çš„å¯åŠ¨å‚æ•°ï¼Œå°†æ–°åŠ å…¥çš„storage nodeèŠ‚ç‚¹åœ°å€é€šè¿‡å‘½ä»¤è¡Œå‚æ•° -storageNodeä¼ å…¥ç»™vminsertå’Œvmselect vmstorage å¯åŠ¨åŽï¼Œä¼šç›‘å¬ä¸‰ä¸ªç«¯å£ï¼Œåˆ†åˆ«æ˜¯ -httpListenAddr :8482ã€-vminsertAddr :8400ã€-vmselectAddr :8401ã€‚ç«¯å£8400è´Ÿè´£æŽ¥æ”¶æ¥è‡ª vminsert çš„å†™å…¥è¯·æ±‚ï¼Œç«¯å£8401è´Ÿè´£æŽ¥æ”¶æ¥è‡ª vmselect çš„æ•°æ®æŸ¥è¯¢è¯·æ±‚ï¼Œç«¯å£8482åˆ™æ˜¯ vmstorage è‡ªèº«æä¾›çš„ http api æŽ¥å£  vminsert æŽ¥æ”¶æ¥è‡ªå®¢æˆ·ç«¯çš„æ•°æ®å†™å…¥è¯·æ±‚ï¼Œå¹¶è´Ÿè´£è½¬å‘åˆ°é€‰å®šçš„vmstorage\n vminsert æŽ¥æ”¶åˆ°æ•°æ®å†™å…¥è¯·æ±‚åŽï¼ŒæŒ‰ç…§ jump consistent hash ç®—æ³•ï¼Œå°†æ•°æ®è½¬å‘åˆ°é€‰å®šçš„æŸä¸ªvmstorage node ä¸Šã€‚vminsert æœ¬èº«æ˜¯æ— çŠ¶æ€æ¨¡å—ï¼Œå¯ä»¥å¢žåŠ æˆ–è€…åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå®žä¾‹ï¼Œè€Œä¸ä¼šé€ æˆæ•°æ®çš„æŸå¤±ã€‚vminsert æ¨¡å—é€šè¿‡å¯åŠ¨æ—¶çš„å‚æ•° -storageNode xxx,yyy,zzz æ¥æ„ŸçŸ¥åˆ°æ•´ä¸ª vmstorage é›†ç¾¤çš„å®Œæ•´ node åœ°å€åˆ—è¡¨ vminsert å¯åŠ¨åŽï¼Œä¼šç›‘å¬ä¸€ä¸ªç«¯å£-httpListenAddr :8480ã€‚è¯¥ç«¯å£å®žçŽ°äº† prometheus remote_writeåè®®ï¼Œå› æ­¤å¯ä»¥æŽ¥æ”¶å’Œè§£æžé€šè¿‡ remote_write åè®®å†™å…¥çš„æ•°æ®ã€‚ä¸è¿‡è¦æ³¨æ„ï¼ŒVictoriaMetrics é›†ç¾¤ç‰ˆæœ¬å…·æœ‰å¤šç§Ÿæˆ·åŠŸèƒ½ï¼Œå› æ­¤ç§Ÿæˆ·IDä¼šä»¥å¦‚ä¸‹å½¢å¼å‡ºçŽ°åœ¨ API URL ä¸­: http://vminsert:8480/insert/\u0026lt;account_id\u0026gt;/prometheus/api/v1/write æ›´å¤š URL Format å¯ä»¥å‚è€ƒ VictoriaMetricså®˜ç½‘  vmselect æŽ¥æ”¶æ¥è‡ªå®¢æˆ·ç«¯çš„æ•°æ®æŸ¥è¯¢è¯·æ±‚ï¼Œå¹¶è´Ÿè´£è½¬å‘åˆ°æ‰€æœ‰çš„ vmstorage æŸ¥è¯¢ç»“æžœï¼Œæœ€åŽå°†ç»“æžœ merge åŽè¿”å›ž\n vmselect å¯åŠ¨åŽï¼Œä¼šç›‘å¬ä¸€ä¸ªç«¯å£-httpListenAddr :8481ã€‚è¯¥ç«¯å£å®žçŽ°äº† prometheus queryç›¸å…³çš„æŽ¥å£ã€‚ä¸è¿‡è¦æ³¨æ„ï¼ŒVictoriaMetrics é›†ç¾¤ç‰ˆæœ¬å…·æœ‰å¤šç§Ÿæˆ·åŠŸèƒ½ï¼Œå› æ­¤ç§Ÿæˆ·IDä¼šä»¥å¦‚ä¸‹å½¢å¼å‡ºçŽ°åœ¨ API URL ä¸­: http://vminsert:8481/select/\u0026lt;account_id\u0026gt;/prometheus/api/v1/queryã€‚ æ›´å¤š URL Format å¯ä»¥å‚è€ƒ VictoriaMetricså®˜ç½‘  å®‰è£…éƒ¨ç½² # 1ã€ åŽ» vm release ä¸‹è½½ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶ç‰ˆæœ¬ï¼Œæ¯”å¦‚æˆ‘ä»¬é€‰æ‹©ä¸‹è½½ v1.69.0 amd64ã€‚\n2ã€ è§£åŽ‹ç¼©åŽå¾—åˆ°ï¼š\n$ ls -l vm*-prod -rwxr-xr-x 1 work work 10946416 Nov 8 22:03 vminsert-prod* -rwxr-xr-x 1 work work 13000624 Nov 8 22:03 vmselect-prod* -rwxr-xr-x 1 work work 11476736 Nov 8 22:03 vmstorage-prod*  3ã€ å¯åŠ¨ä¸‰ä¸ª vmstorage å®žä¾‹ï¼ˆå¯ä»¥ç”¨ä¸‹é¢çš„è„šæœ¬å¿«é€Ÿç”Ÿæˆä¸åŒå®žä¾‹çš„å¯åŠ¨å‘½ä»¤ï¼‰\n#!/bin/bash for i in `seq 0 2`; do if [ $i -eq 0 ]; then i=\u0026quot;\u0026quot; fi pp=$i httpListenAddr=${pp}8482 vminsertAddr=${pp}8400 vmselectAddr=${pp}8401 storageDataPath=./${pp}vmstorage-data prog=\u0026quot;nohup ./vmstorage-prod -loggerTimezone Asia/Shanghai \\ -storageDataPath $storageDataPath \\ -httpListenAddr :$httpListenAddr \\ -vminsertAddr :$vminsertAddr \\ -vmselectAddr :$vmselectAddr \\ \u0026amp;\u0026gt; ${pp}vmstor.log \u0026amp;\u0026quot; echo $prog (exec \u0026quot;$prog\u0026quot;) done  ä¹Ÿå¯ä»¥è¾“å…¥ä»¥ä¸‹å‘½ä»¤è¡Œå¯åŠ¨ä¸‰ä¸ªå®žä¾‹ï¼š\nnohup ./vmstorage-prod -loggerTimezone Asia/Shanghai -storageDataPath ./vmstorage-data -httpListenAddr :8482 -vminsertAddr :8400 -vmselectAddr :8401 \u0026amp;\u0026gt; vmstor.log \u0026amp; nohup ./vmstorage-prod -loggerTimezone Asia/Shanghai -storageDataPath ./1vmstorage-data -httpListenAddr :18482 -vminsertAddr :18400 -vmselectAddr :18401 \u0026amp;\u0026gt; 1vmstor.log \u0026amp; nohup ./vmstorage-prod -loggerTimezone Asia/Shanghai -storageDataPath ./2vmstorage-data -httpListenAddr :28482 -vminsertAddr :28400 -vmselectAddr :28401 \u0026amp;\u0026gt; 2vmstor.log \u0026amp;  4ã€ å¯åŠ¨ä¸€ä¸ª vminsert å®žä¾‹ï¼š\nnohup ./vminsert-prod -httpListenAddr :8480 -storageNode=127.0.0.1:8400,127.0.0.1:18400,127.0.0.1:28400 \u0026amp;\u0026gt;vminsert.log \u0026amp;  5ã€ å¯åŠ¨ä¸€ä¸ª vmselect å®žä¾‹ï¼š\nnohup ./vmselect-prod -httpListenAddr :8481 -storageNode=127.0.0.1:8401,127.0.0.1:18401,127.0.0.1:28401 \u0026amp;\u0026gt;vmselect.log \u0026amp;  6ã€ æŸ¥çœ‹ vmstorageï¼Œvminsertï¼Œvmselect çš„ /metrics æŽ¥å£:\ncurl http://127.0.0.1:8482/metrics curl http://127.0.0.1:18482/metrics curl http://127.0.0.1:28482/metrics curl http://127.0.0.1:8481/metrics curl http://127.0.0.1:8480/metrics  7ã€ n9e-server é€šè¿‡ remote write åè®®å†™å…¥æ—¶åºåº“ï¼ŒVictoriaMetrics ä½œä¸ºæ—¶åºåº“çš„ä¸€ä¸ªé€‰æ‹©ï¼Œå…¶ remote write æŽ¥å£åœ°å€ä¸ºï¼šhttp://127.0.0.1:8480/insert/0/prometheus/api/v1/write æŠŠè¿™ä¸ªåœ°å€é…ç½®åˆ° server.conf å½“ä¸­ï¼Œé…ç½®å®Œäº†é‡å¯ n9e-server\n# Readeréƒ¨åˆ†ä¿®æ”¹Url [Reader] Url = \u0026quot;http://172.21.0.8:8481/select/0/prometheus\u0026quot; # Writerséƒ¨åˆ†ä¿®æ”¹Url [[Writers]] Url = \u0026quot;http://172.21.0.8:8480/insert/0/prometheus/api/v1/write\u0026quot;  8ã€ ä¿®æ”¹ n9e-webapi çš„é…ç½®æ–‡ä»¶ ./etc/webapi.conf å¦‚ä¸‹ï¼š\n[[Clusters]] # Prometheus cluster name Name = \u0026quot;Default\u0026quot; # Prometheus APIs base url Prom = \u0026quot;http://127.0.0.1:8481/select/0/prometheus\u0026quot;  ç„¶åŽï¼Œé‡å¯ n9e-webapiï¼Œè¿™æ ·å¤œèŽºå°±å¯ä»¥æŸ¥è¯¢åˆ° VictoriaMetrics é›†ç¾¤çš„æ•°æ®äº†ã€‚\nå¦‚æžœæ‚¨ä½¿ç”¨çš„æ˜¯ VictoriaMetrics å•æœºç‰ˆï¼Œç«¯å£æ˜¯ 8428ï¼Œæ•…è€Œ Nightingale çš„é…ç½®æ–‡ä»¶éœ€è¦åšå¦‚ä¸‹è°ƒæ•´ï¼š\n# server.conf # Readeréƒ¨åˆ†ä¿®æ”¹ä¸ºï¼š [Reader] Url = \u0026quot;http://127.0.0.1:8428\u0026quot; # Writerséƒ¨åˆ†ä¿®æ”¹ä¸ºï¼š [[Writers]] Url = \u0026quot;http://127.0.0.1:8428/api/v1/write\u0026quot;  # webapi.conf # Clusterséƒ¨åˆ†ä¿®æ”¹ä¸ºï¼š [[Clusters]] Name = \u0026quot;Default\u0026quot; Prom = \u0026quot;http://127.0.0.1:8428\u0026quot;  FAQ # VictoriaMetrics å•æœºç‰ˆæœ¬å¦‚ä½•ä¿éšœæ•°æ®çš„å¯é æ€§ï¼Ÿ\nvm é’ˆå¯¹ç£ç›˜IOæœ‰é’ˆå¯¹æ€§çš„ä¼˜åŒ–ï¼Œå•æœºç‰ˆå¯ä»¥è€ƒè™‘å°†æ•°æ®çš„å¯é æ€§ä¿éšœäº¤ç»™ EBS ç­‰äº‘ç›˜æ¥ä¿è¯ã€‚\nVictoriaMetrics å¦‚ä½•è¯„ä¼°å®¹é‡ï¼Ÿ\nå‚è€ƒvmçš„å®˜æ–¹æ–‡æ¡£ã€‚\nVictoriaMetrics é›†ç¾¤ç‰ˆæœ¬å¢žåŠ æˆ–è€…åˆ é™¤ vmstorage node çš„æ—¶å€™ï¼Œæ•°æ®å¦‚ä½•å†å¹³è¡¡ï¼Ÿ\nvm ä¸æ”¯æŒæ‰©ç¼©å®¹èŠ‚ç‚¹æ—¶ï¼Œå¯¹æ•°æ®è¿›è¡Œè‡ªåŠ¨çš„å†å¹³è¡¡ã€‚\nVictoriaMetrics çš„æ•°æ®å¤§å°å¦‚ä½•æŸ¥çœ‹ï¼Ÿ\nå¯ä»¥é€šè¿‡ vmstorage å®žä¾‹æš´éœ²çš„ /metrics æŽ¥å£æ¥èŽ·å–åˆ°ç›¸åº”çš„ç»Ÿè®¡æ•°æ®ï¼Œè­¬å¦‚ï¼š\n$ curl http://127.0.0.1:8482/metrics |grep -i data_size vm_data_size_bytes{type=\u0026quot;indexdb\u0026quot;} 609291 vm_data_size_bytes{type=\u0026quot;storage/big\u0026quot;} 0 vm_data_size_bytes{type=\u0026quot;storage/small\u0026quot;} 8749893  vminsert åœ¨å°†æ•°æ®å†™å…¥å¤šä¸ª vmstorage nodeçš„æ—¶å€™ï¼Œæ˜¯æŒ‰ç…§ä»€ä¹ˆè§„åˆ™å°†æ•°æ®å†™å…¥åˆ°ä¸åŒçš„ node ä¸Šçš„ï¼Ÿ\né‡‡ç”¨ jump consistent hash å¯¹æ•°æ®è¿›è¡Œåˆ†ç‰‡ï¼Œå†™å…¥åˆ°ç›¸åº”çš„ storage node ä¸Šã€‚\nvmselect åœ¨æŽ¥åˆ°æŸ¥è¯¢è¯·æ±‚çš„æ—¶å€™ï¼Œå¦‚ä½•å®šä½åˆ°è¯·æ±‚çš„æ•°æ®æ˜¯åœ¨å“ªä¸ª storage nodeä¸Šçš„ï¼Ÿ\nvmselect å¹¶ä¸çŸ¥é“æ¯ä¸ª metrics å¯¹åº”çš„æ•°æ®åˆ†å¸ƒçš„ storage nodeï¼Œvmselect ä¼šå¯¹æ‰€æœ‰çš„ storage node å‘èµ·æŸ¥è¯¢è¯·æ±‚ï¼Œæœ€åŽè¿›è¡Œæ•°æ®åˆå¹¶ï¼Œå¹¶è¿”å›žã€‚\nVictoriaMetrics å’Œ M3db çš„å¯¹æ¯”å’Œé€‰æ‹©ï¼Ÿ\nm3db æž¶æž„è®¾è®¡ä¸Šæ›´é«˜çº§ï¼Œå®žçŽ°éš¾åº¦é«˜ï¼Œm3db åœ¨æ—¶åºæ•°æ®åŠŸèƒ½ä¹‹åŽï¼Œé‡ç‚¹è§£å†³äº†è‡ªåŠ¨æ‰©ç¼©å®¹ï¼Œæ•°æ®è‡ªåŠ¨å¹³è¡¡ç­‰è¿ç»´éš¾é¢˜ã€‚ä½†æ˜¯å› æ­¤ä¹Ÿæ›´å¤æ‚ï¼Œå¯é æ€§ä¹Ÿæ›´éš¾ä¿è¯ã€‚VictoriaMetrics æž¶æž„è®¾è®¡ä¸Šæ›´å€¾å‘äºŽç®€å•å¯é ï¼Œé‡ç‚¹ä¼˜åŒ–äº†å•æœºç‰ˆçš„æ€§èƒ½ï¼Œå¼ºè°ƒåž‚ç›´æ‰©å±•ï¼ŒåŒæ—¶å’Œ prometheus ç”Ÿæ€åšåˆ°å…¼å®¹ï¼Œç”šè‡³äºŽåœ¨å¾ˆå¤šçš„ç‚¹ä¸Šåšåˆ°äº†åŠ å¼ºã€‚ä½†æ˜¯ VictoriaMetrics å¯¹äºŽæ—¶åºæ•°æ® downsampleï¼ŒèŠ‚ç‚¹çš„è‡ªåŠ¨æ‰©ç¼©å®¹ï¼Œæ•°æ®è‡ªåŠ¨å†å¹³è¡¡ç­‰é«˜çº§åŠŸèƒ½å’Œåˆ†å¸ƒå¼èƒ½åŠ›ï¼Œæ˜¯æœ‰ç¼ºå¤±çš„ã€‚\nç›¸å…³èµ„æ–™ #  ä½¿ç”¨ Docker Compose å¿«é€Ÿéƒ¨ç½² VictoriaMetrics ä½¿ç”¨ Helm Chart å¿«é€Ÿåœ¨ Kubernetesä¸­éƒ¨ç½² VictoriaMetrics ä½¿ç”¨ VictoriaMetrics Operator åœ¨ Kubernetesä¸­éƒ¨ç½² VictoriaMetrics  "}),e.add({id:6,href:"/docs/install/ibex/",title:"Ibex",description:"å¤œèŽº Nightingale çš„å‘Šè­¦è‡ªæ„ˆæ¨¡å—çš„å®‰è£…",content:"Ibex æ˜¯å‘Šè­¦è‡ªæ„ˆåŠŸèƒ½ä¾èµ–çš„æ¨¡å—ï¼Œæä¾›ä¸€ä¸ªæ‰¹é‡æ‰§è¡Œå‘½ä»¤çš„é€šé“ï¼Œå¯ä»¥åšåˆ°åœ¨å‘Šè­¦çš„æ—¶å€™è‡ªåŠ¨åŽ»ç›®æ ‡æœºå™¨æ‰§è¡Œè„šæœ¬ï¼Œå¦‚æžœå¤§å®¶æ²¡æœ‰æ­¤éœ€æ±‚ï¼Œæ— éœ€é˜…è¯»æœ¬èŠ‚å†…å®¹ã€‚\næ¦‚è¿° # æ‰€è°“çš„å‘Šè­¦è‡ªæ„ˆï¼Œå…¸åž‹æ‰‹æ®µæ˜¯åœ¨å‘Šè­¦è§¦å‘æ—¶è‡ªåŠ¨å›žè°ƒæŸä¸ª webhook åœ°å€ï¼Œåœ¨è¿™ä¸ª webhook é‡Œå†™å‘Šè­¦è‡ªæ„ˆçš„é€»è¾‘ï¼Œå¤œèŽºé»˜è®¤æ”¯æŒè¿™ç§æ–¹å¼ã€‚å¦å¤–ï¼Œå¤œèŽºè¿˜å¯ä»¥æ›´è¿›ä¸€æ­¥ï¼Œé…åˆ ibex è¿™ä¸ªæ¨¡å—ï¼Œåœ¨å‘Šè­¦è§¦å‘çš„æ—¶å€™ï¼Œè‡ªåŠ¨åŽ»å‘Šè­¦çš„æœºå™¨æ‰§è¡ŒæŸä¸ªè„šæœ¬ï¼Œè¿™ç§æœºåˆ¶å¯ä»¥å¤§å¹…ç®€åŒ–æž„å»ºè¿ç»´è‡ªæ„ˆé“¾è·¯çš„å·¥ä½œé‡ï¼Œæ¯•ç«Ÿï¼Œä¸æ˜¯æ‰€æœ‰çš„è¿ç»´äººå‘˜éƒ½æ“…é•¿å†™ http serverï¼Œä½†æ‰€æœ‰çš„è¿ç»´äººå‘˜ï¼Œéƒ½æ“…é•¿å†™è„šæœ¬ã€‚è¿™ç§æ–¹å¼æ˜¯å…¸åž‹çš„ç‰©ç†æœºæ—¶ä»£çš„äº§ç‰©ï¼Œå¸Œæœ›å„ä½æœ‹å‹ç”¨ä¸åˆ°è¿™ä¸ªå·¥å…·ï¼ˆè¯´æ˜Žè´µå¸çš„ITæŠ€æœ¯å·²ç»èµ°å¾—éžå¸¸é å‰äº†ï¼‰ã€‚\næž¶æž„ # ibex åŒ…æ‹¬ server å’Œ agentd ä¸¤ä¸ªæ¨¡å—ï¼Œagentd å‘¨æœŸæ€§è°ƒç”¨ server çš„ rpc æŽ¥å£ï¼Œè¯¢é—®æœ‰å“ªäº›ä»»åŠ¡è¦æ‰§è¡Œï¼Œå¦‚æžœæœ‰åˆ†é…ç»™è‡ªå·±çš„ä»»åŠ¡ï¼Œå°±ä»Ž server æ‹¿åˆ°ä»»åŠ¡è„šæœ¬ä¿¡æ¯ï¼Œåœ¨æœ¬åœ° fork ä¸€ä¸ªè¿›ç¨‹è¿è¡Œï¼Œç„¶åŽå°†ç»“æžœä¸ŠæŠ¥ç»™æœåŠ¡ç«¯ã€‚ä¸ºäº†ç®€åŒ–éƒ¨ç½²ï¼Œserver å’Œ agentd èžåˆæˆäº†ä¸€ä¸ªäºŒè¿›åˆ¶ï¼Œå°±æ˜¯ ibexï¼Œé€šè¿‡ä¼ å…¥ä¸åŒçš„å‚æ•°æ¥å¯åŠ¨ä¸åŒçš„è§’è‰²ã€‚ibex æž¶æž„å›¾å¦‚ä¸‹ï¼š\né¡¹ç›®åœ°å€ #  Repoï¼šhttps://github.com/flashcatcloud/ibex Linux-amd64 æœ‰ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶ï¼Œåœ¨è¿™é‡Œ  å®‰è£…å¯åŠ¨ # ä¸‹è½½å®‰è£…åŒ…ä¹‹åŽï¼Œè§£åŽ‹ç¼©ï¼Œåœ¨ etc ä¸‹å¯ä»¥æ‰¾åˆ°æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„é…ç½®æ–‡ä»¶ï¼Œåœ¨ sql ç›®å½•ä¸‹å¯ä»¥æ‰¾åˆ°åˆå§‹åŒ– sql è„šæœ¬ã€‚\nåˆå§‹åŒ– sql # mysql \u0026lt; sql/ibex.sql  å¯åŠ¨ server # server çš„é…ç½®æ–‡ä»¶æ˜¯ etc/server.confï¼Œæ³¨æ„ä¿®æ”¹é‡Œè¾¹çš„ mysql è¿žæŽ¥åœ°å€ï¼Œé…ç½®æ­£ç¡®çš„ mysql ç”¨æˆ·åå’Œå¯†ç ã€‚ç„¶åŽå°±å¯ä»¥ç›´æŽ¥å¯åŠ¨äº†ï¼š\nnohup ./ibex server \u0026amp;\u0026gt; server.log \u0026amp;  ibex æ²¡æœ‰ web é¡µé¢ï¼Œåªæä¾› api æŽ¥å£ï¼Œé‰´æƒæ–¹å¼æ˜¯ http basic authï¼Œbasic auth çš„ç”¨æˆ·åå’Œå¯†ç é»˜è®¤éƒ½æ˜¯ ibexï¼Œåœ¨ etc/server.conf ä¸­å¯ä»¥æ‰¾åˆ°ï¼Œå¦‚æžœibex éƒ¨ç½²åœ¨äº’è”ç½‘ï¼Œä¸€å®šè¦ä¿®æ”¹é»˜è®¤ç”¨æˆ·åå’Œå¯†ç ï¼Œå½“ç„¶ï¼Œå› ä¸º Nightingale è¦è°ƒç”¨ ibexï¼Œæ‰€ä»¥ Nightingale çš„ server.conf å’Œ webapi.conf ä¸­ä¹Ÿé…ç½®äº† ibex çš„ basic auth è´¦å·ä¿¡æ¯ï¼Œè¦æ”¹å°±è¦ä¸€èµ·æ”¹å•¦ã€‚\nå¯åŠ¨agentd # å®¢æˆ·ç«¯çš„é…ç½®éžå¸¸éžå¸¸ç®€å•ï¼Œagentd.conf å†…å®¹å¦‚ä¸‹ï¼š\n# debug, release RunMode = \u0026quot;release\u0026quot; # task meta storage dir MetaDir = \u0026quot;./meta\u0026quot; [Heartbeat] # unit: ms Interval = 1000 # rpc servers Servers = [\u0026quot;10.2.3.4:20090\u0026quot;] # $ip or $hostname or specified string Host = \u0026quot;telegraf01\u0026quot;  é‡ç‚¹å…³æ³¨ Heartbeat è¿™ä¸ªéƒ¨åˆ†ï¼ŒInterval æ˜¯å¿ƒè·³é¢‘çŽ‡ï¼Œé»˜è®¤æ˜¯ 1000 æ¯«ç§’ï¼Œå¦‚æžœæœºå™¨é‡æ¯”è¾ƒå°ï¼Œæ¯”å¦‚å°äºŽ 1000 å°ï¼Œç»´æŒ 1000 æ¯«ç§’æ²¡é—®é¢˜ï¼Œå¦‚æžœæœºå™¨é‡æ¯”è¾ƒå¤§ï¼Œå¯ä»¥é€‚å½“è°ƒå¤§è¿™ä¸ªé¢‘çŽ‡ï¼Œæ¯”å¦‚ 2000 æˆ–è€… 3000ï¼Œå¯ä»¥å‡è½»æœåŠ¡ç«¯çš„åŽ‹åŠ›ã€‚Servers æ˜¯ä¸ªæ•°ç»„ï¼Œé…ç½®çš„æ˜¯ ibex-server çš„åœ°å€ï¼Œibex-server å¯ä»¥å¯åŠ¨å¤šä¸ªï¼Œå¤šä¸ªåœ°å€éƒ½é…ç½®åˆ°è¿™é‡Œå³å¯ï¼ŒHost è¿™ä¸ªå­—æ®µï¼Œæ˜¯æœ¬æœºçš„å”¯ä¸€æ ‡è¯†ï¼Œæœ‰ä¸‰ç§é…ç½®æ–¹å¼ï¼Œå¦‚æžœé…ç½®ä¸º $ipï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æŽ¢æµ‹æœ¬æœºçš„ IPï¼Œå¦‚æžœæ˜¯ $hostnameï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æŽ¢æµ‹æœ¬æœºçš„ hostnameï¼Œå¦‚æžœæ˜¯å…¶ä»–å­—ç¬¦ä¸²ï¼Œé‚£å°±ç›´æŽ¥æŠŠè¯¥å­—ç¬¦ä¸²ä½œä¸ºæœ¬æœºçš„å”¯ä¸€æ ‡è¯†ã€‚æ¯ä¸ªæœºå™¨ä¸Šéƒ½è¦éƒ¨ç½² ibex-agentdï¼Œä¸åŒçš„æœºå™¨è¦ä¿è¯ Host å­—æ®µèŽ·å–çš„å†…å®¹ä¸èƒ½é‡å¤ã€‚\nè¦æƒ³åšåˆ°å‘Šè­¦çš„æœºå™¨è‡ªåŠ¨æ‰§è¡Œè„šæœ¬ï¼Œéœ€è¦ä¿è¯å‘Šè­¦æ¶ˆæ¯ä¸­çš„ ident è¡¨ç¤ºæœºå™¨æ ‡è¯†ï¼Œä¸”å’Œ ibex-agentd ä¸­çš„ Host é…ç½®å¯¹åº”ä¸Šã€‚\nä¸‹é¢æ˜¯å¯åŠ¨ ibex-agentd çš„å‘½ä»¤ï¼š\nnohup ./ibex agentd \u0026amp;\u0026gt; agentd.log \u0026amp;  å¦å¤–ï¼Œç»†å¿ƒçš„è¯»è€…åº”è¯¥ä¼šå‘çŽ° ibex çš„åŽ‹ç¼©åŒ…é‡Œçš„ etc ç›®å½•ä¸‹æœ‰ä¸ª service ç›®å½•ï¼Œé‡Œè¾¹å‡†å¤‡å¥½äº†ä¸¤ä¸ª service æ ·ä¾‹æ–‡ä»¶ï¼Œä¾¿äºŽå¤§å®¶ä½¿ç”¨ systemd æ¥ç®¡ç† ibex è¿›ç¨‹ï¼Œç”Ÿäº§çŽ¯å¢ƒï¼Œå»ºè®®ä½¿ç”¨ systemd æ¥ç®¡ç†ã€‚nohupå’Œsystemdçš„çŸ¥è¯†\n"}),e.add({id:7,href:"/docs/agent/categraf/",title:"Categraf",description:"Categrafæ˜¯ä¸€æ¬¾all-in-oneçš„é‡‡é›†å™¨ï¼Œæ˜¯å¤œèŽºä¸»æŽ¨çš„ä¸€æ¬¾ç›‘æŽ§å®¢æˆ·ç«¯",content:"Categraf æ˜¯ä¸€æ¬¾ all-in-one çš„é‡‡é›†å™¨ï¼Œç”± å¿«çŒ«å›¢é˜Ÿ å¼€æºï¼Œä»£ç æ‰˜ç®¡åœ¨ä¸¤ä¸ªåœ°æ–¹ï¼š\n gitlink: https://www.gitlink.org.cn/flashcat/categraf github: https://github.com/flashcatcloud/categraf  Categraf ä¸ä½†å¯ä»¥é‡‡é›† OSã€MySQLã€Redisã€Oracle ç­‰å¸¸è§çš„ç›‘æŽ§å¯¹è±¡ï¼Œä¹Ÿå‡†å¤‡æä¾›æ—¥å¿—é‡‡é›†èƒ½åŠ›å’Œ trace æŽ¥æ”¶èƒ½åŠ›ï¼Œè¿™æ˜¯å¤œèŽºä¸»æŽ¨çš„é‡‡é›†å™¨ï¼Œç›¸å…³ä¿¡æ¯è¯·æŸ¥é˜…é¡¹ç›® README\nCategraf é‡‡é›†åˆ°æ•°æ®ä¹‹åŽï¼Œé€šè¿‡ remote write åè®®æŽ¨ç»™è¿œç«¯å­˜å‚¨ï¼ŒNightingale æ°æ°æä¾›äº† remote write åè®®çš„æ•°æ®æŽ¥æ”¶æŽ¥å£ï¼Œæ‰€ä»¥äºŒè€…å¯ä»¥æ•´åˆåœ¨ä¸€èµ·ï¼Œé‡ç‚¹æ˜¯é…ç½® Categraf çš„ conf/config.toml ä¸­çš„ writer éƒ¨åˆ†ï¼Œå…¶ä¸­ url éƒ¨åˆ†é…ç½®ä¸º n9e-server çš„ remote write æŽ¥å£ï¼š\n[writer_opt] # default: 2000 batch = 2000 # channel(as queue) size chan_size = 10000 [[writers]] url = \u0026quot;http://N9E-SERVER:19000/prometheus/v1/write\u0026quot; # Basic auth username basic_auth_user = \u0026quot;\u0026quot; # Basic auth password basic_auth_pass = \u0026quot;\u0026quot; # timeout settings, unit: ms timeout = 5000 dial_timeout = 2500 max_idle_conns_per_host = 100  "}),e.add({id:8,href:"/docs/agent/telegraf/",title:"Telegraf",description:"Telegraf æŽ¥å…¥å¤œèŽº Nightingale",content:"Telegraf æ˜¯ InfluxData å…¬å¸å¼€æºçš„ä¸€æ¬¾é‡‡é›†å™¨ï¼Œå†…ç½®éžå¸¸å¤šçš„é‡‡é›†æ’ä»¶ï¼Œä¸è¿‡ Telegraf æ˜¯é¢å‘ InfluxDB ç”Ÿæ€çš„ï¼Œé‡‡é›†çš„ç›‘æŽ§æ•°æ®æŽ¨ç»™ InfluxDB éžå¸¸åˆé€‚ï¼ŒæŽ¨ç»™ Prometheusã€Victoriametricsã€Thanos è¿™äº›æ—¶åºåº“ï¼Œå¯èƒ½ä¼šå¸¦æ¥é—®é¢˜ã€‚ä¸»è¦æ˜¯ä¸¤ç‚¹ï¼š\n æœ‰äº›æ•°æ®æ˜¯ string ç±»åž‹çš„ï¼ŒPrometheusã€VMã€M3ã€Thanos ç­‰éƒ½ä¸æ”¯æŒ string ç±»åž‹çš„æ•°æ® æœ‰äº›é‡‡é›†å™¨è®¾è®¡çš„æ ‡ç­¾æ˜¯éžç¨³æ€çš„è®¾è®¡ï¼Œæ¯”å¦‚ç»å¸¸ä¼šçœ‹åˆ° result=success å’Œ result=failed çš„æ ‡ç­¾ï¼Œéœ€è¦æ‰‹å·¥é…ç½®é‡‡é›†å™¨ drop æŽ‰ï¼Œä½†æ˜¯å¯¹äºŽæ–°æ‰‹ç¡®å®žæœ‰äº›éš¾åº¦  å¦å¤–ä¸€ä¸ªé—®é¢˜æ˜¯ï¼ŒTelegraf é‡‡é›†çš„æ•°æ®å­˜åˆ° Prometheus ä¸­ï¼Œè¿™ç§åšæ³•åœ¨ä¸šç•Œå®žè·µçš„æ¯”è¾ƒå°‘ï¼Œå¯¼è‡´ Grafana å¤§ç›˜å¾ˆå°‘ï¼Œéœ€è¦æˆ‘ä»¬ä»˜å‡ºè¾ƒå¤§ç²¾åŠ›æ‰‹å·¥åˆ¶ä½œå¤§ç›˜ã€‚ä¸è¿‡ï¼Œå¦‚æžœï¼Œä½ æ˜¯èµ„æ·±ç›‘æŽ§çŽ©å®¶ï¼ŒTelegraf ä¸Šé¢è¿™äº›é—®é¢˜éƒ½ä¸æ˜¯é—®é¢˜ã€‚ä¸‹é¢æ˜¯ç¬”è€…ä¹‹å‰è°ƒç ” Telegraf çš„å‡ ç¯‡ç¬”è®°ï¼Œä¾›å¤§å®¶å‚è€ƒï¼š\n Telegrafç›‘æŽ§å®¢æˆ·ç«¯è°ƒç ”ç¬”è®°ï¼ˆ1ï¼‰-ä»‹ç»ã€å®‰è£…ã€åˆæ­¥æµ‹è¯• Telegrafç›‘æŽ§å®¢æˆ·ç«¯è°ƒç ”ç¬”è®°ï¼ˆ2ï¼‰-CPUã€MEMã€DISKã€IOç›¸å…³æŒ‡æ ‡é‡‡é›† Telegrafç›‘æŽ§å®¢æˆ·ç«¯è°ƒç ”ç¬”è®°ï¼ˆ3ï¼‰-kernelã€systemã€processesç›¸å…³æŒ‡æ ‡é‡‡é›† Telegrafç›‘æŽ§å®¢æˆ·ç«¯è°ƒç ”ç¬”è®°ï¼ˆ4ï¼‰-execã€netã€netstatç›¸å…³æŒ‡æ ‡é‡‡é›† Telegrafç›‘æŽ§å®¢æˆ·ç«¯è°ƒç ”ç¬”è®°ï¼ˆ5ï¼‰-æœ¬åœ°ç«¯å£ç›‘æŽ§\u0026amp;è¿œç¨‹TCPæŽ¢æµ‹ Telegrafç›‘æŽ§å®¢æˆ·ç«¯è°ƒç ”ç¬”è®°ï¼ˆ6ï¼‰-PINGç›‘æŽ§ã€è¿›ç¨‹ç›‘æŽ§  Telegraf æ˜¯å¦‚ä½•ä¸Ž Nightingale æ•´åˆçš„å‘¢ï¼ŸTelegraf æœ‰ä¸åŒçš„ output pluginï¼Œå¯ä»¥æŠŠé‡‡é›†çš„æ•°æ®æŽ¨ç»™ OpenTSDBã€æŽ¨ç»™ Datadogï¼ŒNightingale å®žçŽ°äº† OpenTSDB å’Œ Datadog è¿™ä¸¤ç§æ¶ˆæ¯æŽ¥æ”¶æŽ¥å£ï¼Œæ‰€ä»¥ï¼Œå¯ä»¥é€šè¿‡ä»»ä¸€ output plugin å’Œ Nightingale å¯¹æŽ¥ã€‚ä¸‹é¢æä¾›ä¸€ä¸ªç®€å•çš„ Telegraf é…ç½®ä¾›å¤§å®¶å‚è€ƒï¼Œä½¿ç”¨ OpenTSDB çš„ output plugin å’Œ Nightingale å¯¹æŽ¥ï¼Œå³ [[outputs.opentsdb]] é…ç½®æ®µï¼Œhost éƒ¨åˆ†é…ç½®ä¸º n9e-server çš„åœ°å€ï¼š\n#!/bin/sh version=1.20.4 tarball=telegraf-${version}_linux_amd64.tar.gz wget https://dl.influxdata.com/telegraf/releases/$tarball tar xzvf $tarball mkdir -p /opt/telegraf cp -far telegraf-${version}/usr/bin/telegraf /opt/telegraf cat \u0026lt;\u0026lt;EOF \u0026gt; /opt/telegraf/telegraf.conf [global_tags] [agent] interval = \u0026quot;10s\u0026quot; round_interval = true metric_batch_size = 1000 metric_buffer_limit = 10000 collection_jitter = \u0026quot;0s\u0026quot; flush_interval = \u0026quot;10s\u0026quot; flush_jitter = \u0026quot;0s\u0026quot; precision = \u0026quot;\u0026quot; hostname = \u0026quot;\u0026quot; omit_hostname = false [[outputs.opentsdb]] host = \u0026quot;http://127.0.0.1\u0026quot; port = 19000 http_batch_size = 50 http_path = \u0026quot;/opentsdb/put\u0026quot; debug = false separator = \u0026quot;_\u0026quot; [[inputs.cpu]] percpu = true totalcpu = true collect_cpu_time = false report_active = true [[inputs.disk]] ignore_fs = [\u0026quot;tmpfs\u0026quot;, \u0026quot;devtmpfs\u0026quot;, \u0026quot;devfs\u0026quot;, \u0026quot;iso9660\u0026quot;, \u0026quot;overlay\u0026quot;, \u0026quot;aufs\u0026quot;, \u0026quot;squashfs\u0026quot;] [[inputs.diskio]] [[inputs.kernel]] [[inputs.mem]] [[inputs.processes]] [[inputs.system]] fielddrop = [\u0026quot;uptime_format\u0026quot;] [[inputs.net]] ignore_protocol_stats = true EOF cat \u0026lt;\u0026lt;EOF \u0026gt; /etc/systemd/system/telegraf.service [Unit] Description=\u0026quot;telegraf\u0026quot; After=network.target [Service] Type=simple ExecStart=/opt/telegraf/telegraf --config telegraf.conf WorkingDirectory=/opt/telegraf SuccessExitStatus=0 LimitNOFILE=65535 StandardOutput=syslog StandardError=syslog SyslogIdentifier=telegraf KillMode=process KillSignal=SIGQUIT TimeoutStopSec=5 Restart=always [Install] WantedBy=multi-user.target EOF systemctl daemon-reload systemctl enable telegraf systemctl restart telegraf systemctl status telegraf  "}),e.add({id:9,href:"/docs/agent/datadog-agent/",title:"Datadog-Agent",description:"Datadog-Agent æŽ¥å…¥å¤œèŽº Nightingale",content:"Datadog æ˜¯ä¸“é—¨æä¾›ç›‘æŽ§å’Œåˆ†æžæœåŠ¡çš„ SaaS æœåŠ¡å•†ï¼Œå¸‚å€¼å‡ ç™¾äº¿ï¼Œæˆç«‹äº†10å¤šå¹´äº†ï¼Œä»–ä»¬åšçš„å®¢æˆ·ç«¯é‡‡é›†å™¨ï¼Œç†è®ºä¸Šåº”è¯¥æ˜¯æ¯”è¾ƒå®Œå¤‡çš„ï¼Œå¤œèŽºå®žçŽ°äº†å‡ ä¸ª Datadog ç‰¹å®šçš„æŽ¥å£ï¼Œå¯ä»¥æŽ¥æ”¶Datadog-Agent æŽ¨é€ä¸Šæ¥çš„æ•°æ®ï¼Œå³ï¼šæˆ‘ä»¬å¯ä»¥æ‹¿ Datadog-Agent ä½œä¸ºå®¢æˆ·ç«¯é‡‡é›†å™¨é‡‡é›†ç›‘æŽ§æ•°æ®ï¼Œç„¶åŽä¸ŠæŠ¥ç»™å¤œèŽºã€‚\n1ã€æ³¨å†Œdatadogçš„è´¦å· # https://www.datadoghq.com/\n2ã€é€‰æ‹©å¥—é¤ # https://app.datadoghq.com/billing/plan å¯ä»¥é€‰æ‹©å…è´¹çš„å¥—é¤\n3ã€æ‹¿åˆ°agentå®‰è£…å‘½ä»¤ # https://app.datadoghq.com/account/settings#agent é€‰æ‹©å¯¹åº”çš„OSï¼Œæ¯”å¦‚CentOS7ï¼Œå¯èƒ½æ˜¯ç±»ä¼¼è¿™ä¹ˆä¸ªå‘½ä»¤ï¼š\nDD_AGENT_MAJOR_VERSION=7 DD_API_KEY=xxx DD_SITE=\u0026quot;datadoghq.com\u0026quot; bash -c \u0026quot;$(curl -L https://s3.amazonaws.com/dd-agent/scripts/install_script.sh)\u0026quot;  DD_API_KEY æ˜¯ä¸€ä¸²å­—ç¬¦ä¸²ï¼Œä¸åŒçš„è´¦å·æœ‰è‡ªå·±çš„ API_KEYï¼Œæ‹¿ç€è¿™ä¸ªå‘½ä»¤åŽ» shell ä¸‹ï¼ˆä½¿ç”¨rootè´¦å·åº”è¯¥ä¼šçœäº‹ä¸€äº›ï¼‰è·‘ä¸€ä¸‹å®‰è£…\n4ã€ä¿®æ”¹é…ç½®æ–‡ä»¶ # ä¿®æ”¹ Datadog-Agent çš„é…ç½®æ–‡ä»¶ï¼ŒæŠŠæŽ¨é€ç›‘æŽ§æ•°æ®çš„åœ°å€ï¼Œæ”¹æˆ n9e-server çš„åœ°å€ï¼Œé…ç½®æ–‡ä»¶åœ°å€åœ¨ï¼š/etc/datadog-agent/datadog.yaml ä¿®æ”¹ dd_url è¿™ä¸ªé…ç½®é¡¹ï¼Œæ¯”å¦‚æˆ‘çš„çŽ¯å¢ƒï¼š\ndd_url: http://10.206.0.16:19000/datadog  5ã€é‡å¯datadog-agent # systemctl restart datadog-agent  "}),e.add({id:10,href:"/docs/agent/grafana-agent/",title:"Grafana-Agent",description:"Grafana-Agent æŽ¥å…¥å¤œèŽº Nightingale",content:"Grafana-agent æ˜¯ Grafana å¼€æºçš„ä¸€æ¬¾ Agentï¼Œä¸“é—¨ç”¨äºŽå’Œè‡ªå·±çš„ Cloud åšæ•°æ®é‡‡é›†é›†æˆï¼Œé€šè¿‡ remote write åè®®æŽ¨æ•°æ®ç»™åŽç«¯ï¼Œå’Œ Categraf çš„æ•°æ®æŽ¨é€æ–¹å¼ä¸€æ ·ï¼Œæ‰€ä»¥ï¼Œä¹Ÿæ˜¯å¯ä»¥ä½œä¸º Nightingale çš„é‡‡é›†å™¨çš„ã€‚Grafana-Agent çš„å…·ä½“ä½¿ç”¨è¯·æŸ¥é˜… Grafana å®˜æ–¹æ–‡æ¡£ï¼Œä¸‹é¢ç»™å‡º v0.23.0 ç‰ˆæœ¬çš„ Grafana-Agent çš„ç®€è¦å®‰è£…æ–¹å¼ï¼Œå¦‚æžœå„ä½çœ‹å®˜ä½¿ç”¨äº†å…¶ä»–ç‰ˆæœ¬çš„ Grafana-Agentï¼Œä¸‹é¢çš„æ•™ç¨‹å¯èƒ½å°±ä¸é€‚ç”¨äº†ï¼Œæ¯•ç«Ÿï¼ŒGrafana-Agent ä¹Ÿåœ¨å¿«é€Ÿè¿­ä»£ï¼Œè¯·å¤§å®¶æ³¨æ„ã€‚\n1. ä¸‹è½½äºŒè¿›åˆ¶ # ä»¥ 64 ä½ Linux ä¸¾ä¾‹ï¼š\ncurl -SOL \u0026quot;https://github.com/grafana/agent/releases/download/v0.23.0/agent-linux-amd64.zip\u0026quot; gunzip ./agent-linux-amd64.zip chmod a+x \u0026quot;agent-linux-amd64\u0026quot;  2. ç”Ÿæˆé…ç½® # cat \u0026lt;\u0026lt;EOF \u0026gt; ./agent-cfg.yaml server: log_level: info http_listen_port: 12345 metrics: global: scrape_interval: 15s scrape_timeout: 10s remote_write: - url: https://N9E-SERVER:19000/prometheus/v1/write basic_auth: username: \u0026quot;\u0026quot; password: \u0026quot;\u0026quot; integrations: agent: enabled: true node_exporter: enabled: true include_exporter_metrics: true EOF  ä¸Šé¢çš„ url éƒ¨åˆ†ï¼Œå°±æ˜¯ n9e-server çš„ remote write æ•°æ®æŽ¥æ”¶æŽ¥å£ï¼Œä»”ç»†çœ‹å°±ä¼šå‘çŽ°ï¼Œå’Œ Categraf ç« èŠ‚ç”¨çš„ url æ˜¯ä¸€æ ·çš„ã€‚\n3. å¯åŠ¨ grafana-agent # nohup ./agent-linux-amd64 \\ -config.file ./agent-cfg.yaml \\ -metrics.wal-directory ./data \\ \u0026amp;\u0026gt; grafana-agent.log \u0026amp;  ä¸Šé¢çš„é…ç½®å†…ç½®å¯ç”¨äº† node_exporterï¼ŒGrafana-Agent å†…ç½®äº†å¾ˆå¤š exporterï¼Œçœçš„åˆ°å¤„åŽ»æ‰¾ exporter äº†ï¼Œæ„Ÿå…´è¶£çš„è¯å¤§å®¶å¯ä»¥æŸ¥é˜… Grafana-Agent çš„æ–‡æ¡£ä»”ç»†ç ”ç©¶ä¸‹ã€‚\n"}),e.add({id:11,href:"/docs/agent/falcon-plugin/",title:"Falcon-Plugin",description:"Falcon-Plugin æŽ¥å…¥å¤œèŽº Nightingale",content:"Nightingale å®žçŽ°äº† Open-Falcon çš„ HTTP æ•°æ®æŽ¥æ”¶æŽ¥å£ï¼Œæ‰€ä»¥ï¼ŒOpen-Falcon ç¤¾åŒºå¾ˆå¤šé‡‡é›†æ’ä»¶ä¹Ÿæ˜¯å¯ä»¥ç›´æŽ¥ä½¿ç”¨çš„ã€‚ä½†æ˜¯ Falcon-Agent ä¸è¡Œï¼Œå› ä¸º Falcon-Agent æŽ¨é€ç›‘æŽ§æ•°æ®ç»™æœåŠ¡ç«¯ï¼Œèµ°çš„æ˜¯ RPC æŽ¥å£ã€‚\nå¦‚æžœä½ å‘çŽ°æŸä¸ª Falcon-Plugin æ˜¯ç”¨ CRON çš„æ–¹å¼é©±åŠ¨çš„ï¼ŒæŽ¨é€æ•°æ®èµ°çš„æ˜¯ Falcon-Agent çš„ HTTP æŽ¥å£ï¼Œé‚£è¿™ä¸ªæ’ä»¶å°±å¯ä»¥æŽ¨æ•°æ®ç»™å¤œèŽºã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚ mymon å…¶é…ç½®æ–‡ä»¶é‡‡ç”¨ ini æ ¼å¼ï¼Œä¸‹é¢æ˜¯æ ·ä¾‹ï¼š\n[default] basedir = . # å·¥ä½œç›®å½• log_dir = ./fixtures # æ—¥å¿—ç›®å½•ï¼Œé»˜è®¤æ—¥å¿—æ–‡ä»¶ä¸ºmyMon.log,æ—§ç‰ˆæœ¬æœ‰log_fileé¡¹ï¼Œå¦‚æžœåŒæ—¶è®¾ç½®äº†ï¼Œä¼šä¼˜å…ˆé‡‡ç”¨log_file ignore_file = ./falconignore # é…ç½®å¿½ç•¥çš„metricé¡¹ snapshot_dir = ./snapshot # ä¿å­˜å¿«ç…§(process, innodb status)çš„ç›®å½• snapshot_day = 10 # ä¿å­˜å¿«ç…§çš„æ—¶é—´(æ—¥) log_level = 5 # æ—¥å¿—çº§åˆ«[RFC5424] # 0 LevelEmergency # 1 LevelAlert # 2 LevelCritical # 3 LevelError # 4 LevelWarning # 5 LevelNotice # 6 LevelInformational # 7 LevelDebug falcon_client=http://127.0.0.1:1988/v1/push # falcon agentè¿žæŽ¥åœ°å€ [mysql] user=root # æ•°æ®åº“ç”¨æˆ·å password=1tIsB1g3rt # æ‚¨çš„æ•°æ®åº“å¯†ç  host=127.0.0.1 # æ•°æ®åº“è¿žæŽ¥åœ°å€ port=3306 # æ•°æ®åº“ç«¯å£  æ³¨æ„ falcon_client é…ç½®é¡¹ï¼Œé…ç½®çš„æ˜¯ Falcon-Agent çš„æ•°æ®æŽ¥æ”¶æŽ¥å£ï¼Œå¯ä»¥æŠŠè¿™ä¸ªé…ç½®æ”¹æˆå¤œèŽº n9e-server çš„åœ°å€ï¼š http://N9E-SERVER:19000/openfalcon/push ã€‚\nOpen-Falcon çš„ç›‘æŽ§æ•°æ®ä¸­æœ‰ä¸€ä¸ª endpoint å­—æ®µï¼Œå¤œèŽºä¼šæŠŠ endpoint å­—æ®µå½“åšç›‘æŽ§å¯¹è±¡å”¯ä¸€æ ‡è¯†æ¥å¯¹å¾…ï¼Œè‡ªåŠ¨è§£æžä¹‹åŽå…¥åº“ï¼Œå°±å¯ä»¥åœ¨å¯¹è±¡åˆ—è¡¨ä¸­çœ‹åˆ°äº†ã€‚å½“ç„¶ï¼Œå¦‚æžœæ²¡æœ‰ endpoint å­—æ®µä¹Ÿæ²¡å…³ç³»ï¼Œä½¿ç”¨ metric å’Œ tags ä¹Ÿæ˜¯å¯ä»¥å”¯ä¸€æ ‡è¯†ä¸€ä¸ª Series çš„ã€‚\n"}),e.add({id:12,href:"/docs/usage/video/",title:"å…¥é—¨æ•™ç¨‹",description:"å¤œèŽºï¼ˆ Nightingale ï¼‰å…¥é—¨è§†é¢‘æ•™ç¨‹",content:"é¡µé¢ä¸Šçš„åŠŸèƒ½æŒ¨ä¸ªæè¿°çš„è¯ç¯‡å¹…å¤ªé•¿äº†ï¼Œå½•åˆ¶äº†ä¸€å¥—å°è§†é¢‘æ•™ç¨‹ä¾›å¤§å®¶å‚è€ƒï¼Œä¸è¿‡è¿™å¥—è§†é¢‘æ•™ç¨‹æ¯”è¾ƒæµ…æ˜¾ï¼ŒåŸºäºŽ5.0çš„ç‰ˆæœ¬ä»‹ç»çš„ï¼Œç›¸å¯¹è¾ƒè€ï¼Œå¤œèŽºä¸€ç›´åœ¨å¿«é€Ÿè¿­ä»£ï¼Œå¢žåŠ äº†å¾ˆå¤šæ–°ç‰¹æ€§ï¼Œæœ‰å¾ˆå¤šç‰¹æ€§æ²¡æœ‰åœ¨è§†é¢‘æ•™ç¨‹ä¸­ä½“çŽ°ï¼Œè¯·å¤§å®¶è§è°…ï¼ŒåŽé¢ä¼šå†å½•åˆ¶ä¸€å¥—æ›´è¯¦å°½çš„ï¼ŒåŸºäºŽæ–°ç‰ˆæœ¬çš„è®²è§£è§†é¢‘ã€‚\n 01-ä½¿ç”¨Docker Composeä¸€è¡Œå‘½ä»¤å®‰è£…å¤œèŽºv5 02-å¿«é€Ÿåœ¨ç”Ÿäº§çŽ¯å¢ƒéƒ¨ç½²å¯åŠ¨å•æœºç‰ˆå¤œèŽºv5 03-è®²è§£å¤œèŽºv5äººå‘˜ç»„ç»‡ç›¸å…³åŠŸèƒ½ 04-è®²è§£å¤œèŽºv5ç›‘æŽ§çœ‹å›¾ç›¸å…³åŠŸèƒ½ 05-è®²è§£å¤œèŽºv5å‘Šè­¦è§„åˆ™çš„ä½¿ç”¨ 06-è®²è§£å¤œèŽºv5å‘Šè­¦å±è”½è§„åˆ™çš„ä½¿ç”¨ 07-è®²è§£å¤œèŽºå‘Šè­¦è®¢é˜…è§„åˆ™çš„ä½¿ç”¨ 08-è®²è§£å¤œèŽºv5æ´»è·ƒå‘Šè­¦å’ŒåŽ†å²å‘Šè­¦ 09-è®²è§£å¤œèŽºv5å‘Šè­¦è‡ªæ„ˆè„šæœ¬çš„ä½¿ç”¨ 10-è®²è§£å¤œèŽºç›‘æŽ§å¯¹è±¡çš„ç®¡ç†åŠŸèƒ½ 11-å¤œèŽºv5å¦‚ä½•æŽ¥å…¥å¤šä¸ªæ—¶åºå­˜å‚¨ 12-è®²è§£å¤œèŽºv5é…ç½®æ–‡ä»¶  é™¤äº†è¿™äº›è§†é¢‘æ•™ç¨‹ï¼Œä½¿ç”¨æ‰‹å†Œè¿™ä¸€ç« ï¼Œè¿˜ä¼šæä¾›æ›´å¤šå°èŠ‚æ¥ä»‹ç»ä¸€äº›å¤§å®¶å¸¸é—®çš„é—®é¢˜ï¼Œæ¯”å¦‚å¦‚ä½•ç›‘æŽ§äº¤æ¢æœºï¼Œå¦‚ä½•ç›‘æŽ§åº”ç”¨ç­‰ã€‚ä»Žæ€»ä½“é—®é¢˜æ¯”ä¾‹æ¥çœ‹ï¼Œå¤œèŽºæœåŠ¡ç«¯é—®é¢˜ç›¸å¯¹è¾ƒå°‘ï¼Œå¤§å®¶æ‘¸ç´¢ä¸€ä¸‹ï¼Œå¾ˆå¿«å¯ä»¥æŽŒæ¡ï¼Œç–‘é—®æ¯”è¾ƒå¤šçš„ï¼Œæ˜¯å¯¹å„ç§ç›®æ ‡çš„ç›‘æŽ§ï¼Œæ¯”å¦‚å¦‚ä½•ç›‘æŽ§ MySQLï¼Œå¦‚ä½•ç›‘æŽ§ Redis ç­‰ï¼Œé’ˆå¯¹è¿™éƒ¨åˆ†é—®é¢˜ï¼Œå¤§å®¶åº”è¯¥åŽ»æŸ¥çœ‹é‡‡é›†å™¨çš„æ–‡æ¡£ï¼Œæ¯”å¦‚ Telegraf æ¯ä¸ªé‡‡é›†å™¨ä¸‹é¢éƒ½æœ‰ READMEä»‹ç»ï¼Œ é€šè¿‡è¿™äº› READMEï¼Œç†è®ºä¸Šå°±å¯ä»¥çŸ¥é“å¦‚ä½•ä½¿ç”¨å„ä¸ªé‡‡é›†å™¨ã€‚Categraf çš„é‡‡é›†å™¨ç›®å½• åœ¨è¿™é‡Œï¼Œ æœªæ¥æˆ‘ä»¬ä¹Ÿä¼šæŠŠæ‰€æœ‰é‡‡é›†å™¨è¡¥å……å®Œæ•´çš„ READMEï¼Œä»¥åŠå‘Šè­¦è§„åˆ™å’Œç›‘æŽ§å¤§ç›˜JSONï¼Œå¤§å®¶å¯¼å…¥ç›´æŽ¥å°±å¯ä»¥ä½¿ç”¨ï¼Œå½“ç„¶ï¼Œè·¯æ¼«æ¼«å…¶ä¿®è¿œå…®ï¼Œä¸€æ­¥ä¸€æ­¥æ¥å§ã€‚\n"}),e.add({id:13,href:"/docs/usage/snmp/",title:"SNMP",description:"å¤œèŽºï¼ˆ Nightingale ï¼‰é€šè¿‡ SNMP ç›‘æŽ§ç½‘ç»œè®¾å¤‡",content:"ç›‘æŽ§ç½‘ç»œè®¾å¤‡ï¼Œä¸»è¦æ˜¯é€šè¿‡ SNMP åè®®ï¼ŒCategrafã€Telegrafã€Datadog-Agentã€snmp_exporter éƒ½æä¾›äº†è¿™ä¸ªèƒ½åŠ›ã€‚\nCategraf # Categraf æä¾›äº†ä¸€ä¸ªç½‘ç»œè®¾å¤‡çš„é‡‡é›†æ’ä»¶ï¼šswitch_legacyï¼Œåœ¨ conf/input.switch_legacy ä¸‹å¯ä»¥çœ‹åˆ°é…ç½®æ–‡ä»¶ï¼Œæœ€æ ¸å¿ƒå°±æ˜¯é…ç½®äº¤æ¢æœºçš„ IP ä»¥åŠè®¤è¯ä¿¡æ¯ï¼Œswitch_legacy å½“å‰åªæ”¯æŒ v2 åè®®ï¼Œæ‰€ä»¥è®¤è¯ä¿¡æ¯å°±æ˜¯ community å­—æ®µã€‚å…¶ä»–é…ç½®éƒ½ä¸€ç›®äº†ç„¶ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚\nè¿™ä¸ªæ’ä»¶æ˜¯æŠŠä¹‹å‰ Open-Falcon ç¤¾åŒºçš„ swcollector ç›´æŽ¥æ‹¿è¿‡æ¥äº†ï¼Œæ„Ÿè°¢ å†¯éª å¤§ä½¬æŒç»­åœ¨ç»´æŠ¤è¿™ä¸ªå¼€æºé¡¹ç›®ã€‚\nTelegraf # Telegraf å†…ç½®æ”¯æŒ SNMP çš„é‡‡é›†ï¼Œæœ¬èŠ‚ç»™ä¸€ä¸ªå…¥é—¨ä¾‹å­ï¼Œè®©å¤§å®¶å¿«é€Ÿä¸Šæ‰‹ï¼Œæ›´å¤šå…·ä½“çŸ¥è¯†å¯ä»¥å‚è€ƒè¿™é‡Œã€‚åœ¨ telegraf.conf ä¸­æœç´¢ inputs.snmpï¼Œå³å¯æ‰¾åˆ°å¯¹åº”çš„é…ç½®ï¼Œä¾‹å­å¦‚ä¸‹ï¼š\n[[inputs.snmp]] agents = [\u0026quot;udp://172.25.79.194:161\u0026quot;] timeout = \u0026quot;5s\u0026quot; version = 3 agent_host_tag = \u0026quot;ident\u0026quot; retries = 1 sec_name = \u0026quot;managev3user\u0026quot; auth_protocol = \u0026quot;SHA\u0026quot; auth_password = \u0026quot;example.Demo.c0m\u0026quot; [[inputs.snmp.field]] oid = \u0026quot;RFC1213-MIB::sysUpTime.0\u0026quot; name = \u0026quot;uptime\u0026quot; [[inputs.snmp.field]] oid = \u0026quot;RFC1213-MIB::sysName.0\u0026quot; name = \u0026quot;source\u0026quot; is_tag = true [[inputs.snmp.table]] oid = \u0026quot;IF-MIB::ifTable\u0026quot; name = \u0026quot;interface\u0026quot; inherit_tags = [\u0026quot;source\u0026quot;] [[inputs.snmp.table.field]] oid = \u0026quot;IF-MIB::ifDescr\u0026quot; name = \u0026quot;ifDescr\u0026quot; is_tag = true  ä¸Šé¢éžå¸¸å…³é”®çš„éƒ¨åˆ†æ˜¯ï¼šagent_host_tag = \u0026quot;ident\u0026quot;ï¼Œå› ä¸ºå¤œèŽºå¯¹ ident è¿™ä¸ªæ ‡ç­¾ä¼šç‰¹æ®Šå¯¹å¾…å¤„ç†ï¼ŒæŠŠæºæœ‰è¿™ä¸ªæ ‡ç­¾çš„æ•°æ®å½“åšéš¶å±žæŸä¸ªç›‘æŽ§å¯¹è±¡çš„æ•°æ®ï¼Œæœºå™¨å’Œç½‘ç»œè®¾å¤‡éƒ½æ˜¯å…¸åž‹çš„æœŸæœ›ä½œä¸ºç›‘æŽ§å¯¹è±¡æ¥ç®¡ç†çš„ï¼Œæ‰€ä»¥ SNMP çš„é‡‡é›†ä¸­ï¼Œæˆ‘ä»¬æŠŠç½‘ç»œè®¾å¤‡çš„ IP æ”¾åˆ° ident è¿™ä¸ªæ ‡ç­¾é‡Œå¸¦ä¸ŠåŽ»ã€‚\nå¦å¤–è¿™ä¸ªé‡‡é›†è§„åˆ™æ˜¯ v3 çš„æ ¡éªŒæ–¹æ³•ï¼Œä¸åŒçš„å…¬å¸å¯èƒ½é…ç½®çš„æ ¡éªŒæ–¹å¼ä¸åŒï¼Œè¯·å„ä½å‚ç…§ telegraf.conf ä¸­é‚£äº› SNMP ç›¸å…³çš„æ³¨é‡Šä»”ç»†æ ¸å¯¹ï¼Œå¦‚æžœæ˜¯ v2 ä¼šç®€å•å¾ˆå¤šï¼ŒæŠŠä¸Šä¾‹ä¸­çš„å¦‚ä¸‹éƒ¨åˆ†ï¼š\nversion = 3 sec_name = \u0026quot;managev3user\u0026quot; auth_protocol = \u0026quot;SHA\u0026quot; auth_password = \u0026quot;example.Demo.c0m\u0026quot;  æ¢æˆï¼š\nversion = 2 community = \u0026quot;public\u0026quot;  å³å¯ï¼Œå½“ç„¶äº†ï¼Œcommunity è¦æ”¹æˆä½ ä»¬è‡ªå·±çš„ï¼Œè¿™é‡Œå†™çš„ â€œpublicâ€ åªæ˜¯ä¸¾ä¸ªä¾‹å­ã€‚\ninputs.snmp.field ç›¸å…³çš„é‚£äº›é…ç½®ï¼Œå¯ä»¥é‡‡é›†åˆ°å„ä¸ªç½‘å£çš„ç›‘æŽ§æŒ‡æ ‡ï¼Œæ›´å¤šçš„ä½¿ç”¨æ–¹å¼è¯·å‚è€ƒå®˜ç½‘\nå¦å¤–ï¼Œsnmpçš„é‡‡é›†ï¼Œå»ºè®®å¤§å®¶éƒ¨ç½²å•ç‹¬çš„ Telegraf æ¥åšï¼Œå› ä¸ºå’Œæœºå™¨ã€ä¸­é—´ä»¶ç­‰çš„é‡‡é›†é¢‘çŽ‡å¯èƒ½ä¸åŒï¼Œæ¯”å¦‚è¾¹ç¼˜äº¤æ¢æœºï¼Œæˆ‘ä»¬ 5min é‡‡é›†ä¸€æ¬¡å°±å¤Ÿäº†ï¼Œå¦‚æžœæŒ‰ç…§é»˜è®¤çš„é…ç½®å¯æ˜¯ 10s é‡‡é›†ä¸€æ¬¡ï¼Œå®žåœ¨æ˜¯å¤ªé¢‘ç¹äº†ï¼Œå¯èƒ½ä¼šç»™ä¸€äº›è€å¼äº¤æ¢æœºé€ æˆæ¯”è¾ƒå¤§çš„åŽ‹åŠ›ï¼Œé‡‡é›†é¢‘çŽ‡åœ¨ telegraf.conf çš„æœ€ä¸Šé¢ [agent] éƒ¨åˆ†ï¼Œè¾¹ç¼˜äº¤æ¢æœºå»ºè®®é…ç½®ä¸ºï¼š\n[agent] interval = \u0026quot;300s\u0026quot; flush_interval = \u0026quot;300s\u0026quot;  æ ¸å¿ƒäº¤æ¢æœºå¯ä»¥é…ç½®çš„é¢‘ç¹ä¸€äº›ï¼Œæ¯”å¦‚ 60s æˆ–è€… 120sï¼Œè¯·å„ä½ç½‘ç»œå·¥ç¨‹å¸ˆæœ‹å‹è‡ªè¡Œæ–Ÿé…Œã€‚\n"}),e.add({id:14,href:"/docs/usage/apm/",title:"åº”ç”¨ç›‘æŽ§",description:"å¤œèŽºï¼ˆ Nightingale ï¼‰é€šè¿‡ Prometheus SDK ç›‘æŽ§åº”ç”¨ç¨‹åº",content:"å†™åœ¨å‰é¢ # åº”ç”¨ç›‘æŽ§å®žé™…è¦æ¯” OSã€ä¸­é—´ä»¶çš„ç›‘æŽ§æ›´ä¸ºå…³é”®ï¼Œå› ä¸ºæŸä¸ª OS å±‚é¢çš„æŒ‡æ ‡å¼‚å¸¸ï¼Œæ¯”å¦‚ CPU é£™é«˜äº†ï¼Œæœªå¿…ä¼šå½±å“ç»ˆç«¯ç”¨æˆ·çš„ä½“éªŒï¼Œä½†æ˜¯åº”ç”¨å±‚é¢çš„ç›‘æŽ§æŒ‡æ ‡å‡ºé—®é¢˜ï¼Œé€šå¸¸å°±ä¼šå½±å“å®¢æˆ·çš„æ„Ÿå—ã€ç”šè‡³å½±å“å®¢æˆ·çš„ä»˜è´¹ã€‚\né’ˆå¯¹åº”ç”¨ç›‘æŽ§ï¼ŒGoogleæå‡ºäº† 4 ä¸ªé»„é‡‘æŒ‡æ ‡ï¼Œåˆ†åˆ«æ˜¯ï¼šæµé‡ã€å»¶è¿Ÿã€é”™è¯¯ã€é¥±å’Œåº¦ï¼Œå…¶ä¸­å‰é¢ 3 ä¸ªæŒ‡æ ‡éƒ½å¯ä»¥é€šè¿‡å†…åµŒ SDK çš„æ–¹å¼åŸ‹ç‚¹é‡‡é›†ï¼Œæœ¬èŠ‚é‡ç‚¹ä»‹ç»è¿™ç§æ–¹å¼ã€‚å½“ç„¶äº†ï¼Œå†…åµŒ SDK æœ‰è¾ƒå¼ºçš„ä»£ç ä¾µå…¥æ€§ï¼Œå¦‚æžœä¸šåŠ¡ç ”å‘éš¾ä»¥é…åˆï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨è§£æžæ—¥å¿—çš„æ–¹æ¡ˆï¼Œè¿™ä¸ªè¶…å‡ºäº†å¤œèŽºï¼ˆå¤œèŽºæ˜¯æŒ‡æ ‡ç›‘æŽ§ç³»ç»Ÿï¼‰çš„èŒƒç•´ï¼Œå¤§å®¶å¦‚æžœæ„Ÿå…´è¶£ï¼Œå¯ä»¥äº†è§£ä¸€ä¸‹å¿«çŒ«çš„å•†ä¸šåŒ–äº§å“\nåŸ‹ç‚¹å·¥å…· # æœ€å¸¸è§çš„é€šç”¨åŸ‹ç‚¹å·¥å…·æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯ statsdï¼Œä¸€ä¸ªæ˜¯ prometheus SDKï¼Œå½“ç„¶ï¼Œå„ä¸ªè¯­è¨€ä¹Ÿä¼šæœ‰è‡ªå·±çš„æ›´æ–¹ä¾¿çš„æ–¹å¼ï¼Œæ¯”å¦‚ Java ç”Ÿæ€ä½¿ç”¨ micrometer è¾ƒå¤šï¼Œå¦‚æžœæ˜¯ SpringBoot çš„ç¨‹åºï¼Œåˆ™ä½¿ç”¨ actuator ä¼šæ›´ä¾¿æ·ï¼Œactuator åº•å±‚å°±æ˜¯ä½¿ç”¨ micrometerã€‚\nå¤œèŽºè‡ªèº«ç›‘æŽ§ # æˆ‘ä»¬å°±ä»¥å¤œèŽºè‡ªèº«çš„ä»£ç ä¸¾ä¾‹ï¼Œè®²è§£å¦‚ä½•å†…åµŒåŸ‹ç‚¹å·¥å…·ï¼Œè¿™é‡Œé€‰æ‹© prometheus SDK ä½œä¸ºåŸ‹ç‚¹æ–¹æ¡ˆã€‚\nå¤œèŽºæ ¸å¿ƒæ¨¡å—æœ‰ä¸¤ä¸ªï¼ŒWebapi ä¸»è¦æ˜¯æä¾› HTTP æŽ¥å£ç»™ JavaScript è°ƒç”¨ï¼ŒServer ä¸»è¦æ˜¯è´Ÿè´£æŽ¥æ”¶ç›‘æŽ§æ•°æ®ï¼Œå¤„ç†å‘Šè­¦è§„åˆ™ï¼Œè¿™ä¸¤ä¸ªæ¨¡å—éƒ½å¼•å…¥äº† Prometheus çš„ Go çš„SDKï¼Œç”¨æ­¤æ–¹å¼åš App Performance ç›‘æŽ§ï¼Œæœ¬èŠ‚ä»¥å¤œèŽºçš„ä»£ç ä¸ºä¾‹ï¼Œè®²è§£å¦‚ä½•ä½¿ç”¨ Prometheus çš„ SDKã€‚\nWebapi # Webapi æ¨¡å—ä¸»è¦ç»Ÿè®¡ä¸¤ä¸ªå†…å®¹ï¼Œä¸€ä¸ªæ˜¯è¯·æ±‚çš„æ•°é‡ç»Ÿè®¡ï¼Œä¸€ä¸ªæ˜¯è¯·æ±‚çš„å»¶è¿Ÿç»Ÿè®¡ï¼Œç»Ÿè®¡æ—¶ï¼Œè¦ç”¨ä¸åŒçš„ Label åšç»´åº¦åŒºåˆ†ï¼ŒåŽé¢å°±å¯ä»¥é€šè¿‡ä¸åŒçš„ç»´åº¦åšå¤šç§å¤šæ ·çš„ç»Ÿè®¡åˆ†æžï¼Œå¯¹äºŽ HTTP è¯·æ±‚ï¼Œè§„åˆ’ 4 ä¸ªæ ¸å¿ƒ Labelï¼Œåˆ†åˆ«æ˜¯ï¼šserviceã€codeã€pathã€methodã€‚service æ ‡è¯†æœåŠ¡åç§°ï¼Œè¦æ±‚å…¨å±€å”¯ä¸€ï¼Œä¾¿äºŽå’Œå…¶ä»–æœåŠ¡åç§°åŒºåˆ†å¼€ï¼Œæ¯”å¦‚ Webapi æ¨¡å—ï¼Œå°±å®šä¹‰ä¸º n9e-webapiï¼Œcode æ˜¯ HTTP è¿”å›žçš„çŠ¶æ€ç ï¼Œ200 å°±è¡¨ç¤ºæˆåŠŸæ•°é‡ï¼Œå…¶ä»– code å°±æ˜¯å¤±è´¥çš„ï¼ŒåŽé¢æˆ‘ä»¬å¯ä»¥æ®æ­¤ç»Ÿè®¡æˆåŠŸçŽ‡ï¼Œmethod æ˜¯ HTTP æ–¹æ³•ï¼ŒGETã€POSTã€PUTã€DELETE ç­‰ï¼Œæ¯”å¦‚æ–°å¢žç”¨æˆ·å’ŒèŽ·å–ç”¨æˆ·åˆ—è¡¨å¯èƒ½éƒ½æ˜¯ /api/n9e/usersï¼Œä»Žè·¯å¾„ä¸Šæ— æ³•åŒºåˆ†ï¼Œåªèƒ½å†åŠ ä¸Š method æ‰èƒ½åŒºåˆ†å¼€ã€‚\npath ç€é‡è¯´ä¸€ä¸‹ï¼Œè¡¨ç¤ºè¯·æ±‚è·¯å¾„ï¼Œæ¯”å¦‚ä¸Šé¢æåˆ°çš„/api/n9e/usersï¼Œä½†æ˜¯ï¼Œåœ¨ restful å®žè·µä¸­ï¼Œurl ä¸­ç»å¸¸ä¼šæœ‰å‚æ•°ï¼Œæ¯”å¦‚èŽ·å–ç¼–å·ä¸º1çš„ç”¨æˆ·çš„ä¿¡æ¯ï¼ŒæŽ¥å£æ˜¯/api/n9e/user/1ï¼ŒèŽ·å–ç¼–å·ä¸º2çš„ç”¨æˆ·ä¿¡æ¯ï¼ŒæŽ¥å£æ˜¯/api/n9e/user/2ï¼Œå¦‚æžœè¿™ä¿©å¸¦æœ‰ç”¨æˆ·ç¼–å·çš„ url éƒ½ä½œä¸º Labelï¼Œä¼šé€ æˆæ—¶åºåº“ç´¢å¼•çˆ†ç‚¸ï¼Œè€Œä¸”ä»Žä¸šåŠ¡æ–¹ä½¿ç”¨è§’åº¦æ¥çœ‹ï¼Œæˆ‘ä»¬ä¹Ÿä¸å…³æ³¨ç¼–å·ä¸º1çš„ç”¨æˆ·èŽ·å–è¯·æ±‚è¿˜æ˜¯ç¼–å·ä¸º2çš„ç”¨æˆ·èŽ·å–è¯·æ±‚ï¼Œè€Œæ˜¯å…³æ³¨æ•´ä½“çš„GET /api/n9e/user/:idè¿™ä¸ªæŽ¥å£çš„ç›‘æŽ§æ•°æ®ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨è®¾ç½® Label çš„æ—¶å€™ï¼Œè¦æŠŠpathè®¾ç½®ä¸º/api/n9e/user/:idï¼Œè€Œä¸æ˜¯é‚£å…·ä½“çš„å¸¦æœ‰ç”¨æˆ·ç¼–å·çš„ url è·¯å¾„ã€‚å¤œèŽºç”¨çš„ gin æ¡†æž¶ï¼Œgin æ¡†æž¶æœ‰ä¸ª FullPath æ–¹æ³•å°±æ˜¯èŽ·å–è¿™ä¸ªä¿¡æ¯çš„ï¼Œæ¯”è¾ƒæ–¹ä¾¿ã€‚\né¦–å…ˆï¼Œæˆ‘ä»¬åœ¨ Webapi ä¸‹é¢åˆ›å»ºä¸€ä¸ª stat packageï¼Œæ”¾ç½®ç›¸å…³ç»Ÿè®¡å˜é‡ï¼š\npackage stat import ( \u0026quot;time\u0026quot; \u0026quot;github.com/prometheus/client_golang/prometheus\u0026quot; ) const Service = \u0026quot;n9e-webapi\u0026quot; var ( labels = []string{\u0026quot;service\u0026quot;, \u0026quot;code\u0026quot;, \u0026quot;path\u0026quot;, \u0026quot;method\u0026quot;} uptime = prometheus.NewCounterVec( prometheus.CounterOpts{ Name: \u0026quot;uptime\u0026quot;, Help: \u0026quot;HTTP service uptime.\u0026quot;, }, []string{\u0026quot;service\u0026quot;}, ) RequestCounter = prometheus.NewCounterVec( prometheus.CounterOpts{ Name: \u0026quot;http_request_count_total\u0026quot;, Help: \u0026quot;Total number of HTTP requests made.\u0026quot;, }, labels, ) RequestDuration = prometheus.NewHistogramVec( prometheus.HistogramOpts{ Buckets: []float64{.01, .1, 1, 10}, Name: \u0026quot;http_request_duration_seconds\u0026quot;, Help: \u0026quot;HTTP request latencies in seconds.\u0026quot;, }, labels, ) ) func Init() { // Register the summary and the histogram with Prometheus's default registry. prometheus.MustRegister( uptime, RequestCounter, RequestDuration, ) go recordUptime() } // recordUptime increases service uptime per second. func recordUptime() { for range time.Tick(time.Second) { uptime.WithLabelValues(Service).Inc() } }  uptime å˜é‡æ˜¯é¡ºæ‰‹ä¸ºä¹‹ï¼Œç»Ÿè®¡è¿›ç¨‹å¯åŠ¨äº†å¤šä¹…æ—¶é—´ï¼Œä¸ç”¨å¤ªå…³æ³¨ï¼ŒRequestCounter å’Œ RequestDurationï¼Œåˆ†åˆ«ç»Ÿè®¡è¯·æ±‚æµé‡å’Œè¯·æ±‚å»¶è¿Ÿã€‚Init æ–¹æ³•æ˜¯åœ¨ Webapi æ¨¡å—è¿›ç¨‹åˆå§‹åŒ–çš„æ—¶å€™è°ƒç”¨ï¼Œæ‰€ä»¥è¿›ç¨‹ä¸€èµ·ï¼Œå°±ä¼šè‡ªåŠ¨æ³¨å†Œå¥½ã€‚\nç„¶åŽæˆ‘ä»¬å†™ä¸€ä¸ª middlewareï¼Œåœ¨è¯·æ±‚è¿›æ¥çš„æ—¶å€™æ‹¦æˆªä¸€ä¸‹ï¼Œçœçš„æ¯ä¸ªè¯·æ±‚éƒ½è¦åŽ»ç»Ÿè®¡ï¼Œmiddleware æ–¹æ³•çš„ä»£ç å¦‚ä¸‹ï¼š\nimport ( ... promstat \u0026quot;github.com/didi/nightingale/v5/src/webapi/stat\u0026quot; ) func stat() gin.HandlerFunc { return func(c *gin.Context) { start := time.Now() c.Next() code := fmt.Sprintf(\u0026quot;%d\u0026quot;, c.Writer.Status()) method := c.Request.Method labels := []string{promstat.Service, code, c.FullPath(), method} promstat.RequestCounter.WithLabelValues(labels...).Inc() promstat.RequestDuration.WithLabelValues(labels...).Observe(float64(time.Since(start).Seconds())) } }  æœ‰äº†è¿™ä¸ª middleware ä¹‹åŽï¼Œnew å‡º gin çš„ engine çš„æ—¶å€™ï¼Œå°±ç«‹é©¬ Use ä¸€ä¸‹ï¼Œä»£ç å¦‚ä¸‹ï¼š\n... r := gin.New() r.Use(stat()) ...  æœ€åŽï¼Œç›‘æŽ§æ•°æ®è¦é€šè¿‡/metricsæŽ¥å£æš´éœ²å‡ºåŽ»ï¼Œæˆ‘ä»¬è¦æš´éœ²è¿™ä¸ªè¯·æ±‚ç«¯ç‚¹ï¼Œä»£ç å¦‚ä¸‹ï¼š\nimport ( ... \u0026quot;github.com/prometheus/client_golang/prometheus/promhttp\u0026quot; ) func configRoute(r *gin.Engine, version string) { ... r.GET(\u0026quot;/metrics\u0026quot;, gin.WrapH(promhttp.Handler())) }  å¦‚ä¸Šï¼Œæ¯ä¸ª Webapi çš„æŽ¥å£çš„æµé‡å’ŒæˆåŠŸçŽ‡éƒ½å¯ä»¥ç›‘æŽ§åˆ°äº†ã€‚å¦‚æžœä½ ä¹Ÿéƒ¨ç½²äº†å¤œèŽºï¼Œè¯·æ±‚ Webapi çš„ç«¯å£ï¼ˆé»˜è®¤æ˜¯18000ï¼‰çš„ /metrics æŽ¥å£çœ‹çœ‹å§ã€‚\nðŸ’¡  å¦‚æžœæœåŠ¡éƒ¨ç½²å¤šä¸ªå®žä¾‹ï¼Œç”šè‡³å¤šä¸ª regionï¼Œå¤šä¸ªçŽ¯å¢ƒï¼Œä¸Šé¢çš„ 4 ä¸ª Label å°±ä¸å¤Ÿç”¨äº†ï¼Œå› ä¸ºåªæœ‰è¿™ 4 ä¸ª Label ä¸è¶³ä»¥å”¯ä¸€æ ‡è¯†ä¸€ä¸ªå…·ä½“çš„å®žä¾‹ï¼Œæ­¤æ—¶éœ€è¦ envã€regionã€instance è¿™ç§ Labelï¼Œè¿™äº› Labelä¸ éœ€è¦åœ¨ä»£ç é‡ŒåŸ‹ç‚¹ï¼Œåœ¨é‡‡é›†çš„æ—¶å€™ä¸€èˆ¬å¯ä»¥é™„åŠ é¢å¤–çš„æ ‡ç­¾ï¼Œé€šè¿‡é™„åŠ æ ‡ç­¾çš„æ–¹å¼æ¥å¤„ç†å³å¯   Server # Server æ¨¡å—çš„ç›‘æŽ§ï¼Œå’Œ Webapi æ¨¡å—çš„ç›‘æŽ§å·®å¼‚è¾ƒå¤§ï¼Œå› ä¸ºå…³æ³¨ç‚¹ä¸åŒï¼ŒWebapi å…³æ³¨çš„æ˜¯ HTTP æŽ¥å£çš„è¯·æ±‚é‡å’Œå»¶è¿Ÿï¼Œè€Œ Server æ¨¡å—å…³æ³¨çš„æ˜¯æŽ¥æ”¶äº†å¤šå°‘ç›‘æŽ§æŒ‡æ ‡ï¼Œå†…éƒ¨äº‹ä»¶é˜Ÿåˆ—çš„é•¿åº¦ï¼Œä»Žæ•°æ®åº“åŒæ­¥å‘Šè­¦è§„åˆ™èŠ±è´¹å¤šä¹…ï¼ŒåŒæ­¥äº†å¤šå°‘æ¡æ•°æ®ç­‰ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦åœ¨ Server çš„ package ä¸‹åˆ›å»ºä¸€ä¸ª stat åŒ…ï¼Œstat åŒ…ä¸‹æ”¾ç½® stat.goï¼Œå†…å®¹å¦‚ä¸‹ï¼š\npackage stat import ( \u0026quot;github.com/prometheus/client_golang/prometheus\u0026quot; ) const ( namespace = \u0026quot;n9e\u0026quot; subsystem = \u0026quot;server\u0026quot; ) var ( // å„ä¸ªå‘¨æœŸæ€§ä»»åŠ¡çš„æ‰§è¡Œè€—æ—¶ GaugeCronDuration = prometheus.NewGaugeVec(prometheus.GaugeOpts{ Namespace: namespace, Subsystem: subsystem, Name: \u0026quot;cron_duration\u0026quot;, Help: \u0026quot;Cron method use duration, unit: ms.\u0026quot;, }, []string{\u0026quot;cluster\u0026quot;, \u0026quot;name\u0026quot;}) // ä»Žæ•°æ®åº“åŒæ­¥æ•°æ®çš„æ—¶å€™ï¼ŒåŒæ­¥çš„æ¡æ•° GaugeSyncNumber = prometheus.NewGaugeVec(prometheus.GaugeOpts{ Namespace: namespace, Subsystem: subsystem, Name: \u0026quot;cron_sync_number\u0026quot;, Help: \u0026quot;Cron sync number.\u0026quot;, }, []string{\u0026quot;cluster\u0026quot;, \u0026quot;name\u0026quot;}) // ä»Žå„ä¸ªæŽ¥æ”¶æŽ¥å£æŽ¥æ”¶åˆ°çš„ç›‘æŽ§æ•°æ®æ€»é‡ CounterSampleTotal = prometheus.NewCounterVec(prometheus.CounterOpts{ Namespace: namespace, Subsystem: subsystem, Name: \u0026quot;samples_received_total\u0026quot;, Help: \u0026quot;Total number samples received.\u0026quot;, }, []string{\u0026quot;cluster\u0026quot;, \u0026quot;channel\u0026quot;}) // äº§ç”Ÿçš„å‘Šè­¦æ€»é‡ CounterAlertsTotal = prometheus.NewCounterVec(prometheus.CounterOpts{ Namespace: namespace, Subsystem: subsystem, Name: \u0026quot;alerts_total\u0026quot;, Help: \u0026quot;Total number alert events.\u0026quot;, }, []string{\u0026quot;cluster\u0026quot;}) // å†…å­˜ä¸­çš„å‘Šè­¦äº‹ä»¶é˜Ÿåˆ—çš„é•¿åº¦ GaugeAlertQueueSize = prometheus.NewGaugeVec(prometheus.GaugeOpts{ Namespace: namespace, Subsystem: subsystem, Name: \u0026quot;alert_queue_size\u0026quot;, Help: \u0026quot;The size of alert queue.\u0026quot;, }, []string{\u0026quot;cluster\u0026quot;}) ) func Init() { // Register the summary and the histogram with Prometheus's default registry. prometheus.MustRegister( GaugeCronDuration, GaugeSyncNumber, CounterSampleTotal, CounterAlertsTotal, GaugeAlertQueueSize, ) }  å®šä¹‰ä¸€ä¸ªç›‘æŽ§æŒ‡æ ‡ï¼Œé™¤äº† name ä¹‹å¤–ï¼Œè¿˜å¯ä»¥è®¾ç½® namespaceã€subsystemï¼Œæœ€ç»ˆé€šè¿‡ /metrics æŽ¥å£æš´éœ²çš„æ—¶å€™ï¼Œå¯ä»¥å‘çŽ°ï¼šç›‘æŽ§æŒ‡æ ‡çš„æœ€ç»ˆåå­—ï¼Œå°±æ˜¯$namespace_$subsystem_$nameï¼Œä¸‰è€…æ‹¼æŽ¥åœ¨ä¸€èµ·ã€‚Webapi æ¨¡å—çš„ç›‘æŽ§ä»£ç ä¸­æˆ‘ä»¬çœ‹åˆ°äº† counter ç±»åž‹å’Œ histogram ç±»åž‹çš„å¤„ç†ï¼Œè¿™æ¬¡æˆ‘ä»¬æ‹¿ GaugeAlertQueueSize ä¸¾ä¾‹ï¼Œè¿™æ˜¯ä¸ª GAUGE ç±»åž‹çš„ç»Ÿè®¡æ•°æ®ï¼Œèµ·ä¸€ä¸ª goroutine å‘¨æœŸæ€§èŽ·å–é˜Ÿåˆ—é•¿åº¦ï¼Œç„¶åŽ Set åˆ° GaugeAlertQueueSize ä¸­ï¼š\npackage engine import ( \u0026quot;context\u0026quot; \u0026quot;time\u0026quot; \u0026quot;github.com/didi/nightingale/v5/src/server/config\u0026quot; promstat \u0026quot;github.com/didi/nightingale/v5/src/server/stat\u0026quot; ) func Start(ctx context.Context) error { ... go reportQueueSize() return nil } func reportQueueSize() { for { time.Sleep(time.Second) promstat.GaugeAlertQueueSize.WithLabelValues(config.C.ClusterName).Set(float64(EventQueue.Len())) } }  å¦å¤–ï¼ŒInit æ–¹æ³•è¦åœ¨ Server æ¨¡å—åˆå§‹åŒ–çš„æ—¶å€™è°ƒç”¨ï¼ŒServer çš„ router.go ä¸­è¦æš´éœ² /metrics ç«¯ç‚¹è·¯å¾„ï¼Œè¿™äº›å°±ä¸å†è¯¦è¿°äº†ï¼Œå¤§å®¶å¯ä»¥æ‰’æ‹‰ä¸€ä¸‹å¤œèŽºçš„ä»£ç çœ‹ä¸€ä¸‹ã€‚\næ•°æ®æŠ“å– # åº”ç”¨è‡ªèº«çš„ç›‘æŽ§æ•°æ®å·²ç»é€šè¿‡ /metrics æŽ¥å£æš´éœ²äº†ï¼ŒåŽç»­é‡‡é›†è§„åˆ™å¯ä»¥åœ¨ prometheus.yml ä¸­é…ç½®ï¼Œprometheus.yml ä¸­æœ‰ä¸ª section å«ï¼šscrape_configs å¯ä»¥é…ç½®æŠ“å–ç›®æ ‡ï¼Œè¿™æ˜¯ Prometheus èŒƒç•´çš„çŸ¥è¯†äº†ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒPrometheuså®˜ç½‘ã€‚\næˆ–è€…ï¼Œå¤§å®¶ä¹Ÿå¯ä»¥ä½¿ç”¨ Categraf çš„ prometheus æ’ä»¶æŠ“å– /metrics æ•°æ®ï¼Œå°±æ˜¯æŠŠ url é…ç½®è¿›åŽ»å³å¯ï¼Œæ¯”è¾ƒå®¹æ˜“ã€‚\nå‚è€ƒèµ„æ–™ #  https://prometheus.io/docs/instrumenting/clientlibs/ https://github.com/prometheus/client_golang/tree/master/examples  "}),e.add({id:15,href:"/docs/usage/mtail/",title:"æ—¥å¿—ç›‘æŽ§",description:"å¤œèŽºï¼ˆ Nightingale ï¼‰é€šè¿‡ mtail ç›‘æŽ§æ—¥å¿—",content:"å‰è¨€ # è¯´åˆ°æ—¥å¿—ç›‘æŽ§ï¼Œå¤§å®¶ç¬¬ä¸€ååº”çš„å¯èƒ½æ˜¯ELKçš„æ–¹æ¡ˆï¼Œæˆ–è€…Lokiçš„æ–¹æ¡ˆï¼Œè¿™ä¸¤ä¸ªæ–¹æ¡ˆéƒ½æ˜¯æŠŠæ—¥å¿—é‡‡é›†äº†å‘åˆ°ä¸­å¿ƒï¼Œåœ¨ä¸­å¿ƒå­˜å‚¨ã€æŸ¥çœ‹ã€åˆ†æžï¼Œä¸è¿‡è¿™ä¸ªæ–¹æ¡ˆç›¸å¯¹æ¯”è¾ƒé‡é‡çº§ä¸€äº›ï¼Œå¦‚æžœæˆ‘ä»¬çš„éœ€æ±‚åªæ˜¯ä»Žæ—¥å¿—ä¸­æå–ä¸€äº›metricsæ•°æ®ï¼Œæ¯”å¦‚ç»Ÿè®¡ä¸€äº›æ—¥å¿—ä¸­å‡ºçŽ°çš„Erroræ¬¡æ•°ä¹‹ç±»çš„ï¼Œåˆ™æœ‰ä¸€ä¸ªæ›´ç®€å•çš„æ–¹æ¡ˆã€‚\nè¿™é‡Œç»™å¤§å®¶ä»‹ç»ä¸€ä¸ªGoogleå‡ºå“çš„å°å·¥å…·ï¼Œmtailï¼Œmtailå°±æ˜¯æµå¼è¯»å–æ—¥å¿—ï¼Œé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„æ–¹å¼ä»Žæ—¥å¿—ä¸­æå–metricsæŒ‡æ ‡ï¼Œè¿™ç§æ–¹å¼å¯ä»¥åˆ©ç”¨ç›®æ ‡æœºå™¨çš„ç®—åŠ›ï¼Œä¸è¿‡å¦‚æžœé‡å¤ªå¤§ï¼Œå¯èƒ½ä¼šå½±å“ç›®æ ‡æœºå™¨ä¸Šçš„ä¸šåŠ¡ç¨‹åºï¼Œå¦å¤–ä¸€ä¸ªå¥½å¤„æ˜¯æ— ä¾µå…¥æ€§ï¼Œä¸éœ€è¦ä¸šåŠ¡åŸ‹ç‚¹ï¼Œå¦‚æžœä¸šåŠ¡ç¨‹åºæ˜¯ç¬¬ä¸‰æ–¹ä¾›åº”å•†æä¾›çš„ï¼Œæˆ‘ä»¬æ”¹ä¸äº†å…¶ä»£ç ï¼Œmtailæ­¤æ—¶å°±éžå¸¸åˆé€‚äº†ã€‚å½“ç„¶äº†ï¼Œå¦‚æžœä¸šåŠ¡ç¨‹åºæ˜¯æˆ‘ä»¬å…¬å¸çš„äººè‡ªå·±å†™çš„ï¼Œé‚£è¿˜æ˜¯å»ºè®®ç”¨åŸ‹ç‚¹çš„æ–¹å¼é‡‡é›†æŒ‡æ ‡ï¼Œmtailåªæ˜¯ä½œä¸ºä¸€ä¸ªè¡¥å……å§ã€‚\nmtailç®€ä»‹ # mtailçš„ä½¿ç”¨æ–¹æ¡ˆï¼Œå‚è€ƒå¦‚ä¸‹ä¸¤ä¸ªæ–‡æ¡£ï¼ˆä¸‹è½½çš„è¯å‚è€ƒReleasesé¡µé¢ï¼‰ï¼š\n Deploying Programming Guide  æˆ‘ä»¬æ‹¿mtailçš„å¯åŠ¨å‘½ä»¤æ¥ä¸¾ä¾‹å…¶ç”¨æ³•ï¼š\nmtail --progs /etc/mtail --logs /var/log/syslog --logs /var/log/ntp/peerstats  é€šè¿‡ --progs å‚æ•°æŒ‡å®šä¸€ä¸ªç›®å½•ï¼Œè¿™ä¸ªç›®å½•é‡Œæ”¾ç½®ä¸€å †çš„*.mtailæ–‡ä»¶ï¼Œæ¯ä¸ªmtailæ–‡ä»¶å°±æ˜¯æè¿°çš„æ­£åˆ™æå–è§„åˆ™ï¼Œé€šè¿‡ --logs å‚æ•°æ¥æŒ‡å®šè¦ç›‘æŽ§çš„æ—¥å¿—ç›®å½•ï¼Œå¯ä»¥å†™é€šé…ç¬¦ï¼Œ--logs å¯ä»¥å†™å¤šæ¬¡ï¼Œä¸Šä¾‹ä¸­åªæ˜¯æŒ‡å®šäº† --progs å’Œ --logs ï¼Œæ²¡æœ‰å…¶ä»–å‚æ•°ï¼Œmtailå¯åŠ¨ä¹‹åŽä¼šè‡ªåŠ¨ç›‘å¬ä¸€ä¸ªç«¯å£3903ï¼Œåœ¨3903çš„/metricsæŽ¥å£æš´éœ²ç¬¦åˆPrometheusåè®®çš„ç›‘æŽ§æ•°æ®ï¼ŒPrometheus æˆ–è€… Categraf æˆ–è€… Telegraf ç­‰å°±å¯ä»¥ä»Ž /metrics æŽ¥å£æå–ç›‘æŽ§æ•°æ®ã€‚\nè¿™æ ·çœ‹èµ·æ¥ï¼ŒåŽŸç†å°±å¾ˆæ¸…æ™°äº†ï¼Œmtail å¯åŠ¨ä¹‹åŽï¼Œæ ¹æ® --logs æ‰¾åˆ°ç›¸å…³æ—¥å¿—æ–‡ä»¶ï¼Œseek åˆ°æ–‡ä»¶æœ«å°¾ï¼Œå¼€å§‹æµå¼è¯»å–ï¼Œæ¯è¯»åˆ°ä¸€è¡Œï¼Œå°±æ ¹æ® --progs æŒ‡å®šçš„é‚£äº›è§„åˆ™æ–‡ä»¶åšåŒ¹é…ï¼Œçœ‹æ˜¯å¦ç¬¦åˆæŸäº›æ­£åˆ™ï¼Œä»Žä¸­æå–æ—¶åºæ•°æ®ï¼Œç„¶åŽé€šè¿‡3903çš„/metricsæš´éœ²é‡‡é›†åˆ°çš„ç›‘æŽ§æŒ‡æ ‡ã€‚å½“ç„¶ï¼Œé™¤äº†Prometheusè¿™ç§/metricsæ–¹å¼æš´éœ²ï¼Œmtail è¿˜æ”¯æŒæŠŠç›‘æŽ§æ•°æ®ç›´æŽ¥æŽ¨ç»™ graphite æˆ–è€… statsdï¼Œå…·ä½“å¯ä»¥å‚è€ƒï¼šè¿™é‡Œ\nmtailæ ·ä¾‹ # è¿™é‡Œæˆ‘ç”¨mtailç›‘æŽ§ä¸€ä¸‹n9e-serverçš„æ—¥å¿—ï¼Œä»Žä¸­æå–ä¸€ä¸‹å„ä¸ªå‘Šè­¦è§„åˆ™è§¦å‘çš„ notify çš„æ•°é‡ï¼Œè¿™ä¸ªæ—¥å¿—ä¸¾ä¾‹ï¼š\n2021-12-27 10:00:30.537582 INFO engine/logger.go:19 event(cbb8d4be5efd07983c296aaa4dec5737 triggered) notify: rule_id=9 [__name__=net_response_result_code author=qin ident=10-255-0-34 port=4567 protocol=tcp server=localhost]2@1640570430  å¾ˆæ˜Žæ˜¾ï¼Œæ—¥å¿—ä¸­æœ‰è¿™ä¹ˆä¸ªå…³é”®å­—ï¼šnotify: rule_id=9ï¼Œå¯ä»¥ç”¨æ­£åˆ™æ¥åŒ¹é…ï¼Œç»Ÿè®¡å‡ºçŽ°çš„è¡Œæ•°ï¼Œruleid ä¹Ÿå¯ä»¥ä»Žä¸­æå–åˆ°ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ ruleid ä½œä¸ºæ ‡ç­¾ä¸ŠæŠ¥ï¼ŒäºŽæ˜¯ä¹Žï¼Œæˆ‘ä»¬å°±å¯ä»¥å†™å‡ºè¿™æ ·çš„ mtail è§„åˆ™äº†ï¼š\n[root@10-255-0-34 nightingale]# cat /etc/mtail/n9e-server.mtail counter mtail_alert_rule_notify_total by ruleid /notify: rule_id=(?P\u0026lt;ruleid\u0026gt;\\d+)/ { mtail_alert_rule_notify_total[$ruleid]++ }  ç„¶åŽå¯åŠ¨ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œæˆ‘è¿™é‡Œå°±ç”¨ nohup ç®€å•æ¥åšï¼š\nnohup mtail -logtostderr --progs /etc/mtail --logs server.log \u0026amp;\u0026gt; stdout.log \u0026amp;  mtail æ²¡æœ‰æŒ‡å®šç»å¯¹è·¯å¾„ï¼Œæ˜¯å› ä¸ºæˆ‘æŠŠ mtail çš„äºŒè¿›åˆ¶ç›´æŽ¥æ”¾åœ¨äº† /usr/bin ä¸‹é¢äº†ï¼Œmtail é»˜è®¤ä¼šç›‘å¬åœ¨ 3903ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨å¦‚ä¸‹å‘½ä»¤éªŒè¯ï¼š\ncurl -s localhost:3903/metrics # output: # HELP mtail_alert_rule_notify_total defined at n9e-server.mtail:1:9-37 # TYPE mtail_alert_rule_notify_total counter mtail_alert_rule_notify_total{prog=\u0026quot;n9e-server.mtail\u0026quot;,ruleid=\u0026quot;9\u0026quot;} 6  ä¸Šé¢çš„è¾“å‡ºåªæ˜¯æŒ‘é€‰äº†éƒ¨åˆ†å†…å®¹ï¼Œæ²¡æœ‰å…¨éƒ¨è´´å‡ºï¼Œè¿™å°±è¡¨ç¤ºæ­£å¸¸é‡‡é›†åˆ°äº†ï¼Œå¦‚æžœ n9e çš„ server.log ä¸­å½“å‰æ²¡æœ‰æ‰“å° notify ç›¸å…³çš„æ—¥å¿—ï¼Œé‚£è¯·æ±‚/metricsæŽ¥å£æ˜¯æ²¡æ³•å¾—åˆ°ä¸Šé¢çš„è¾“å‡ºçš„ï¼Œå¯ä»¥æ‰‹å·¥é…ç½®ä¸€æ¡å¿…ç„¶ä¼šè§¦å‘çš„è§„åˆ™ï¼Œå¾…æ—¥å¿—é‡Œæœ‰ç›¸å…³è¾“å‡ºçš„æ—¶å€™å†æ¬¡è¯·æ±‚ /metrics æŽ¥å£ï¼Œåº”è¯¥å°±æœ‰äº†ã€‚\næœ€åŽæˆ‘ä»¬åœ¨ Categraf ï¼ˆæˆ–è€… Telegrafï¼‰ ä¸­é…ç½®ä¸€ä¸‹æŠ“å–è§„åˆ™ï¼ŒæŠ“å–æœ¬æœºçš„ http://localhost:3903/metrics å³å¯ï¼Œç„¶åŽé‡å¯ Categrafï¼Œç­‰ä¸€ä¼šå°±å¯ä»¥åœ¨é¡µé¢æŸ¥åˆ°ç›¸å…³æŒ‡æ ‡äº†ã€‚\nå¦å¤–ï¼Œmtail çš„é…ç½®æ–‡ä»¶å¦‚æžœå‘ç”Ÿå˜åŒ–ï¼Œæ˜¯éœ€è¦é‡å¯ mtail æ‰èƒ½ç”Ÿæ•ˆçš„ï¼Œæˆ–è€…å‘ä¸€ä¸ª SIGHUP ä¿¡å·ç»™ mtailï¼Œmtail æ”¶åˆ°ä¿¡å·å°±ä¼šé‡æ–°åŠ è½½é…ç½®ã€‚\nmtailæ›´å¤šæ ·ä¾‹ # mtail çš„ github repo ä¸­æœ‰ä¸€ä¸ª examplesï¼Œé‡Œè¾¹æœ‰æŒºå¤šä¾‹å­ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒã€‚æˆ‘åœ¨è¿™é‡Œå†ç»™å¤§å®¶ä¸¾ä¸€ä¸ªç®€å•ä¾‹å­ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦ç»Ÿè®¡ /var/log/messages æ–‡ä»¶ä¸­çš„ Out of memory å…³é”®å­—ï¼Œmtail è§„åˆ™åº”è¯¥æ€Žä¹ˆå†™å‘¢ï¼Ÿå…¶å®žæ¯”ä¸Šé¢ä¸¾ä¾‹çš„ mtail_alert_rule_notify_total è¿˜è¦æ›´ç®€å•ï¼š\ncounter mtail_oom_total /Out of memory/ { mtail_oom_total++ }  å…³äºŽæ—¶é—´æˆ³ # æœ€åŽè¯´ä¸€ä¸‹æ—¶é—´æˆ³çš„é—®é¢˜ï¼Œæ—¥å¿—ä¸­æ¯ä¸€è¡Œä¸€èˆ¬éƒ½æ˜¯æœ‰ä¸ªæ—¶é—´æˆ³çš„ï¼Œå¤œèŽºv4ç‰ˆæœ¬åœ¨é¡µé¢ä¸Šé…ç½®é‡‡é›†è§„åˆ™çš„æ—¶å€™ï¼Œå°±æ˜¯è¦é€‰æ‹©æ—¶é—´æˆ³çš„ï¼Œä½†æ˜¯ mtailï¼Œä¸Šé¢çš„ä¾‹å­ä¸­æ²¡æœ‰å¤„ç†æ—¶é—´æˆ³ï¼Œä¸ºå•¥ï¼Ÿå…¶å®ž mtail ä¹Ÿå¯ä»¥æ”¯æŒä»Žæ—¥å¿—ä¸­æå–æ—¶é—´æˆ³ï¼Œå¦‚æžœæ²¡æœ‰é…ç½®çš„è¯ï¼Œå°±ç”¨ç³»ç»Ÿå½“å‰æ—¶é—´ï¼Œä¸ªäººè®¤ä¸ºï¼Œç”¨ç³»ç»Ÿå½“å‰æ—¶é—´å°±å¯ä»¥äº†ï¼Œä»Žæ—¥å¿—ä¸­æå–æ—¶é—´ç¨å¾®è¿˜æœ‰ç‚¹éº»çƒ¦ï¼Œå½“ç„¶ï¼Œç³»ç»Ÿå½“å‰æ—¶é—´å’Œæ—¥å¿—ä¸­çš„æ—¶é—´å¯èƒ½ç¨å¾®æœ‰å·®åˆ«ï¼Œä½†æ˜¯ä¸ä¼šå·®å¾ˆå¤šçš„ï¼Œå¯ä»¥æŽ¥å—ï¼Œexamples ä¸­çš„ mtail æ ·ä¾‹ï¼Œä¹ŸåŸºæœ¬éƒ½æ²¡æœ‰ç»™å‡ºæ—¶é—´æˆ³çš„æå–ã€‚\n"}),e.add({id:16,href:"/docs/api/read/",title:"æ•°æ®è¯»å–",description:"è¯»å–å¤œèŽºNightingaleçš„ç›‘æŽ§æ•°æ®",content:"å¤œèŽºæŠŠæŽ¥æ”¶åˆ°çš„ç›‘æŽ§æ•°æ®éƒ½ç›´æŽ¥å†™å…¥äº†åŽç«¯æ—¶åºæ•°æ®åº“ï¼Œæ‰€ä»¥ï¼Œè¯»å–ç›‘æŽ§æ•°æ®ï¼Œæ— éœ€ç»ç”±å¤œèŽºçš„æŽ¥å£ï¼Œç›´æŽ¥è¯»å–åŽç«¯çš„æ—¶åºåº“çš„æŽ¥å£å°±å¯ä»¥äº†ã€‚å³ï¼šå¦‚æžœä½¿ç”¨äº† Prometheusï¼Œå°±é€šè¿‡ Prometheus çš„æŽ¥å£è¯»å–ç›‘æŽ§æ•°æ®ï¼Œå¦‚æžœç”¨äº† VictoriaMetricsï¼Œå°±é€šè¿‡ VictoriaMetrics çš„æŽ¥å£è¯»å–ç›‘æŽ§æ•°æ®ã€‚\næ¯”å¦‚ Prometheusï¼Œå°±æ˜¯é‚£äº›/api/v1/query /api/v1/query_rangeä¹‹ç±»çš„æŽ¥å£ã€‚ç›¸å…³æŽ¥å£æ–‡æ¡£è¯·å‚è€ƒï¼šPrometheuså®˜ç½‘\n"}),e.add({id:17,href:"/docs/api/push/",title:"æ•°æ®æŽ¨é€",description:"å¦‚ä½•æŠŠè‡ªå®šä¹‰ç›‘æŽ§æ•°æ®æŽ¨é€ç»™å¤œèŽºNightingale",content:"åœ¨ é‡‡é›†å™¨ ç« èŠ‚å¯ä»¥çœ‹å‡ºï¼Œå¤œèŽºæ”¯æŒå¤šç§æ•°æ®æŽ¥æ”¶çš„æŽ¥å£ï¼ˆç”± n9e-server å®žçŽ°ï¼ŒæŽ¨é€æ•°æ®å°±æ˜¯æŽ¨ç»™ n9e-server çš„ 19000 ç«¯å£ï¼‰ï¼ŒåŒ…æ‹¬ OpenTSDBã€Open-Falconã€RemoteWriteã€Datadog ç­‰åè®®ã€‚è¿™èŠ‚æˆ‘ä»¬ä»¥ OpenTSDB çš„æ•°æ®æŽ¥æ”¶æŽ¥å£ä¸¾ä¾‹ã€‚\nOpenTSDB çš„æ•°æ®æŽ¥æ”¶æŽ¥å£çš„ Url Path æ˜¯ /opentsdb/put ï¼ŒPOST æ–¹æ³•ï¼Œç›‘æŽ§æ•°æ®åšæˆ JSON æ”¾åˆ° HTTP Request Body ä¸­ï¼Œä¸¾ä¾‹ï¼š\n[ { \u0026quot;metric\u0026quot;: \u0026quot;cpu_usage_idle\u0026quot;, \u0026quot;timestamp\u0026quot;: 1637732157, \u0026quot;tags\u0026quot;: { \u0026quot;cpu\u0026quot;: \u0026quot;cpu-total\u0026quot;, \u0026quot;ident\u0026quot;: \u0026quot;c3-ceph01.bj\u0026quot; }, \u0026quot;value\u0026quot;: 30.5 }, { \u0026quot;metric\u0026quot;: \u0026quot;cpu_usage_util\u0026quot;, \u0026quot;timestamp\u0026quot;: 1637732157, \u0026quot;tags\u0026quot;: { \u0026quot;cpu\u0026quot;: \u0026quot;cpu-total\u0026quot;, \u0026quot;ident\u0026quot;: \u0026quot;c3-ceph01.bj\u0026quot; }, \u0026quot;value\u0026quot;: 69.5 } ]  æ˜¾ç„¶ï¼ŒJSON æœ€å¤–å±‚æ˜¯ä¸ªæ•°ç»„ï¼Œå¦‚æžœåªä¸ŠæŠ¥ä¸€æ¡ç›‘æŽ§æ•°æ®ï¼Œä¹Ÿå¯ä»¥ä¸è¦å¤–é¢çš„ä¸­æ‹¬å·ï¼Œç›´æŽ¥æŠŠå¯¹è±¡ç»“æž„ä¸ŠæŠ¥ï¼š\n{ \u0026quot;metric\u0026quot;: \u0026quot;cpu_usage_idle\u0026quot;, \u0026quot;timestamp\u0026quot;: 1637732157, \u0026quot;tags\u0026quot;: { \u0026quot;cpu\u0026quot;: \u0026quot;cpu-total\u0026quot;, \u0026quot;ident\u0026quot;: \u0026quot;c3-ceph01.bj\u0026quot; }, \u0026quot;value\u0026quot;: 30.5 }  æœåŠ¡ç«¯ä¼šçœ‹ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯å¦æ˜¯[ï¼Œæ¥åˆ¤æ–­ä¸ŠæŠ¥çš„æ˜¯æ•°ç»„ï¼Œè¿˜æ˜¯å•ä¸ªå¯¹è±¡ï¼Œè‡ªåŠ¨åšç›¸åº”çš„ Decodeã€‚å¦‚æžœè§‰å¾—ä¸ŠæŠ¥çš„å†…å®¹å¤ªè¿‡å ç”¨å¸¦å®½ï¼Œä¹Ÿå¯ä»¥åš gzip åŽ‹ç¼©ï¼Œæ­¤æ—¶ä¸ŠæŠ¥çš„æ•°æ®ï¼Œè¦å¸¦æœ‰Content-Encoding: gzipçš„ Headerã€‚\nðŸ’¡  æ³¨æ„ ident è¿™ä¸ªæ ‡ç­¾ï¼Œident æ˜¯ identity çš„ç¼©å†™ï¼Œè¡¨ç¤ºè®¾å¤‡çš„å”¯ä¸€æ ‡è¯†ï¼Œå¦‚æžœæ ‡ç­¾ä¸­æœ‰ ident æ ‡ç­¾ï¼Œn9e-server å°±è®¤ä¸ºè¿™ä¸ªç›‘æŽ§æ•°æ®æ˜¯æ¥è‡ªæŸä¸ªæœºå™¨çš„ï¼Œä¼šè‡ªåŠ¨èŽ·å– ident çš„ valueï¼Œæ³¨å†Œåˆ°ç›‘æŽ§å¯¹è±¡çš„åˆ—è¡¨é‡Œ   "}),e.add({id:18,href:"/docs/api/webapi/",title:"WebapiæŽ¥å£",description:"è°ƒç”¨å¤œèŽºNightingaleçš„WebapiæŽ¥å£",content:"ç®€ä»‹ # n9e-webapi æ¨¡å—æä¾›äº†ä¸¤ç±»æŽ¥å£ï¼Œä¸€ä¸ªæ˜¯ /api/n9e æ‰“å¤´çš„ï¼Œç»™å‰ç«¯è°ƒç”¨ï¼Œå¦ä¸€ç±»æ˜¯ /v1/n9e æ‰“å¤´çš„ï¼Œç»™ç¬¬ä¸‰æ–¹ç³»ç»Ÿè°ƒç”¨ã€‚å¦‚æžœæƒ³ä»¥ä¸ªäººèº«ä»½æ¨¡ä»¿WEBæ“ä½œï¼Œä¹Ÿæ˜¯è°ƒç”¨ /api/n9e ç›¸å…³æŽ¥å£ã€‚\nä»¥ä¸ªäººèº«ä»½æ¨¡ä»¿WEBæ“ä½œ # è¿™ç§æ–¹å¼ï¼Œé¡µé¢ä¸Š JavaScript å¯ä»¥è°ƒç”¨çš„æ‰€æœ‰æŽ¥å£ï¼Œä½ éƒ½å¯ä»¥ç”¨ç¨‹åºè°ƒç”¨ï¼Œæ‰“å¼€ chrome çš„å¼€å‘è€…å·¥å…·ï¼Œæ‰’æ‹‰è¿™äº›æŽ¥å£ï¼Œè¿˜æ˜¯éžå¸¸å®¹æ˜“çš„ã€‚å½“ç„¶ï¼Œè¦å…ˆç™»å½•ï¼Œç™»å½•è°ƒç”¨ webapi æ¨¡å—çš„ /api/n9e/auth/login æŽ¥å£ï¼Œç³»ç»Ÿä½¿ç”¨ jwt è®¤è¯ï¼Œå¦‚æžœç™»å½•æˆåŠŸï¼Œä¼šè¿”å›ž access_token å’Œ refresh_tokenï¼Œæ¯æ¬¡è°ƒç”¨çš„æ—¶å€™éƒ½è¦æŠŠ access_token æ”¾åˆ° Header é‡Œï¼Œaccess_token å·®ä¸å¤š15åˆ†é’Ÿè¿‡æœŸï¼Œä¹‹åŽå¯ä»¥é‡æ–°è°ƒç”¨ç™»å½•æŽ¥å£æ¢ tokenï¼Œä¹Ÿå¯ä»¥è°ƒç”¨ /api/n9e/auth/refresh æŽ¥å£ç”¨ refresh_token æ¢ä¸€ä¸ªæ–°çš„ access_tokenï¼Œå½“ç„¶ï¼Œä¹Ÿä¼šé¡ºé“è¿”å›žä¸€ä¸ªæ–°çš„ refresh_tokenï¼Œä¸¾ä¾‹ï¼š\n# è°ƒç”¨ç™»å½•æŽ¥å£æ‹¿åˆ°access_tokenå’Œrefresh_tokenè®°å½•ä¸‹æ¥ï¼ŒåŽé¢è°ƒç”¨å…¶ä»–æŽ¥å£çš„æ—¶å€™ä¼šç”¨åˆ° [root@10-255-0-34 ~]# curl -X POST 'http://localhost:18000/api/n9e/auth/login' -d '{\u0026quot;username\u0026quot;: \u0026quot;root\u0026quot;, \u0026quot;password\u0026quot;: \u0026quot;root.2020\u0026quot;}' {\u0026quot;dat\u0026quot;:{\u0026quot;access_token\u0026quot;:\u0026quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhY2Nlc3NfdXVpZCI6ImIxNTcyMjgwLWZlNzAtNDhjZi1hNDQ3LWVlMjVhZmYwMjRhZCIsImF1dGhvcml6ZWQiOnRydWUsImV4cCI6MTYzNzgyMzA1OSwidXNlcl9pZGVudGl0eSI6IjEtcm9vdCJ9.nJ56Pc7qS5Ik_UaVmlNWu_QlABaBc4pZ_WkU45u2wWk\u0026quot;,\u0026quot;refresh_token\u0026quot;:\u0026quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2MzgzMzc4NTksInJlZnJlc2hfdXVpZCI6ImIxNTcyMjgwLWZlNzAtNDhjZi1hNDQ3LWVlMjVhZmYwMjRhZCsrMS1yb290IiwidXNlcl9pZGVudGl0eSI6IjEtcm9vdCJ9.JKsbfTYBCOOfR_oPsf496N9ml9yXbP7BHb4E8Yfnzbo\u0026quot;,\u0026quot;user\u0026quot;:{\u0026quot;id\u0026quot;:1,\u0026quot;username\u0026quot;:\u0026quot;root\u0026quot;,\u0026quot;nickname\u0026quot;:\u0026quot;è¶…ç®¡\u0026quot;,\u0026quot;phone\u0026quot;:\u0026quot;\u0026quot;,\u0026quot;email\u0026quot;:\u0026quot;\u0026quot;,\u0026quot;portrait\u0026quot;:\u0026quot;\u0026quot;,\u0026quot;roles\u0026quot;:[\u0026quot;Admin\u0026quot;],\u0026quot;contacts\u0026quot;:{},\u0026quot;create_at\u0026quot;:1637545881,\u0026quot;create_by\u0026quot;:\u0026quot;system\u0026quot;,\u0026quot;update_at\u0026quot;:1637546351,\u0026quot;update_by\u0026quot;:\u0026quot;root\u0026quot;,\u0026quot;admin\u0026quot;:true}},\u0026quot;err\u0026quot;:\u0026quot;\u0026quot;} # access_tokenæ”¾åˆ°Authorizationè¿™ä¸ªHeaderé‡Œï¼ŒBearerçš„éªŒè¯æ–¹å¼ [root@10-255-0-34 ~]# curl -H \u0026quot;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhY2Nlc3NfdXVpZCI6ImIxNTcyMjgwLWZlNzAtNDhjZi1hNDQ3LWVlMjVhZmYwMjRhZCIsImF1dGhvcml6ZWQiOnRydWUsImV4cCI6MTYzNzgyMzA1OSwidXNlcl9pZGVudGl0eSI6IjEtcm9vdCJ9.nJ56Pc7qS5Ik_UaVmlNWu_QlABaBc4pZ_WkU45u2wWk\u0026quot; 'http://localhost:18000/api/n9e/self/profile' {\u0026quot;dat\u0026quot;:{\u0026quot;id\u0026quot;:1,\u0026quot;username\u0026quot;:\u0026quot;root\u0026quot;,\u0026quot;nickname\u0026quot;:\u0026quot;è¶…ç®¡\u0026quot;,\u0026quot;phone\u0026quot;:\u0026quot;\u0026quot;,\u0026quot;email\u0026quot;:\u0026quot;\u0026quot;,\u0026quot;portrait\u0026quot;:\u0026quot;\u0026quot;,\u0026quot;roles\u0026quot;:[\u0026quot;Admin\u0026quot;],\u0026quot;contacts\u0026quot;:{},\u0026quot;create_at\u0026quot;:1637545881,\u0026quot;create_by\u0026quot;:\u0026quot;system\u0026quot;,\u0026quot;update_at\u0026quot;:1637546351,\u0026quot;update_by\u0026quot;:\u0026quot;root\u0026quot;,\u0026quot;admin\u0026quot;:true},\u0026quot;err\u0026quot;:\u0026quot;\u0026quot;} # å¦‚æžœtokenè¿‡æœŸäº†ï¼ŒåŽç«¯ä¼šè¿”å›žå¼‚å¸¸HTTPçŠ¶æ€ç ï¼Œæ­¤æ—¶è¦è°ƒç”¨refreshæŽ¥å£æ¢å–æ–°çš„token [root@10-255-0-34 ~]# curl -X POST 'http://localhost:18000/api/n9e/auth/refresh' -d '{\u0026quot;refresh_token\u0026quot;: \u0026quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2MzgzMzc4NTksInJlZnJlc2hfdXVpZCI6ImIxNTcyMjgwLWZlNzAtNDhjZi1hNDQ3LWVlMjVhZmYwMjRhZCsrMS1yb290IiwidXNlcl9pZGVudGl0eSI6IjEtcm9vdCJ9.JKsbfTYBCOOfR_oPsf496N9ml9yXbP7BHb4E8Yfnzbo\u0026quot;}' {\u0026quot;dat\u0026quot;:{\u0026quot;access_token\u0026quot;:\u0026quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhY2Nlc3NfdXVpZCI6IjAxMzkzYzkxLTk5MWItNGE0Yi04ODk2LTJhZGRjMDUwYjcxMCIsImF1dGhvcml6ZWQiOnRydWUsImV4cCI6MTYzNzgyMzMxOCwidXNlcl9pZGVudGl0eSI6IjEtcm9vdCJ9.2BeWyYfcnRi3qw69zecaaeFnPFUNAGsiPIZBBnd5lug\u0026quot;,\u0026quot;refresh_token\u0026quot;:\u0026quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2MzgzMzgxMTgsInJlZnJlc2hfdXVpZCI6IjAxMzkzYzkxLTk5MWItNGE0Yi04ODk2LTJhZGRjMDUwYjcxMCsrMS1yb290IiwidXNlcl9pZGVudGl0eSI6IjEtcm9vdCJ9.zFZaRYcJI6G5maSgDVF-jZzxQ3Tb5dybIqufJhBy034\u0026quot;},\u0026quot;err\u0026quot;:\u0026quot;\u0026quot;}  ç¬¬ä¸‰æ–¹ç³»ç»Ÿè°ƒç”¨å¤œèŽº # æ¯”å¦‚ç¬¬ä¸‰æ–¹ç³»ç»Ÿæƒ³èŽ·å–å¤œèŽºä¸­çš„æ‰€æœ‰æœªæ¢å¤å‘Šè­¦ï¼Œæˆ–è€…èŽ·å–å¤œèŽºä¸­çš„å…¨é‡ç”¨æˆ·åˆ—è¡¨ï¼Œè¿™äº›éœ€æ±‚ï¼Œå»ºè®®èµ° /v1/n9e æ‰“å¤´çš„æŽ¥å£ï¼Œè¿™äº›æŽ¥å£èµ° BasicAuth è®¤è¯ï¼ŒBasicAuth çš„ç”¨æˆ·åå’Œå¯†ç åœ¨ webapi.conf ä¸­å¯ä»¥æ‰¾åˆ°ï¼Œå°±æ˜¯ BasicAuth é‚£ä¸ª section çš„é…ç½®ã€‚å½“å‰è¿™ä¸ªé˜¶æ®µï¼Œ/v1/n9e å‰ç¼€çš„æŽ¥å£è¿˜æ¯”è¾ƒå°‘ï¼Œä¸è¿‡ä»£ç æ¡†æž¶å·²ç»æ­èµ·æ¥äº†ï¼Œä»£ç åœ¨ src/webapi/router/router.go æ–‡ä»¶ä¸­ï¼Œå¦‚æžœè´µå¸è¦å°è£…å¤œèŽºçš„æŽ¥å£ï¼Œå¯èƒ½è¦åœ¨è¿™ä¸ªè·¯ç”±åˆ†ç»„ä¸‹åŠ ä¸€äº›è·¯ç”±é…ç½®äº†ï¼Œæ¬¢è¿Žå¤§å®¶ PRã€‚\n"}),e.add({id:19,href:"/docs/api/",title:"API",description:"å¤œèŽº Nightingale API æ‰‹å†Œ",content:""}),e.add({id:20,href:"/docs/usage/",title:"ä½¿ç”¨æ‰‹å†Œ",description:"å¤œèŽº Nightingale ä½¿ç”¨æ‰‹å†Œ",content:""}),e.add({id:21,href:"/docs/agent/",title:"é‡‡é›†å™¨",description:"ç›‘æŽ§æ•°æ®é‡‡é›†å™¨ï¼ŒCategrafã€Telegrafã€Grafana-Agentã€Datadog-Agentç­‰",content:""}),e.add({id:22,href:"/docs/install/",title:"å®‰è£…éƒ¨ç½²",description:"å¤œèŽºå®‰è£…éƒ¨ç½²",content:""}),e.add({id:23,href:"/docs/prologue/",title:"ç®€ä»‹",description:"å¤œèŽºä»‹ç»",content:""}),e.add({id:24,href:"/docs/",title:"Nightingale",description:"Nightingale is a cloud native monitoring system",content:""}),search.addEventListener("input",t,!0);function t(){const s=5;var n=this.value,o=e.search(n,{limit:s,enrich:!0});const t=new Map;for(const e of o.flatMap(e=>e.result)){if(t.has(e.doc.href))continue;t.set(e.doc.href,e.doc)}if(suggestions.innerHTML="",suggestions.classList.remove("d-none"),t.size===0&&n){const e=document.createElement("div");e.innerHTML=`No results for "<strong>${n}</strong>"`,e.classList.add("suggestion__no-results"),suggestions.appendChild(e);return}for(const[r,a]of t){const n=document.createElement("div");suggestions.appendChild(n);const e=document.createElement("a");e.href=r,n.appendChild(e);const o=document.createElement("span");o.textContent=a.title,o.classList.add("suggestion__title"),e.appendChild(o);const i=document.createElement("span");if(i.textContent=a.description,i.classList.add("suggestion__description"),e.appendChild(i),suggestions.appendChild(n),suggestions.childElementCount==s)break}}})()