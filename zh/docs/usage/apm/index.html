<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=https://n9e.github.io/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://n9e.github.io/fonts/vendor/jost/jost-v4-latin-500.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://n9e.github.io/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script><link rel=stylesheet href=https://n9e.github.io/main.ac11ddb4c05d63d9306a2e99fe8ab3a89c059bd13af027151f267942e6ea1a6d4242aacd51b034166a296b7833f683a4395206df505071159d1835d8158732b5.css integrity="sha512-rBHdtMBdY9kwai6Z/oqzqJwFm9E68CcVHyZ5QubqGm1CQqrNUbA0Fmopa3gz9oOkOVIG31BQcRWdGDXYFYcytQ==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>åº”ç”¨ç›‘æ§ - å¤œèºäº‘åŸç”Ÿç›‘æ§</title><meta name=description content="å¤œèºï¼ˆ Nightingale ï¼‰é€šè¿‡ Prometheus SDK ç›‘æ§åº”ç”¨ç¨‹åº"><link rel=canonical href=https://n9e.github.io/zh/docs/usage/apm/><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="åº”ç”¨ç›‘æ§"><meta property="og:description" content="å¤œèºï¼ˆ Nightingale ï¼‰é€šè¿‡ Prometheus SDK ç›‘æ§åº”ç”¨ç¨‹åº"><meta property="og:url" content="https://n9e.github.io/zh/docs/usage/apm/"><meta property="og:site_name" content="Nightingale"><meta property="article:published_time" content="2020-10-06T08:48:57+00:00"><meta property="article:modified_time" content="2023-08-08T16:22:25+08:00"><meta property="og:image" content="https://n9e.github.io/doks.png"><meta property="og:image:alt" content="Nightingale"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@ulricqin"><meta name=twitter:creator content="@henkverlinde"><meta name=twitter:title content="åº”ç”¨ç›‘æ§"><meta name=twitter:description content="å¤œèºï¼ˆ Nightingale ï¼‰é€šè¿‡ Prometheus SDK ç›‘æ§åº”ç”¨ç¨‹åº"><meta name=twitter:image content="https://n9e.github.io/doks.png"><meta name=twitter:image:alt content="åº”ç”¨ç›‘æ§"><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"https://n9e.github.io/#/schema/organization/1","name":"Doks","url":"https://n9e.github.io/","sameAs":["https://twitter.com/ulricqin","https://github.com/ccfos/nightingale"],"logo":{"@type":"ImageObject","@id":"https://n9e.github.io/#/schema/image/1","url":"https://n9e.github.io/logo-doks.png","width":512,"height":512,"caption":"Doks"},"image":{"@id":"https://n9e.github.io/#/schema/image/1"}},{"@type":"WebSite","@id":"https://n9e.github.io/#/schema/website/1","url":"https://n9e.github.io/","name":"Nightingale","description":"å¤œèºç›‘æ§(å®˜ç½‘),äº‘åŸç”Ÿç›‘æ§,Kubernetes Monitoring,å¼€æºç›‘æ§,å›½äº§ç›‘æ§,CCFå¤œèº","publisher":{"@id":"https://n9e.github.io/#/schema/organization/1"}},{"@type":"WebPage","@id":"https://n9e.github.io/zh/docs/usage/apm/","url":"https://n9e.github.io/zh/docs/usage/apm/","name":"åº”ç”¨ç›‘æ§","description":"å¤œèºï¼ˆ Nightingale ï¼‰é€šè¿‡ Prometheus SDK ç›‘æ§åº”ç”¨ç¨‹åº","isPartOf":{"@id":"https://n9e.github.io/#/schema/website/1"},"about":{"@id":"https://n9e.github.io/#/schema/organization/1"},"datePublished":"2020-10-06T08:48:57CET","dateModified":"2023-08-08T16:22:25CET","breadcrumb":{"@id":"https://n9e.github.io/zh/docs/usage/apm/#/schema/breadcrumb/1"},"primaryImageOfPage":{"@id":"https://n9e.github.io/zh/docs/usage/apm/#/schema/image/2"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://n9e.github.io/zh/docs/usage/apm/"]}]},{"@type":"BreadcrumbList","@id":"https://n9e.github.io/zh/docs/usage/apm/#/schema/breadcrumb/1","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"https://n9e.github.io/","url":"https://n9e.github.io/","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@type":"WebPage","@id":"https://n9e.github.io/zh/","url":"https://n9e.github.io/zh/","name":"Zh"}},{"@type":"ListItem","position":3,"item":{"@type":"WebPage","@id":"https://n9e.github.io/zh/docs/","url":"https://n9e.github.io/zh/docs/","name":"Docs"}},{"@type":"ListItem","position":4,"item":{"@type":"WebPage","@id":"https://n9e.github.io/zh/docs/usage/","url":"https://n9e.github.io/zh/docs/usage/","name":"Usage"}},{"@type":"ListItem","position":5,"item":{"@id":"https://n9e.github.io/zh/docs/usage/apm/"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Article","@id":"https://n9e.github.io/#/schema/article/1","headline":"åº”ç”¨ç›‘æ§","description":"å¤œèºï¼ˆ Nightingale ï¼‰é€šè¿‡ Prometheus SDK ç›‘æ§åº”ç”¨ç¨‹åº","isPartOf":{"@id":"https://n9e.github.io/zh/docs/usage/apm/"},"mainEntityOfPage":{"@id":"https://n9e.github.io/zh/docs/usage/apm/"},"datePublished":"2020-10-06T08:48:57CET","dateModified":"2023-08-08T16:22:25CET","author":{"@id":"https://n9e.github.io/#/schema/person/2"},"publisher":{"@id":"https://n9e.github.io/#/schema/organization/1"},"image":{"@id":"https://n9e.github.io/zh/docs/usage/apm/#/schema/image/2"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Person","@id":"https://n9e.github.io/#/schema/person/2","name":"Henk Verlinde","sameAs":["https://twitter.com/henkverlinde","https://www.linkedin.com/in/henkverlinde/","https://github.com/UlricQin"]}]},{"@context":"https://schema.org","@graph":[{"@type":"ImageObject","@id":"https://n9e.github.io/zh/docs/usage/apm/#/schema/image/2","url":"https://n9e.github.io/doks.png","contentUrl":"https://n9e.github.io/doks.png","caption":"åº”ç”¨ç›‘æ§"}]}]}</script><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=https://n9e.github.io/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://n9e.github.io/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://n9e.github.io/favicon-16x16.png><link rel=manifest crossorigin=use-credentials href=https://n9e.github.io/site.webmanifest></head><body class="docs single"><div class=header-bar></div><header class="navbar navbar-expand-md navbar-light doks-navbar"><nav class="container-xxl flex-wrap flex-md-nowrap" aria-label="Main navigation"><a class="navbar-brand p-0 me-auto" href=/zh/ aria-label=Nightingale>Nightingale</a>
<button class="btn btn-menu d-block d-md-none order-5" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasDoks aria-controls=offcanvasDoks aria-label="Open main menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button><div class="offcanvas offcanvas-end border-0 py-md-1" tabindex=-1 id=offcanvasDoks data-bs-backdrop=true aria-labelledby=offcanvasDoksLabel><div class="header-bar d-md-none"></div><div class="offcanvas-header d-md-none"><h2 class="h5 offcanvas-title ps-2" id=offcanvasDoksLabel><a class=text-dark href=/zh/>Nightingale</a></h2><button type=button class="btn-close text-reset me-2" data-bs-dismiss=offcanvas aria-label="Close main menu"></button></div><div class="offcanvas-body px-4"><h3 class="h6 text-uppercase mb-3 d-md-none">Main</h3><ul class="nav flex-column flex-md-row ms-md-n3"><li class=nav-item><a class="nav-link ps-0 py-1" href=https://flashcat.cloud/docs/>æ–‡æ¡£</a></li></ul><hr class="text-black-50 my-4 d-md-none"><h3 class="h6 text-uppercase mb-3 d-md-none">Socials</h3><ul class="nav flex-column flex-md-row ms-md-auto me-md-n5 pe-md-2"><li class=nav-item><a class="nav-link ps-0 py-1" href=https://github.com/ccfos/nightingale><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><small class="ms-2 d-md-none">GitHub</small></a></li></ul></div></div><button id=mode class="btn btn-link order-md-1" type=button aria-label="Toggle user interface mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button><div class="dropdown order-md-2"><button class="btn btn-doks-light dropdown-toggle" id=doks-languages data-bs-toggle=dropdown aria-expanded=false data-bs-display=static>
ZH
<span class=dropdown-caret><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"/></svg></span></button><ul class="dropdown-menu dropdown-menu-end shadow rounded border-0" aria-labelledby=doks-languages><li><a class="dropdown-item current" aria-current=true href=/zh/docs/usage/apm/>Chinese</a></li><li><hr class=dropdown-divider></li><li><a class=dropdown-item rel=alternate href=/zh/en hreflang=en lang=en>English</a></li></ul></div></nav></header><nav class="doks-subnavbar py-2 sticky-lg-top" aria-label="Secondary navigation"><div class="container-xxl d-flex align-items-md-center"><form class="doks-search position-relative flex-grow-1 me-auto"><input id=search class="form-control is-search" type=search placeholder="Search docs..." aria-label="Search docs..." autocomplete=off><div id=suggestions class="shadow bg-white rounded d-none"></div></form><button class="btn doks-sidebar-toggle d-lg-none ms-3 order-3 collapsed" type=button data-bs-toggle=collapse data-bs-target=#doks-docs-nav aria-controls=doks-docs-nav aria-expanded=false aria-label="Toggle documentation navigation"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="doks doks-expand" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Expand</title><polyline points="7 13 12 18 17 13"/><polyline points="7 6 12 11 17 6"/></svg><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="doks doks-collapse" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Collapse</title><polyline points="17 11 12 6 7 11"/><polyline points="17 18 12 13 7 18"/></svg></button></div></nav><div class=container-xxl><aside class=doks-sidebar><nav id=doks-docs-nav class="collapse d-lg-none" aria-label="Tertiary navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-e05dce83e5129785b9f316978a14b896 aria-expanded=false>
ç®€ä»‹</button><div class=collapse id=section-e05dce83e5129785b9f316978a14b896><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/prologue/introduction/>å¤œèºä»‹ç»</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/prologue/consulting/></a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/prologue/opensource-vs-enterprise/>ä¼ä¸šç‰ˆ</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-039d392cea6b20609a2aa94015441bad aria-expanded=false>
å®‰è£…éƒ¨ç½²</button><div class=collapse id=section-039d392cea6b20609a2aa94015441bad><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/install/first/>å¼€å§‹ä¹‹å‰</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/install/compose/>Docker Compose</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/install/helm/>Helm</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/install/server/>æœåŠ¡ç«¯ç»„ä»¶éƒ¨ç½²</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/install/victoria/>VictoriaMetrics</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/install/ibex/>Ibex</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-15ad62fa6c036f6a916b4336fe04c118 aria-expanded=false>
é‡‡é›†å™¨</button><div class=collapse id=section-15ad62fa6c036f6a916b4336fe04c118><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/agent/categraf/>Categraf</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/agent/telegraf/>Telegraf</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/agent/datadog-agent/>Datadog-Agent</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/agent/grafana-agent/>Grafana-Agent</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/agent/falcon-plugin/>Falcon-Plugin</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-32b9362149d032ed724daac36671f31a aria-expanded=true>
ä½¿ç”¨æ‰‹å†Œ</button><div class="collapse show" id=section-32b9362149d032ed724daac36671f31a><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/usage/share/>è—ç»é˜</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/usage/video/>å…¥é—¨æ•™ç¨‹</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/usage/snmp/>SNMP</a></li><li><a class="docs-link rounded active" href=https://n9e.github.io/zh/docs/usage/apm/>åº”ç”¨ç›‘æ§</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/usage/mtail/>Mtailæ—¥å¿—ç›‘æ§</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/usage/esalert/>ESæ—¥å¿—å‘Šè­¦</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/usage/jvm/>JVMç›‘æ§</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/usage/notify/>å‘Šè­¦é€šçŸ¥</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/usage/format/>å‘Šè­¦æ ¼å¼</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/usage/aialert/>æ™ºèƒ½å¼‚å¸¸æ£€æµ‹</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-db974238714ca8de634a7ce1d083a14f aria-expanded=false>
API</button><div class=collapse id=section-db974238714ca8de634a7ce1d083a14f><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/api/read/>æ•°æ®è¯»å–</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/api/push/>æ•°æ®æ¨é€</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/api/webapi/>Webapiæ¥å£</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-2e307a62e897bd84f1fcb3f4443e46dc aria-expanded=false>
é™„å½•</button><div class=collapse id=section-2e307a62e897bd84f1fcb3f4443e46dc><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li class="my-1 ms-3"><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-99d0251d969c569e15cd7b8de1245c49 aria-expanded=false>
Grafana-agent</button><div class=collapse id=section-99d0251d969c569e15cd7b8de1245c49><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/grafana-agent-overview/>æ€»è§ˆ</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/k8s_metrics/>æ”¶é›†metrics</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/k8s_logs/>æ”¶é›†logs</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/k8s_traces/>æ”¶é›†trace</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/scrape_exporters/>æ”¶é›†ä¸‰æ–¹exporter</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/how-to-monitoring-k8s/>ç›‘æ§K8s</a></li><li class="my-1 ms-3"><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-415320131958c70f4f250ca4d7e63bbd aria-expanded=false>
integrations</button><div class=collapse id=section-415320131958c70f4f250ca4d7e63bbd><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/integrations/overview/>Overview</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/integrations/node-exporter-config/>Node Exporter</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/integrations/mysqld-exporter-config/>MySQLd Exporter</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/integrations/process-exporter-config/>Process Exporter</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/integrations/cadvisor-config/>cAdvisor Exporter</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/integrations/windows-exporter-config/>Windows Exporter</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/integrations/postgres-exporter-config/>Postgres Exporter</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/integrations/mongodb-exporter-config/>Mongodb Exporter</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/integrations/redis-exporter-config/>Redis Exporter</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/integrations/memcached-exporter-config/>Memcached Exporter</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/integrations/kafka-exporter-config/>Kafka Exporter</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/integrations/elasticsearch-exporter-config/>Elasticsearch Exporter</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/integrations/consul-exporter-config/>Consul Exporter</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/integrations/dnsmasq-exporter-config/>dnsmasq Exporter</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/integrations/github-exporter-config/>Github Exporter</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/integrations/statsd-exporter-config/>Statsd Exporter</a></li></ul></div></li></ul></div></li><li class="my-1 ms-3"><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-57825f7de0361f1c3eabf5868a125de3 aria-expanded=false>
ç”¨æˆ·æ¡ˆä¾‹ç ”ç©¶</button><div class=collapse id=section-57825f7de0361f1c3eabf5868a125de3><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/usecase/a-startup-way-to-building-monitoring-system/>é«˜ç§‘æŠ€Startupæ„å»ºç›‘æ§ä½“ç³»ä¹‹è·¯</a></li></ul></div></li></ul></div></li></ul></nav></aside></div><div class="wrap container-xxl" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar d-none d-lg-block"><nav class=docs-links aria-label="Main navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-e05dce83e5129785b9f316978a14b896 aria-expanded=false>
ç®€ä»‹</button><div class=collapse id=section-e05dce83e5129785b9f316978a14b896><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/prologue/introduction/>å¤œèºä»‹ç»</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/prologue/consulting/></a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/prologue/opensource-vs-enterprise/>ä¼ä¸šç‰ˆ</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-039d392cea6b20609a2aa94015441bad aria-expanded=false>
å®‰è£…éƒ¨ç½²</button><div class=collapse id=section-039d392cea6b20609a2aa94015441bad><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/install/first/>å¼€å§‹ä¹‹å‰</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/install/compose/>Docker Compose</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/install/helm/>Helm</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/install/server/>æœåŠ¡ç«¯ç»„ä»¶éƒ¨ç½²</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/install/victoria/>VictoriaMetrics</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/install/ibex/>Ibex</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-15ad62fa6c036f6a916b4336fe04c118 aria-expanded=false>
é‡‡é›†å™¨</button><div class=collapse id=section-15ad62fa6c036f6a916b4336fe04c118><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/agent/categraf/>Categraf</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/agent/telegraf/>Telegraf</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/agent/datadog-agent/>Datadog-Agent</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/agent/grafana-agent/>Grafana-Agent</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/agent/falcon-plugin/>Falcon-Plugin</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-32b9362149d032ed724daac36671f31a aria-expanded=true>
ä½¿ç”¨æ‰‹å†Œ</button><div class="collapse show" id=section-32b9362149d032ed724daac36671f31a><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/usage/share/>è—ç»é˜</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/usage/video/>å…¥é—¨æ•™ç¨‹</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/usage/snmp/>SNMP</a></li><li><a class="docs-link rounded active" href=https://n9e.github.io/zh/docs/usage/apm/>åº”ç”¨ç›‘æ§</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/usage/mtail/>Mtailæ—¥å¿—ç›‘æ§</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/usage/esalert/>ESæ—¥å¿—å‘Šè­¦</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/usage/jvm/>JVMç›‘æ§</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/usage/notify/>å‘Šè­¦é€šçŸ¥</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/usage/format/>å‘Šè­¦æ ¼å¼</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/usage/aialert/>æ™ºèƒ½å¼‚å¸¸æ£€æµ‹</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-db974238714ca8de634a7ce1d083a14f aria-expanded=false>
API</button><div class=collapse id=section-db974238714ca8de634a7ce1d083a14f><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/api/read/>æ•°æ®è¯»å–</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/api/push/>æ•°æ®æ¨é€</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/api/webapi/>Webapiæ¥å£</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-2e307a62e897bd84f1fcb3f4443e46dc aria-expanded=false>
é™„å½•</button><div class=collapse id=section-2e307a62e897bd84f1fcb3f4443e46dc><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li class="my-1 ms-3"><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-99d0251d969c569e15cd7b8de1245c49 aria-expanded=false>
Grafana-agent</button><div class=collapse id=section-99d0251d969c569e15cd7b8de1245c49><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/grafana-agent-overview/>æ€»è§ˆ</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/k8s_metrics/>æ”¶é›†metrics</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/k8s_logs/>æ”¶é›†logs</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/k8s_traces/>æ”¶é›†trace</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/scrape_exporters/>æ”¶é›†ä¸‰æ–¹exporter</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/how-to-monitoring-k8s/>ç›‘æ§K8s</a></li><li class="my-1 ms-3"><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-415320131958c70f4f250ca4d7e63bbd aria-expanded=false>
integrations</button><div class=collapse id=section-415320131958c70f4f250ca4d7e63bbd><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/integrations/overview/>Overview</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/integrations/node-exporter-config/>Node Exporter</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/integrations/mysqld-exporter-config/>MySQLd Exporter</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/integrations/process-exporter-config/>Process Exporter</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/integrations/cadvisor-config/>cAdvisor Exporter</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/integrations/windows-exporter-config/>Windows Exporter</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/integrations/postgres-exporter-config/>Postgres Exporter</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/integrations/mongodb-exporter-config/>Mongodb Exporter</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/integrations/redis-exporter-config/>Redis Exporter</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/integrations/memcached-exporter-config/>Memcached Exporter</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/integrations/kafka-exporter-config/>Kafka Exporter</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/integrations/elasticsearch-exporter-config/>Elasticsearch Exporter</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/integrations/consul-exporter-config/>Consul Exporter</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/integrations/dnsmasq-exporter-config/>dnsmasq Exporter</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/integrations/github-exporter-config/>Github Exporter</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/grafana-agent/integrations/statsd-exporter-config/>Statsd Exporter</a></li></ul></div></li></ul></div></li><li class="my-1 ms-3"><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-57825f7de0361f1c3eabf5868a125de3 aria-expanded=false>
ç”¨æˆ·æ¡ˆä¾‹ç ”ç©¶</button><div class=collapse id=section-57825f7de0361f1c3eabf5868a125de3><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/appendix/usecase/a-startup-way-to-building-monitoring-system/>é«˜ç§‘æŠ€Startupæ„å»ºç›‘æ§ä½“ç³»ä¹‹è·¯</a></li></ul></div></li></ul></div></li></ul></nav></div><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#å†™åœ¨å‰é¢>å†™åœ¨å‰é¢</a></li><li><a href=#åŸ‹ç‚¹å·¥å…·>åŸ‹ç‚¹å·¥å…·</a></li><li><a href=#å¤œèºè‡ªèº«ç›‘æ§>å¤œèºè‡ªèº«ç›‘æ§</a><ul><li><a href=#webapi>Webapi</a></li><li><a href=#server>Server</a></li><li><a href=#æ•°æ®æŠ“å–>æ•°æ®æŠ“å–</a></li></ul></li><li><a href=#å‚è€ƒèµ„æ–™>å‚è€ƒèµ„æ–™</a></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9"><h1>åº”ç”¨ç›‘æ§</h1><p class=lead></p><nav class=d-xl-none aria-label="Quaternary navigation"><div class=page-links><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#å†™åœ¨å‰é¢>å†™åœ¨å‰é¢</a></li><li><a href=#åŸ‹ç‚¹å·¥å…·>åŸ‹ç‚¹å·¥å…·</a></li><li><a href=#å¤œèºè‡ªèº«ç›‘æ§>å¤œèºè‡ªèº«ç›‘æ§</a><ul><li><a href=#webapi>Webapi</a></li><li><a href=#server>Server</a></li><li><a href=#æ•°æ®æŠ“å–>æ•°æ®æŠ“å–</a></li></ul></li><li><a href=#å‚è€ƒèµ„æ–™>å‚è€ƒèµ„æ–™</a></li></ul></nav></div></nav><h2 id=å†™åœ¨å‰é¢>å†™åœ¨å‰é¢ <a href=#%e5%86%99%e5%9c%a8%e5%89%8d%e9%9d%a2 class=anchor aria-hidden=true>#</a></h2><p>åº”ç”¨ç›‘æ§å®é™…è¦æ¯” OSã€ä¸­é—´ä»¶çš„ç›‘æ§æ›´ä¸ºå…³é”®ï¼Œå› ä¸ºæŸä¸ª OS å±‚é¢çš„æŒ‡æ ‡å¼‚å¸¸ï¼Œæ¯”å¦‚ CPU é£™é«˜äº†ï¼Œæœªå¿…ä¼šå½±å“ç»ˆç«¯ç”¨æˆ·çš„ä½“éªŒï¼Œä½†æ˜¯åº”ç”¨å±‚é¢çš„ç›‘æ§æŒ‡æ ‡å‡ºé—®é¢˜ï¼Œé€šå¸¸å°±ä¼šå½±å“å®¢æˆ·çš„æ„Ÿå—ã€ç”šè‡³å½±å“å®¢æˆ·çš„ä»˜è´¹ã€‚</p><p>é’ˆå¯¹åº”ç”¨ç›‘æ§ï¼ŒGoogleæå‡ºäº† 4 ä¸ªé»„é‡‘æŒ‡æ ‡ï¼Œåˆ†åˆ«æ˜¯ï¼šæµé‡ã€å»¶è¿Ÿã€é”™è¯¯ã€é¥±å’Œåº¦ï¼Œå…¶ä¸­å‰é¢ 3 ä¸ªæŒ‡æ ‡éƒ½å¯ä»¥é€šè¿‡å†…åµŒ SDK çš„æ–¹å¼åŸ‹ç‚¹é‡‡é›†ï¼Œæœ¬èŠ‚é‡ç‚¹ä»‹ç»è¿™ç§æ–¹å¼ã€‚å½“ç„¶äº†ï¼Œå†…åµŒ SDK æœ‰è¾ƒå¼ºçš„ä»£ç ä¾µå…¥æ€§ï¼Œå¦‚æœä¸šåŠ¡ç ”å‘éš¾ä»¥é…åˆï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨è§£ææ—¥å¿—çš„æ–¹æ¡ˆï¼Œè¿™ä¸ªè¶…å‡ºäº†å¤œèºï¼ˆå¤œèºæ˜¯æŒ‡æ ‡ç›‘æ§ç³»ç»Ÿï¼‰çš„èŒƒç•´ï¼Œå¤§å®¶å¦‚æœæ„Ÿå…´è¶£ï¼Œå¯ä»¥äº†è§£ä¸€ä¸‹<a href=https://flashcat.cloud/>å¿«çŒ«çš„å•†ä¸šåŒ–äº§å“</a></p><h2 id=åŸ‹ç‚¹å·¥å…·>åŸ‹ç‚¹å·¥å…· <a href=#%e5%9f%8b%e7%82%b9%e5%b7%a5%e5%85%b7 class=anchor aria-hidden=true>#</a></h2><p>æœ€å¸¸è§çš„é€šç”¨åŸ‹ç‚¹å·¥å…·æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯ statsdï¼Œä¸€ä¸ªæ˜¯ prometheus SDKï¼Œå½“ç„¶ï¼Œå„ä¸ªè¯­è¨€ä¹Ÿä¼šæœ‰è‡ªå·±çš„æ›´æ–¹ä¾¿çš„æ–¹å¼ï¼Œæ¯”å¦‚ Java ç”Ÿæ€ä½¿ç”¨ micrometer è¾ƒå¤šï¼Œå¦‚æœæ˜¯ SpringBoot çš„ç¨‹åºï¼Œåˆ™ä½¿ç”¨ actuator ä¼šæ›´ä¾¿æ·ï¼Œactuator åº•å±‚å°±æ˜¯ä½¿ç”¨ micrometerã€‚</p><h2 id=å¤œèºè‡ªèº«ç›‘æ§>å¤œèºè‡ªèº«ç›‘æ§ <a href=#%e5%a4%9c%e8%8e%ba%e8%87%aa%e8%ba%ab%e7%9b%91%e6%8e%a7 class=anchor aria-hidden=true>#</a></h2><p>æˆ‘ä»¬å°±ä»¥å¤œèºè‡ªèº«çš„ä»£ç ä¸¾ä¾‹ï¼Œè®²è§£å¦‚ä½•å†…åµŒåŸ‹ç‚¹å·¥å…·ï¼Œè¿™é‡Œé€‰æ‹© prometheus SDK ä½œä¸ºåŸ‹ç‚¹æ–¹æ¡ˆã€‚</p><p>å¤œèºæ ¸å¿ƒæ¨¡å—æœ‰ä¸¤ä¸ªï¼ŒWebapi ä¸»è¦æ˜¯æä¾› HTTP æ¥å£ç»™ JavaScript è°ƒç”¨ï¼ŒServer ä¸»è¦æ˜¯è´Ÿè´£æ¥æ”¶ç›‘æ§æ•°æ®ï¼Œå¤„ç†å‘Šè­¦è§„åˆ™ï¼Œè¿™ä¸¤ä¸ªæ¨¡å—éƒ½å¼•å…¥äº† Prometheus çš„ Go çš„SDKï¼Œç”¨æ­¤æ–¹å¼åš App Performance ç›‘æ§ï¼Œæœ¬èŠ‚ä»¥å¤œèºçš„ä»£ç ä¸ºä¾‹ï¼Œè®²è§£å¦‚ä½•ä½¿ç”¨ Prometheus çš„ SDKã€‚</p><h3 id=webapi>Webapi <a href=#webapi class=anchor aria-hidden=true>#</a></h3><p>Webapi æ¨¡å—ä¸»è¦ç»Ÿè®¡ä¸¤ä¸ªå†…å®¹ï¼Œä¸€ä¸ªæ˜¯è¯·æ±‚çš„æ•°é‡ç»Ÿè®¡ï¼Œä¸€ä¸ªæ˜¯è¯·æ±‚çš„å»¶è¿Ÿç»Ÿè®¡ï¼Œç»Ÿè®¡æ—¶ï¼Œè¦ç”¨ä¸åŒçš„ Label åšç»´åº¦åŒºåˆ†ï¼Œåé¢å°±å¯ä»¥é€šè¿‡ä¸åŒçš„ç»´åº¦åšå¤šç§å¤šæ ·çš„ç»Ÿè®¡åˆ†æï¼Œå¯¹äº HTTP è¯·æ±‚ï¼Œè§„åˆ’ 4 ä¸ªæ ¸å¿ƒ Labelï¼Œåˆ†åˆ«æ˜¯ï¼šserviceã€codeã€pathã€methodã€‚service æ ‡è¯†æœåŠ¡åç§°ï¼Œè¦æ±‚å…¨å±€å”¯ä¸€ï¼Œä¾¿äºå’Œå…¶ä»–æœåŠ¡åç§°åŒºåˆ†å¼€ï¼Œæ¯”å¦‚ Webapi æ¨¡å—ï¼Œå°±å®šä¹‰ä¸º n9e-webapiï¼Œcode æ˜¯ HTTP è¿”å›çš„çŠ¶æ€ç ï¼Œ200 å°±è¡¨ç¤ºæˆåŠŸæ•°é‡ï¼Œå…¶ä»– code å°±æ˜¯å¤±è´¥çš„ï¼Œåé¢æˆ‘ä»¬å¯ä»¥æ®æ­¤ç»Ÿè®¡æˆåŠŸç‡ï¼Œmethod æ˜¯ HTTP æ–¹æ³•ï¼ŒGETã€POSTã€PUTã€DELETE ç­‰ï¼Œæ¯”å¦‚æ–°å¢ç”¨æˆ·å’Œè·å–ç”¨æˆ·åˆ—è¡¨å¯èƒ½éƒ½æ˜¯ <code>/api/n9e/users</code>ï¼Œä»è·¯å¾„ä¸Šæ— æ³•åŒºåˆ†ï¼Œåªèƒ½å†åŠ ä¸Š method æ‰èƒ½åŒºåˆ†å¼€ã€‚</p><p>path ç€é‡è¯´ä¸€ä¸‹ï¼Œè¡¨ç¤ºè¯·æ±‚è·¯å¾„ï¼Œæ¯”å¦‚ä¸Šé¢æåˆ°çš„<code>/api/n9e/users</code>ï¼Œä½†æ˜¯ï¼Œåœ¨ restful å®è·µä¸­ï¼Œurl ä¸­ç»å¸¸ä¼šæœ‰å‚æ•°ï¼Œæ¯”å¦‚è·å–ç¼–å·ä¸º1çš„ç”¨æˆ·çš„ä¿¡æ¯ï¼Œæ¥å£æ˜¯<code>/api/n9e/user/1</code>ï¼Œè·å–ç¼–å·ä¸º2çš„ç”¨æˆ·ä¿¡æ¯ï¼Œæ¥å£æ˜¯<code>/api/n9e/user/2</code>ï¼Œå¦‚æœè¿™ä¿©å¸¦æœ‰ç”¨æˆ·ç¼–å·çš„ url éƒ½ä½œä¸º Labelï¼Œä¼šé€ æˆæ—¶åºåº“ç´¢å¼•çˆ†ç‚¸ï¼Œè€Œä¸”ä»ä¸šåŠ¡æ–¹ä½¿ç”¨è§’åº¦æ¥çœ‹ï¼Œæˆ‘ä»¬ä¹Ÿä¸å…³æ³¨ç¼–å·ä¸º1çš„ç”¨æˆ·è·å–è¯·æ±‚è¿˜æ˜¯ç¼–å·ä¸º2çš„ç”¨æˆ·è·å–è¯·æ±‚ï¼Œè€Œæ˜¯å…³æ³¨æ•´ä½“çš„<code>GET /api/n9e/user/:id</code>è¿™ä¸ªæ¥å£çš„ç›‘æ§æ•°æ®ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨è®¾ç½® Label çš„æ—¶å€™ï¼Œè¦æŠŠpathè®¾ç½®ä¸º<code>/api/n9e/user/:id</code>ï¼Œè€Œä¸æ˜¯é‚£å…·ä½“çš„å¸¦æœ‰ç”¨æˆ·ç¼–å·çš„ url è·¯å¾„ã€‚å¤œèºç”¨çš„ gin æ¡†æ¶ï¼Œgin æ¡†æ¶æœ‰ä¸ª FullPath æ–¹æ³•å°±æ˜¯è·å–è¿™ä¸ªä¿¡æ¯çš„ï¼Œæ¯”è¾ƒæ–¹ä¾¿ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨ Webapi ä¸‹é¢åˆ›å»ºä¸€ä¸ª stat packageï¼Œæ”¾ç½®ç›¸å…³ç»Ÿè®¡å˜é‡ï¼š</p><pre><code class=language-go>package stat

import (
	&quot;time&quot;

	&quot;github.com/prometheus/client_golang/prometheus&quot;
)

const Service = &quot;n9e-webapi&quot;

var (
	labels = []string{&quot;service&quot;, &quot;code&quot;, &quot;path&quot;, &quot;method&quot;}

	uptime = prometheus.NewCounterVec(
		prometheus.CounterOpts{
			Name: &quot;uptime&quot;,
			Help: &quot;HTTP service uptime.&quot;,
		}, []string{&quot;service&quot;},
	)

	RequestCounter = prometheus.NewCounterVec(
		prometheus.CounterOpts{
			Name: &quot;http_request_count_total&quot;,
			Help: &quot;Total number of HTTP requests made.&quot;,
		}, labels,
	)

	RequestDuration = prometheus.NewHistogramVec(
		prometheus.HistogramOpts{
			Buckets: []float64{.01, .1, 1, 10},
			Name:    &quot;http_request_duration_seconds&quot;,
			Help:    &quot;HTTP request latencies in seconds.&quot;,
		}, labels,
	)
)

func Init() {
	// Register the summary and the histogram with Prometheus's default registry.
	prometheus.MustRegister(
		uptime,
		RequestCounter,
		RequestDuration,
	)

	go recordUptime()
}

// recordUptime increases service uptime per second.
func recordUptime() {
	for range time.Tick(time.Second) {
		uptime.WithLabelValues(Service).Inc()
	}
}
</code></pre><p>uptime å˜é‡æ˜¯é¡ºæ‰‹ä¸ºä¹‹ï¼Œç»Ÿè®¡è¿›ç¨‹å¯åŠ¨äº†å¤šä¹…æ—¶é—´ï¼Œä¸ç”¨å¤ªå…³æ³¨ï¼ŒRequestCounter å’Œ RequestDurationï¼Œåˆ†åˆ«ç»Ÿè®¡è¯·æ±‚æµé‡å’Œè¯·æ±‚å»¶è¿Ÿã€‚Init æ–¹æ³•æ˜¯åœ¨ Webapi æ¨¡å—è¿›ç¨‹åˆå§‹åŒ–çš„æ—¶å€™è°ƒç”¨ï¼Œæ‰€ä»¥è¿›ç¨‹ä¸€èµ·ï¼Œå°±ä¼šè‡ªåŠ¨æ³¨å†Œå¥½ã€‚</p><p>ç„¶åæˆ‘ä»¬å†™ä¸€ä¸ª middlewareï¼Œåœ¨è¯·æ±‚è¿›æ¥çš„æ—¶å€™æ‹¦æˆªä¸€ä¸‹ï¼Œçœçš„æ¯ä¸ªè¯·æ±‚éƒ½è¦å»ç»Ÿè®¡ï¼Œmiddleware æ–¹æ³•çš„ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=language-go>import (
	...
	promstat &quot;github.com/didi/nightingale/v5/src/webapi/stat&quot;
)

func stat() gin.HandlerFunc {
	return func(c *gin.Context) {
		start := time.Now()
		c.Next()

		code := fmt.Sprintf(&quot;%d&quot;, c.Writer.Status())
		method := c.Request.Method
		labels := []string{promstat.Service, code, c.FullPath(), method}

		promstat.RequestCounter.WithLabelValues(labels...).Inc()
		promstat.RequestDuration.WithLabelValues(labels...).Observe(float64(time.Since(start).Seconds()))
	}
}
</code></pre><p>æœ‰äº†è¿™ä¸ª middleware ä¹‹åï¼Œnew å‡º gin çš„ engine çš„æ—¶å€™ï¼Œå°±ç«‹é©¬ Use ä¸€ä¸‹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=language-go>...
r := gin.New()
r.Use(stat())
...
</code></pre><p>æœ€åï¼Œç›‘æ§æ•°æ®è¦é€šè¿‡<code>/metrics</code>æ¥å£æš´éœ²å‡ºå»ï¼Œæˆ‘ä»¬è¦æš´éœ²è¿™ä¸ªè¯·æ±‚ç«¯ç‚¹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=language-go>import (
	...
	&quot;github.com/prometheus/client_golang/prometheus/promhttp&quot;
)

func configRoute(r *gin.Engine, version string) {
	...
	r.GET(&quot;/metrics&quot;, gin.WrapH(promhttp.Handler()))
}
</code></pre><p>å¦‚ä¸Šï¼Œæ¯ä¸ª Webapi çš„æ¥å£çš„æµé‡å’ŒæˆåŠŸç‡éƒ½å¯ä»¥ç›‘æ§åˆ°äº†ã€‚å¦‚æœä½ ä¹Ÿéƒ¨ç½²äº†å¤œèºï¼Œè¯·æ±‚ Webapi çš„ç«¯å£ï¼ˆé»˜è®¤æ˜¯18000ï¼‰çš„ <code>/metrics</code> æ¥å£çœ‹çœ‹å§ã€‚</p><div class="alert alert-doks d-flex" role=alert><div class="flex-shrink-1 alert-icon">ğŸ’¡</div><div class=w-100>å¦‚æœæœåŠ¡éƒ¨ç½²å¤šä¸ªå®ä¾‹ï¼Œç”šè‡³å¤šä¸ª regionï¼Œå¤šä¸ªç¯å¢ƒï¼Œä¸Šé¢çš„ 4 ä¸ª Label å°±ä¸å¤Ÿç”¨äº†ï¼Œå› ä¸ºåªæœ‰è¿™ 4 ä¸ª Label ä¸è¶³ä»¥å”¯ä¸€æ ‡è¯†ä¸€ä¸ªå…·ä½“çš„å®ä¾‹ï¼Œæ­¤æ—¶éœ€è¦ envã€regionã€instance è¿™ç§ Labelï¼Œè¿™äº› Labelä¸ éœ€è¦åœ¨ä»£ç é‡ŒåŸ‹ç‚¹ï¼Œåœ¨é‡‡é›†çš„æ—¶å€™ä¸€èˆ¬å¯ä»¥é™„åŠ é¢å¤–çš„æ ‡ç­¾ï¼Œé€šè¿‡é™„åŠ æ ‡ç­¾çš„æ–¹å¼æ¥å¤„ç†å³å¯</div></div><h3 id=server>Server <a href=#server class=anchor aria-hidden=true>#</a></h3><p>Server æ¨¡å—çš„ç›‘æ§ï¼Œå’Œ Webapi æ¨¡å—çš„ç›‘æ§å·®å¼‚è¾ƒå¤§ï¼Œå› ä¸ºå…³æ³¨ç‚¹ä¸åŒï¼ŒWebapi å…³æ³¨çš„æ˜¯ HTTP æ¥å£çš„è¯·æ±‚é‡å’Œå»¶è¿Ÿï¼Œè€Œ Server æ¨¡å—å…³æ³¨çš„æ˜¯æ¥æ”¶äº†å¤šå°‘ç›‘æ§æŒ‡æ ‡ï¼Œå†…éƒ¨äº‹ä»¶é˜Ÿåˆ—çš„é•¿åº¦ï¼Œä»æ•°æ®åº“åŒæ­¥å‘Šè­¦è§„åˆ™èŠ±è´¹å¤šä¹…ï¼ŒåŒæ­¥äº†å¤šå°‘æ¡æ•°æ®ç­‰ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦åœ¨ Server çš„ package ä¸‹åˆ›å»ºä¸€ä¸ª stat åŒ…ï¼Œstat åŒ…ä¸‹æ”¾ç½® stat.goï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><pre><code class=language-go>package stat

import (
	&quot;github.com/prometheus/client_golang/prometheus&quot;
)

const (
	namespace = &quot;n9e&quot;
	subsystem = &quot;server&quot;
)

var (
	// å„ä¸ªå‘¨æœŸæ€§ä»»åŠ¡çš„æ‰§è¡Œè€—æ—¶
	GaugeCronDuration = prometheus.NewGaugeVec(prometheus.GaugeOpts{
		Namespace: namespace,
		Subsystem: subsystem,
		Name:      &quot;cron_duration&quot;,
		Help:      &quot;Cron method use duration, unit: ms.&quot;,
	}, []string{&quot;cluster&quot;, &quot;name&quot;})

	// ä»æ•°æ®åº“åŒæ­¥æ•°æ®çš„æ—¶å€™ï¼ŒåŒæ­¥çš„æ¡æ•°
	GaugeSyncNumber = prometheus.NewGaugeVec(prometheus.GaugeOpts{
		Namespace: namespace,
		Subsystem: subsystem,
		Name:      &quot;cron_sync_number&quot;,
		Help:      &quot;Cron sync number.&quot;,
	}, []string{&quot;cluster&quot;, &quot;name&quot;})

	// ä»å„ä¸ªæ¥æ”¶æ¥å£æ¥æ”¶åˆ°çš„ç›‘æ§æ•°æ®æ€»é‡
	CounterSampleTotal = prometheus.NewCounterVec(prometheus.CounterOpts{
		Namespace: namespace,
		Subsystem: subsystem,
		Name:      &quot;samples_received_total&quot;,
		Help:      &quot;Total number samples received.&quot;,
	}, []string{&quot;cluster&quot;, &quot;channel&quot;})

	// äº§ç”Ÿçš„å‘Šè­¦æ€»é‡
	CounterAlertsTotal = prometheus.NewCounterVec(prometheus.CounterOpts{
		Namespace: namespace,
		Subsystem: subsystem,
		Name:      &quot;alerts_total&quot;,
		Help:      &quot;Total number alert events.&quot;,
	}, []string{&quot;cluster&quot;})

	// å†…å­˜ä¸­çš„å‘Šè­¦äº‹ä»¶é˜Ÿåˆ—çš„é•¿åº¦
	GaugeAlertQueueSize = prometheus.NewGaugeVec(prometheus.GaugeOpts{
		Namespace: namespace,
		Subsystem: subsystem,
		Name:      &quot;alert_queue_size&quot;,
		Help:      &quot;The size of alert queue.&quot;,
	}, []string{&quot;cluster&quot;})
)

func Init() {
	// Register the summary and the histogram with Prometheus's default registry.
	prometheus.MustRegister(
		GaugeCronDuration,
		GaugeSyncNumber,
		CounterSampleTotal,
		CounterAlertsTotal,
		GaugeAlertQueueSize,
	)
}
</code></pre><p>å®šä¹‰ä¸€ä¸ªç›‘æ§æŒ‡æ ‡ï¼Œé™¤äº† name ä¹‹å¤–ï¼Œè¿˜å¯ä»¥è®¾ç½® namespaceã€subsystemï¼Œæœ€ç»ˆé€šè¿‡ <code>/metrics</code> æ¥å£æš´éœ²çš„æ—¶å€™ï¼Œå¯ä»¥å‘ç°ï¼šç›‘æ§æŒ‡æ ‡çš„æœ€ç»ˆåå­—ï¼Œå°±æ˜¯<code>$namespace_$subsystem_$name</code>ï¼Œä¸‰è€…æ‹¼æ¥åœ¨ä¸€èµ·ã€‚Webapi æ¨¡å—çš„ç›‘æ§ä»£ç ä¸­æˆ‘ä»¬çœ‹åˆ°äº† counter ç±»å‹å’Œ histogram ç±»å‹çš„å¤„ç†ï¼Œè¿™æ¬¡æˆ‘ä»¬æ‹¿ GaugeAlertQueueSize ä¸¾ä¾‹ï¼Œè¿™æ˜¯ä¸ª GAUGE ç±»å‹çš„ç»Ÿè®¡æ•°æ®ï¼Œèµ·ä¸€ä¸ª goroutine å‘¨æœŸæ€§è·å–é˜Ÿåˆ—é•¿åº¦ï¼Œç„¶å Set åˆ° GaugeAlertQueueSize ä¸­ï¼š</p><pre><code class=language-go>package engine

import (
	&quot;context&quot;
	&quot;time&quot;

	&quot;github.com/didi/nightingale/v5/src/server/config&quot;
	promstat &quot;github.com/didi/nightingale/v5/src/server/stat&quot;
)

func Start(ctx context.Context) error {
	...
	go reportQueueSize()
	return nil
}

func reportQueueSize() {
	for {
		time.Sleep(time.Second)
		promstat.GaugeAlertQueueSize.WithLabelValues(config.C.ClusterName).Set(float64(EventQueue.Len()))
	}
}

</code></pre><p>å¦å¤–ï¼ŒInit æ–¹æ³•è¦åœ¨ Server æ¨¡å—åˆå§‹åŒ–çš„æ—¶å€™è°ƒç”¨ï¼ŒServer çš„ router.go ä¸­è¦æš´éœ² <code>/metrics</code> ç«¯ç‚¹è·¯å¾„ï¼Œè¿™äº›å°±ä¸å†è¯¦è¿°äº†ï¼Œå¤§å®¶å¯ä»¥æ‰’æ‹‰ä¸€ä¸‹å¤œèºçš„ä»£ç çœ‹ä¸€ä¸‹ã€‚</p><h3 id=æ•°æ®æŠ“å–>æ•°æ®æŠ“å– <a href=#%e6%95%b0%e6%8d%ae%e6%8a%93%e5%8f%96 class=anchor aria-hidden=true>#</a></h3><p>åº”ç”¨è‡ªèº«çš„ç›‘æ§æ•°æ®å·²ç»é€šè¿‡ <code>/metrics</code> æ¥å£æš´éœ²äº†ï¼Œåç»­é‡‡é›†è§„åˆ™å¯ä»¥åœ¨ prometheus.yml ä¸­é…ç½®ï¼Œprometheus.yml ä¸­æœ‰ä¸ª section å«ï¼šscrape_configs å¯ä»¥é…ç½®æŠ“å–ç›®æ ‡ï¼Œè¿™æ˜¯ Prometheus èŒƒç•´çš„çŸ¥è¯†äº†ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒ<a href=https://prometheus.io/>Prometheuså®˜ç½‘</a>ã€‚</p><p>æˆ–è€…ï¼Œå¤§å®¶ä¹Ÿå¯ä»¥ä½¿ç”¨ Categraf çš„ prometheus æ’ä»¶æŠ“å– <code>/metrics</code> æ•°æ®ï¼Œå°±æ˜¯æŠŠ url é…ç½®è¿›å»å³å¯ï¼Œæ¯”è¾ƒå®¹æ˜“ã€‚</p><h2 id=å‚è€ƒèµ„æ–™>å‚è€ƒèµ„æ–™ <a href=#%e5%8f%82%e8%80%83%e8%b5%84%e6%96%99 class=anchor aria-hidden=true>#</a></h2><ul><li><a href=https://prometheus.io/docs/instrumenting/clientlibs/>https://prometheus.io/docs/instrumenting/clientlibs/</a></li><li><a href=https://github.com/prometheus/client_golang/tree/master/examples>https://github.com/prometheus/client_golang/tree/master/examples</a></li></ul><div class="page-footer-meta d-flex flex-column flex-md-row justify-content-between"><div class=edit-page><a href=https://github.com/n9e/n9e.github.io/blob/master/content/zh/docs/usage/apm.md><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2"><path d="M17 3a2.828 2.828.0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>Edit this page on GitHub</a></div></div><div class="docs-navigation d-flex justify-content-between"><a href=/zh/docs/usage/snmp/><div class="card my-1"><div class="card-body py-2">&larr; SNMP</div></div></a><a class=ms-auto href=/zh/docs/usage/mtail/><div class="card my-1"><div class="card-body py-2">Mtailæ—¥å¿—ç›‘æ§ &rarr;</div></div></a></div></main></div></div></div><footer class="footer text-muted"><div class=container-xxl><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item>&copy; 2022 CCFÂ·Nightingale, all rights reserved.</li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class=list-inline></ul></div></div></div></footer><script src=/js/bootstrap.min.0a0106334435d4110713bfaff4acaf02533b0c56d44412a74e9518db07672ddb7e099a9c7517bc9cb529e2ddd4ae2e438b40b720288900d5e74fb6d8928d9097.js integrity="sha512-CgEGM0Q11BEHE7+v9KyvAlM7DFbURBKnTpUY2wdnLdt+CZqcdRe8nLUp4t3Uri5Di0C3ICiJANXnT7bYko2Qlw==" crossorigin=anonymous defer></script>
<script src=/js/highlight.min.0d31f7af12feb83ee633b6351b023ee643ea3412376fbaa09c5a26d1a5ef999939f1ad379a5b12e1199a2c7d72ae1b23f633060a679628dcbfb0e72378cd20be.js integrity="sha512-DTH3rxL+uD7mM7Y1GwI+5kPqNBI3b7qgnFom0aXvmZk58a03mlsS4RmaLH1yrhsj9jMGCmeWKNy/sOcjeM0gvg==" crossorigin=anonymous defer></script>
<script src=/main.min.6afc4bf655f45ae3e63629ec95be8bd2e0e792084b5635a6fe70b169fa9d1491638b3a4e900ed59c2e017ca18768e5c392e110d0e1336509f49f7dc418d16eef.js integrity="sha512-avxL9lX0WuPmNinslb6L0uDnkghLVjWm/nCxafqdFJFjizpOkA7VnC4BfKGHaOXDkuEQ0OEzZQn0n33EGNFu7w==" crossorigin=anonymous defer></script>
<script src=https://n9e.github.io/index.min.ebe74dca0458710217b1121bfa4d8889c3643ed21841820c0c54fe9c51f42bb8724b20fbe37594dcec79cf5d5af5eb9016047385f28980160f8dfe29912ef33d.js integrity="sha512-6+dNygRYcQIXsRIb+k2IicNkPtIYQYIMDFT+nFH0K7hySyD743WU3Ox5z11a9euQFgRzhfKJgBYPjf4pkS7zPQ==" crossorigin=anonymous defer></script>
<script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?9d7cc507a7aae60b28b5e04bb995492a",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script></body></html>